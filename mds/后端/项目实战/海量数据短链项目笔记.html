<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>海量数据短链项目笔记 | Forest's Blog</title>
    <meta name="description" content="业务背景：为啥需要短链?(一)  公司电商产品推广、业务活动⻚、广告落地⻚缺少实时【数据反馈和渠道效果分析】 (二)  老项目业务推广【没人维护，无法做埋点】需要统计效果 (三)  APP和营销活动发送营销短信链接过⻓，【浪费短信发送费用】 (四)  SaaS平台盈利 1.  用户按量付费，根...">
    <meta name="generator" content="VitePress v1.0.0-rc.39">
    <link rel="preload stylesheet" href="/assets/style.7us3DWBg.css" as="style">
    
    <script type="module" src="/assets/app.79eemTou.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.rWnqr8cy.js">
    <link rel="modulepreload" href="/assets/chunks/theme.XdhXHk-z.js">
    <link rel="modulepreload" href="/assets/mds_后端_项目实战_海量数据短链项目笔记.md.RqS8R3TT.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5a346dfe><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5a346dfe data-v-ae24b3ad><div class="VPNavBar has-sidebar" data-v-ae24b3ad data-v-19c990f1><div class="wrapper" data-v-19c990f1><div class="container" data-v-19c990f1><div class="title" data-v-19c990f1><div class="VPNavBarTitle has-sidebar" data-v-19c990f1 data-v-8460f0a8><a class="title" href="/" data-v-8460f0a8><!--[--><!--]--><!----><!--[-->Forest&#39;s Blog<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-19c990f1><div class="content-body" data-v-19c990f1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-19c990f1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-19c990f1 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mds/%E5%85%B3%E4%BA%8E%E6%88%91.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>关于我</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>前端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>JS底层知识</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%89%8D%E7%AB%AF/JS%E5%BA%95%E5%B1%82%E7%9F%A5%E8%AF%86/JS%E5%86%85%E5%AD%98%E6%9C%BA%E5%88%B6.html" data-v-43f1e123><!--[-->JS内存机制<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%89%8D%E7%AB%AF/JS%E5%BA%95%E5%B1%82%E7%9F%A5%E8%AF%86/JS%E5%87%BD%E6%95%B0.html" data-v-43f1e123><!--[-->JS函数<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%89%8D%E7%AB%AF/JS%E5%BA%95%E5%B1%82%E7%9F%A5%E8%AF%86/JavaScript%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" data-v-43f1e123><!--[-->JavaScript之数据类型<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>基础知识</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/CSS%E5%B8%B8%E8%A7%81%E6%A6%82%E5%BF%B5.html" data-v-43f1e123><!--[-->CSS常见概念<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/JavaScript%E6%80%BB%E7%BB%93.html" data-v-43f1e123><!--[-->JavaScript总结<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>工程化</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86.html" data-v-43f1e123><!--[-->Webpack核心原理<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>常用工具方法封装</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85/JS%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD.html" data-v-43f1e123><!--[-->JS数据类型判断<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85/JS%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81.html" data-v-43f1e123><!--[-->JS防抖节流<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>网络通信</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%89%8D%E7%AB%AF/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.html" data-v-43f1e123><!--[-->网络通信基本概念<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>后端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%90%8E%E7%AB%AF/K8s%E7%AC%94%E8%AE%B0.html" data-v-43f1e123><!--[-->K8s笔记<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%90%8E%E7%AB%AF/ShardingJDBC%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0.html" data-v-43f1e123><!--[-->ShardingJDBC分库分表mysql数据库实战笔记<!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>专题秘籍</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%90%8E%E7%AB%AF/%E4%B8%93%E9%A2%98%E7%A7%98%E7%B1%8D/K8s%E7%AC%94%E8%AE%B0.html" data-v-43f1e123><!--[-->K8s笔记<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%90%8E%E7%AB%AF/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B5%81%E5%A4%84%E7%90%86%E5%B9%B3%E5%8F%B0Kafka%E7%AC%94%E8%AE%B0.html" data-v-43f1e123><!--[-->分布式流处理平台Kafka笔记<!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>架构</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%90%8E%E7%AB%AF/%E6%9E%B6%E6%9E%84/%E6%9E%84%E6%9E%B6%E7%AC%94%E8%AE%B0.html" data-v-43f1e123><!--[-->构架笔记<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>项目</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%90%8E%E7%AB%AF/%E9%A1%B9%E7%9B%AE/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E7%9F%AD%E9%93%BE%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.html" data-v-43f1e123><!--[-->海量数据短链项目笔记<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>项目实战</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link active" href="/mds/%E5%90%8E%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E7%9F%AD%E9%93%BE%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.html" data-v-43f1e123><!--[-->海量数据短链项目笔记<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/mds/%E5%90%8E%E7%AB%AF/%E9%AB%98%E6%80%A7%E8%83%BDRabbitMQ%E5%AE%B9%E5%99%A8%E5%8C%96%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98.html" data-v-43f1e123><!--[-->高性能RabbitMQ容器化分布式集群实战<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>算法</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/mds/%E7%AE%97%E6%B3%95/%E7%AD%89%E5%BE%85%E8%AE%B0%E5%BD%95%E4%B8%AD.html" data-v-43f1e123><!--[-->等待记录中<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-19c990f1 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-1736f215 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1736f215><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1736f215><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-19c990f1 data-v-d0bd9dde data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-1736f215 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1736f215><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1736f215><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-19c990f1 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-19c990f1><div class="divider-line" data-v-19c990f1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5a346dfe data-v-0282ae07><div class="container" data-v-0282ae07><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-0282ae07><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-0282ae07><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-0282ae07>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-0282ae07 data-v-af18c0d5><button data-v-af18c0d5>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5a346dfe data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-e31bd47b><!----><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%85%B3%E4%BA%8E%E6%88%91.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>关于我</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>前端</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><section class="VPSidebarItem level-1" data-v-e31bd47b data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h3 class="text" data-v-e31bd47b>JS底层知识</h3><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%89%8D%E7%AB%AF/JS%E5%BA%95%E5%B1%82%E7%9F%A5%E8%AF%86/JS%E5%86%85%E5%AD%98%E6%9C%BA%E5%88%B6.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JS内存机制</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%89%8D%E7%AB%AF/JS%E5%BA%95%E5%B1%82%E7%9F%A5%E8%AF%86/JS%E5%87%BD%E6%95%B0.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JS函数</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%89%8D%E7%AB%AF/JS%E5%BA%95%E5%B1%82%E7%9F%A5%E8%AF%86/JavaScript%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JavaScript之数据类型</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-e31bd47b data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h3 class="text" data-v-e31bd47b>基础知识</h3><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/CSS%E5%B8%B8%E8%A7%81%E6%A6%82%E5%BF%B5.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>CSS常见概念</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/JavaScript%E6%80%BB%E7%BB%93.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JavaScript总结</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-e31bd47b data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h3 class="text" data-v-e31bd47b>工程化</h3><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Webpack核心原理</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-e31bd47b data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h3 class="text" data-v-e31bd47b>常用工具方法封装</h3><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85/JS%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JS数据类型判断</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%89%8D%E7%AB%AF/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85/JS%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JS防抖节流</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-e31bd47b data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h3 class="text" data-v-e31bd47b>网络通信</h3><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%89%8D%E7%AB%AF/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>网络通信基本概念</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 has-active" data-v-575e6a36 data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>后端</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%90%8E%E7%AB%AF/K8s%E7%AC%94%E8%AE%B0.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>K8s笔记</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%90%8E%E7%AB%AF/ShardingJDBC%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>ShardingJDBC分库分表mysql数据库实战笔记</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1" data-v-e31bd47b data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h3 class="text" data-v-e31bd47b>专题秘籍</h3><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%90%8E%E7%AB%AF/%E4%B8%93%E9%A2%98%E7%A7%98%E7%B1%8D/K8s%E7%AC%94%E8%AE%B0.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>K8s笔记</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%90%8E%E7%AB%AF/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B5%81%E5%A4%84%E7%90%86%E5%B9%B3%E5%8F%B0Kafka%E7%AC%94%E8%AE%B0.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>分布式流处理平台Kafka笔记</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1" data-v-e31bd47b data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h3 class="text" data-v-e31bd47b>架构</h3><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%90%8E%E7%AB%AF/%E6%9E%B6%E6%9E%84/%E6%9E%84%E6%9E%B6%E7%AC%94%E8%AE%B0.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>构架笔记</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-e31bd47b data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h3 class="text" data-v-e31bd47b>项目</h3><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%90%8E%E7%AB%AF/%E9%A1%B9%E7%9B%AE/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E7%9F%AD%E9%93%BE%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>海量数据短链项目笔记</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 has-active" data-v-e31bd47b data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h3 class="text" data-v-e31bd47b>项目实战</h3><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%90%8E%E7%AB%AF/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E7%9F%AD%E9%93%BE%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>海量数据短链项目笔记</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E5%90%8E%E7%AB%AF/%E9%AB%98%E6%80%A7%E8%83%BDRabbitMQ%E5%AE%B9%E5%99%A8%E5%8C%96%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>高性能RabbitMQ容器化分布式集群实战</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>算法</h2><!----></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/mds/%E7%AE%97%E6%B3%95/%E7%AD%89%E5%BE%85%E8%AE%B0%E5%BD%95%E4%B8%AD.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>等待记录中</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5a346dfe data-v-669faec9><div class="VPDoc has-sidebar has-aside" data-v-669faec9 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-935f8a84><div class="content" data-v-935f8a84><div class="outline-marker" data-v-935f8a84></div><div class="outline-title" role="heading" aria-level="2" data-v-935f8a84>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-935f8a84><span class="visually-hidden" id="doc-outline-aria-label" data-v-935f8a84> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-935f8a84 data-v-b933a997><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _mds_%E5%90%8E%E7%AB%AF_%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98_%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E7%9F%AD%E9%93%BE%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0" data-v-39a288b8><div><h1 id="业务背景-为啥需要短链" tabindex="-1">业务背景：为啥需要短链? <a class="header-anchor" href="#业务背景-为啥需要短链" aria-label="Permalink to &quot;业务背景：为啥需要短链?&quot;">​</a></h1><h2 id="公司电商产品推广、业务活动⻚、广告落地⻚缺少实时【数据反馈和渠道效果分析】" tabindex="-1">公司电商产品推广、业务活动⻚、广告落地⻚缺少实时【数据反馈和渠道效果分析】 <a class="header-anchor" href="#公司电商产品推广、业务活动⻚、广告落地⻚缺少实时【数据反馈和渠道效果分析】" aria-label="Permalink to &quot;公司电商产品推广、业务活动⻚、广告落地⻚缺少实时【数据反馈和渠道效果分析】&quot;">​</a></h2><h2 id="老项目业务推广【没人维护-无法做埋点】需要统计效果" tabindex="-1">老项目业务推广【没人维护，无法做埋点】需要统计效果 <a class="header-anchor" href="#老项目业务推广【没人维护-无法做埋点】需要统计效果" aria-label="Permalink to &quot;老项目业务推广【没人维护，无法做埋点】需要统计效果&quot;">​</a></h2><h2 id="app和营销活动发送营销短信链接过⻓-【浪费短信发送费用】" tabindex="-1">APP和营销活动发送营销短信链接过⻓，【浪费短信发送费用】 <a class="header-anchor" href="#app和营销活动发送营销短信链接过⻓-【浪费短信发送费用】" aria-label="Permalink to &quot;APP和营销活动发送营销短信链接过⻓，【浪费短信发送费用】&quot;">​</a></h2><h2 id="saas平台盈利" tabindex="-1">SaaS平台盈利 <a class="header-anchor" href="#saas平台盈利" aria-label="Permalink to &quot;SaaS平台盈利&quot;">​</a></h2><h3 id="用户按量付费-根据流量包选择付费购买对应的套餐" tabindex="-1">用户按量付费，根据流量包选择付费购买对应的套餐 <a class="header-anchor" href="#用户按量付费-根据流量包选择付费购买对应的套餐" aria-label="Permalink to &quot;用户按量付费，根据流量包选择付费购买对应的套餐&quot;">​</a></h3><h3 id="不同流量包权益不一样" tabindex="-1">不同流量包权益不一样 <a class="header-anchor" href="#不同流量包权益不一样" aria-label="Permalink to &quot;不同流量包权益不一样&quot;">​</a></h3><h4 id="每天可以创建的短链次数不一样" tabindex="-1">每天可以创建的短链次数不一样 <a class="header-anchor" href="#每天可以创建的短链次数不一样" aria-label="Permalink to &quot;每天可以创建的短链次数不一样&quot;">​</a></h4><h4 id="流量包使用时间限制、支持流量包叠加" tabindex="-1">流量包使用时间限制、支持流量包叠加 <a class="header-anchor" href="#流量包使用时间限制、支持流量包叠加" aria-label="Permalink to &quot;流量包使用时间限制、支持流量包叠加&quot;">​</a></h4><h4 id="注册用户每天有一定免费使用次数-但是不能查看数据" tabindex="-1">注册用户每天有一定免费使用次数，但是不能查看数据 <a class="header-anchor" href="#注册用户每天有一定免费使用次数-但是不能查看数据" aria-label="Permalink to &quot;注册用户每天有一定免费使用次数，但是不能查看数据&quot;">​</a></h4><h1 id="为什么需要学方法论" tabindex="-1">为什么需要学方法论 <a class="header-anchor" href="#为什么需要学方法论" aria-label="Permalink to &quot;为什么需要学方法论&quot;">​</a></h1><h2 id="方法论-通俗来说就是【做事套路-解决问题的方法-手段-途径-工具-】" tabindex="-1">方法论: 通俗来说就是【做事套路，解决问题的方法(手段/途径/工具)】 <a class="header-anchor" href="#方法论-通俗来说就是【做事套路-解决问题的方法-手段-途径-工具-】" aria-label="Permalink to &quot;方法论: 通俗来说就是【做事套路，解决问题的方法(手段/途径/工具)】&quot;">​</a></h2><h3 id="为什么要学方法论-常⻅的有哪些是必备的" tabindex="-1">为什么要学方法论，常⻅的有哪些是必备的 <a class="header-anchor" href="#为什么要学方法论-常⻅的有哪些是必备的" aria-label="Permalink to &quot;为什么要学方法论，常⻅的有哪些是必备的&quot;">​</a></h3><h4 id="新业务规划-pest" tabindex="-1">新业务规划(PEST) <a class="header-anchor" href="#新业务规划-pest" aria-label="Permalink to &quot;新业务规划(PEST)&quot;">​</a></h4><h5 id="指的是政治-political-、经济-economic-、社会-social-和技术-technological" tabindex="-1">指的是政治(Political)、经济(Economic)、社会 (Social)和技术(Technological) <a class="header-anchor" href="#指的是政治-political-、经济-economic-、社会-social-和技术-technological" aria-label="Permalink to &quot;指的是政治(Political)、经济(Economic)、社会 (Social)和技术(Technological)&quot;">​</a></h5><h6 id="政治环境主要是看我们的国家现在是否鼓励相关的业务" tabindex="-1">政治环境主要是看我们的国家现在是否鼓励相关的业务 <a class="header-anchor" href="#政治环境主要是看我们的国家现在是否鼓励相关的业务" aria-label="Permalink to &quot;政治环境主要是看我们的国家现在是否鼓励相关的业务&quot;">​</a></h6><h6 id="经济环境又可以分为宏观经济和微观经济-包括居⺠消费水平、产业结构" tabindex="-1">经济环境又可以分为宏观经济和微观经济，包括居⺠消费水平、产业结构 <a class="header-anchor" href="#经济环境又可以分为宏观经济和微观经济-包括居⺠消费水平、产业结构" aria-label="Permalink to &quot;经济环境又可以分为宏观经济和微观经济，包括居⺠消费水平、产业结构&quot;">​</a></h6><h6 id="社会环境则是说跟社会的⻛俗习惯是否吻合" tabindex="-1">社会环境则是说跟社会的⻛俗习惯是否吻合 <a class="header-anchor" href="#社会环境则是说跟社会的⻛俗习惯是否吻合" aria-label="Permalink to &quot;社会环境则是说跟社会的⻛俗习惯是否吻合&quot;">​</a></h6><h6 id="技术环境当然就是说的我们的技术实力-asml光刻机" tabindex="-1">技术环境当然就是说的我们的技术实力(ASML光刻机) <a class="header-anchor" href="#技术环境当然就是说的我们的技术实力-asml光刻机" aria-label="Permalink to &quot;技术环境当然就是说的我们的技术实力(ASML光刻机)&quot;">​</a></h6><h4 id="运营推广-aarrr" tabindex="-1">运营推广(AARRR) <a class="header-anchor" href="#运营推广-aarrr" aria-label="Permalink to &quot;运营推广(AARRR)&quot;">​</a></h4><h5 id="什么是aarrr用户增⻓模型" tabindex="-1">什么是AARRR用户增⻓模型 <a class="header-anchor" href="#什么是aarrr用户增⻓模型" aria-label="Permalink to &quot;什么是AARRR用户增⻓模型&quot;">​</a></h5><h6 id="aarrr是acquisition、activation、retention、revenue、-referral-五个单词的缩写-对应用户生命周期中的5个重要环节。" tabindex="-1">AARRR是Acquisition、Activation、Retention、Revenue、 Referral 五个单词的缩写，对应用户生命周期中的5个重要环节。 <a class="header-anchor" href="#aarrr是acquisition、activation、retention、revenue、-referral-五个单词的缩写-对应用户生命周期中的5个重要环节。" aria-label="Permalink to &quot;AARRR是Acquisition、Activation、Retention、Revenue、 Referral 五个单词的缩写，对应用户生命周期中的5个重要环节。&quot;">​</a></h6><h6 id="通俗来说就是一个产品从0-1到100的方法论" tabindex="-1">通俗来说就是一个产品从0~1到100的方法论 <a class="header-anchor" href="#通俗来说就是一个产品从0-1到100的方法论" aria-label="Permalink to &quot;通俗来说就是一个产品从0~1到100的方法论&quot;">​</a></h6><h6 id="指引产品运营在不同的产品运营阶段-思考哪些关键节点-更好各个节点的指标数据" tabindex="-1">指引产品运营在不同的产品运营阶段，思考哪些关键节点，更好各个节点的指标数据 <a class="header-anchor" href="#指引产品运营在不同的产品运营阶段-思考哪些关键节点-更好各个节点的指标数据" aria-label="Permalink to &quot;指引产品运营在不同的产品运营阶段，思考哪些关键节点，更好各个节点的指标数据&quot;">​</a></h6><h5 id="aarrr详细解释" tabindex="-1">AARRR详细解释 <a class="header-anchor" href="#aarrr详细解释" aria-label="Permalink to &quot;AARRR详细解释&quot;">​</a></h5><h6 id="获取-新用户首单免费-低价-瑞幸、拼多多-、厂商预装-手-机-、买量投放" tabindex="-1">获取：新用户首单免费/低价(瑞幸、拼多多)、厂商预装(手 机)、买量投放 <a class="header-anchor" href="#获取-新用户首单免费-低价-瑞幸、拼多多-、厂商预装-手-机-、买量投放" aria-label="Permalink to &quot;获取：新用户首单免费/低价(瑞幸、拼多多)、厂商预装(手 机)、买量投放&quot;">​</a></h6><h6 id="激活-app推送、短信推送、产品价值激活" tabindex="-1">激活：app推送、短信推送、产品价值激活 <a class="header-anchor" href="#激活-app推送、短信推送、产品价值激活" aria-label="Permalink to &quot;激活：app推送、短信推送、产品价值激活&quot;">​</a></h6><h6 id="留存-签到、活动短信推送、平台价值提供" tabindex="-1">留存：签到、活动短信推送、平台价值提供 <a class="header-anchor" href="#留存-签到、活动短信推送、平台价值提供" aria-label="Permalink to &quot;留存：签到、活动短信推送、平台价值提供&quot;">​</a></h6><h6 id="收益-平台广告、电商变现、付费会员、融资、软件服务" tabindex="-1">收益：平台广告、电商变现、付费会员、融资、软件服务 <a class="header-anchor" href="#收益-平台广告、电商变现、付费会员、融资、软件服务" aria-label="Permalink to &quot;收益：平台广告、电商变现、付费会员、融资、软件服务&quot;">​</a></h6><h6 id="传播-好友助力、分享抽奖、兄弟砍我一刀" tabindex="-1">传播：好友助力、分享抽奖、兄弟砍我一刀 <a class="header-anchor" href="#传播-好友助力、分享抽奖、兄弟砍我一刀" aria-label="Permalink to &quot;传播：好友助力、分享抽奖、兄弟砍我一刀&quot;">​</a></h6><h4 id="swot态势分析法" tabindex="-1">SWOT态势分析法 <a class="header-anchor" href="#swot态势分析法" aria-label="Permalink to &quot;SWOT态势分析法&quot;">​</a></h4><h5 id="官方-用来确定企业自身的竞争优势、劣势、外部市场的机会和威胁-从而将公司的战略与公司内部资源、外部环境有机地结合起来的一种科学的分析方法" tabindex="-1">官方: 用来确定企业自身的竞争优势、劣势、外部市场的机会和威胁，从而将公司的战略与公司内部资源、外部环境有机地结合起来的一种科学的分析方法 <a class="header-anchor" href="#官方-用来确定企业自身的竞争优势、劣势、外部市场的机会和威胁-从而将公司的战略与公司内部资源、外部环境有机地结合起来的一种科学的分析方法" aria-label="Permalink to &quot;官方: 用来确定企业自身的竞争优势、劣势、外部市场的机会和威胁，从而将公司的战略与公司内部资源、外部环境有机地结合起来的一种科学的分析方法&quot;">​</a></h5><h5 id="_4个单词的缩写-优势-strength、劣势-weakness、机会-opportunity、威胁-threats" tabindex="-1">4个单词的缩写 优势=strength、劣势=weakness、机会 =opportunity、威胁=threats <a class="header-anchor" href="#_4个单词的缩写-优势-strength、劣势-weakness、机会-opportunity、威胁-threats" aria-label="Permalink to &quot;4个单词的缩写 优势=strength、劣势=weakness、机会 =opportunity、威胁=threats&quot;">​</a></h5><h6 id="优势和弱势是内部环境的分析-机会和威胁是对于外部环境的分析" tabindex="-1">优势和弱势是内部环境的分析，机会和威胁是对于外部环境的分析 <a class="header-anchor" href="#优势和弱势是内部环境的分析-机会和威胁是对于外部环境的分析" aria-label="Permalink to &quot;优势和弱势是内部环境的分析，机会和威胁是对于外部环境的分析&quot;">​</a></h6><h6 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h6><ul><li>外部的机会正好是你的优势，赶紧利用起来</li><li>外部的机会但是你的劣势，需要改进</li><li>自身具有优势但外部存在威胁，就需要时刻思考、保持警惕</li><li>是威胁又是你的劣势，就规避并消除</li></ul><p><img src="/images/4f93cb5db925cb773d6c7b9ee0b25204.jpeg" alt=""></p><h4 id="团队管理-smart" tabindex="-1">团队管理(SMART) <a class="header-anchor" href="#团队管理-smart" aria-label="Permalink to &quot;团队管理(SMART)&quot;">​</a></h4><h5 id="源于国外管理大师的《管理的实践》" tabindex="-1">源于国外管理大师的《管理的实践》 <a class="header-anchor" href="#源于国外管理大师的《管理的实践》" aria-label="Permalink to &quot;源于国外管理大师的《管理的实践》&quot;">​</a></h5><h5 id="是为了利于员工更加明确高效地工作-更是为了管理者将来对员工实施绩效考核提供了考核目标和考核标准-使考核更加科学化、规范化" tabindex="-1">是为了利于员工更加明确高效地工作，更是为了管理者将来对员工实施绩效考核提供了考核目标和考核标准，使考核更加科学化、规范化 <a class="header-anchor" href="#是为了利于员工更加明确高效地工作-更是为了管理者将来对员工实施绩效考核提供了考核目标和考核标准-使考核更加科学化、规范化" aria-label="Permalink to &quot;是为了利于员工更加明确高效地工作，更是为了管理者将来对员工实施绩效考核提供了考核目标和考核标准，使考核更加科学化、规范化&quot;">​</a></h5><h5 id="是5个单词的缩写" tabindex="-1">是5个单词的缩写 <a class="header-anchor" href="#是5个单词的缩写" aria-label="Permalink to &quot;是5个单词的缩写&quot;">​</a></h5><h6 id="specific-目标要具体" tabindex="-1">Specific: 目标要具体 <a class="header-anchor" href="#specific-目标要具体" aria-label="Permalink to &quot;Specific: 目标要具体&quot;">​</a></h6><h6 id="measurable-目标成果要可衡量-量化" tabindex="-1">Measurable: 目标成果要可衡量(量化) <a class="header-anchor" href="#measurable-目标成果要可衡量-量化" aria-label="Permalink to &quot;Measurable: 目标成果要可衡量(量化)&quot;">​</a></h6><h6 id="attainable-目标要可实现-避免过高-过低" tabindex="-1">Attainable: 目标要可实现，避免过高/过低 <a class="header-anchor" href="#attainable-目标要可实现-避免过高-过低" aria-label="Permalink to &quot;Attainable: 目标要可实现，避免过高/过低&quot;">​</a></h6><h6 id="relevant-与其他目标有一定的相关性" tabindex="-1">Relevant: 与其他目标有一定的相关性 <a class="header-anchor" href="#relevant-与其他目标有一定的相关性" aria-label="Permalink to &quot;Relevant: 与其他目标有一定的相关性&quot;">​</a></h6><h6 id="time-bound-目标必须有明确的期限" tabindex="-1">Time bound: 目标必须有明确的期限 <a class="header-anchor" href="#time-bound-目标必须有明确的期限" aria-label="Permalink to &quot;Time bound: 目标必须有明确的期限&quot;">​</a></h6><p>意义: 在制定工作目标或者任务目标时，考虑一下目标与计划是不是SMART化的。只有具备SMART化的计划才是具有良好可实施性的，也才能指导保证计划得以实现</p><h1 id="开发规范" tabindex="-1">开发规范 <a class="header-anchor" href="#开发规范" aria-label="Permalink to &quot;开发规范&quot;">​</a></h1><h2 id="开发人员" tabindex="-1">开发人员 <a class="header-anchor" href="#开发人员" aria-label="Permalink to &quot;开发人员&quot;">​</a></h2><h3 id="总负责人-1" tabindex="-1">总负责人：1 <a class="header-anchor" href="#总负责人-1" aria-label="Permalink to &quot;总负责人：1&quot;">​</a></h3><p>| ### 岗位 | ### 运营+市场 | ### 设计 | ### 技术 | ### 产品 | | --- | --- | --- | --- | --- | | ### 负责人 | ### 1 | ### 1 | ### 1 | ### 1 | | ### 相关人员 | ### 用户运营1、内容运营1、渠道投放1、KA客户 | ### 1 | ### 后端4、前端2、测试1、运维1 | ### 产品需求1、数据分析1 |</p><h3 id="项目业务的1号位-负责总把控各个事项-也是背负最大kpi压力的人-做的好也是最受益的人" tabindex="-1">项目业务的1号位，负责总把控各个事项，也是背负最大KPI压力的人，做的好也是最受益的人 <a class="header-anchor" href="#项目业务的1号位-负责总把控各个事项-也是背负最大kpi压力的人-做的好也是最受益的人" aria-label="Permalink to &quot;项目业务的1号位，负责总把控各个事项，也是背负最大KPI压力的人，做的好也是最受益的人&quot;">​</a></h3><h3 id="岗位负责人-1号位正常都是带多个项目的-很少可能只带一个项目-基本只和岗位负责人进行对接岗位负责人负责团的组建和管理" tabindex="-1">岗位负责人：1号位正常都是带多个项目的，很少可能只带一个项目，基本只和岗位负责人进行对接岗位负责人负责团的组建和管理 <a class="header-anchor" href="#岗位负责人-1号位正常都是带多个项目的-很少可能只带一个项目-基本只和岗位负责人进行对接岗位负责人负责团的组建和管理" aria-label="Permalink to &quot;岗位负责人：1号位正常都是带多个项目的，很少可能只带一个项目，基本只和岗位负责人进行对接岗位负责人负责团的组建和管理&quot;">​</a></h3><h2 id="一定要避免单点故障" tabindex="-1">一定要避免单点故障 <a class="header-anchor" href="#一定要避免单点故障" aria-label="Permalink to &quot;一定要避免单点故障&quot;">​</a></h2><h3 id="一个微服务起码两个人熟悉-一个是主程一个是技术leader-推荐是团队里面两个开发人员" tabindex="-1">一个微服务起码两个人熟悉：一个是主程一个是技术leader，推荐是团队里面两个开发人员 <a class="header-anchor" href="#一个微服务起码两个人熟悉-一个是主程一个是技术leader-推荐是团队里面两个开发人员" aria-label="Permalink to &quot;一个微服务起码两个人熟悉：一个是主程一个是技术leader，推荐是团队里面两个开发人员&quot;">​</a></h3><h2 id="n方库说明" tabindex="-1">N方库说明 <a class="header-anchor" href="#n方库说明" aria-label="Permalink to &quot;N方库说明&quot;">​</a></h2><h3 id="一方库-本工程内部子项目模块依赖的库-jar包-。" tabindex="-1">一方库: 本工程内部子项目模块依赖的库(jar包)。 <a class="header-anchor" href="#一方库-本工程内部子项目模块依赖的库-jar包-。" aria-label="Permalink to &quot;一方库: 本工程内部子项目模块依赖的库(jar包)。&quot;">​</a></h3><h3 id="二方库-公司内部发布到中央仓库-可供公司内部其它应用依赖的库-jar包-。" tabindex="-1">二方库: 公司内部发布到中央仓库，可供公司内部其它应用依赖的库 (jar包)。 <a class="header-anchor" href="#二方库-公司内部发布到中央仓库-可供公司内部其它应用依赖的库-jar包-。" aria-label="Permalink to &quot;二方库: 公司内部发布到中央仓库，可供公司内部其它应用依赖的库 (jar包)。&quot;">​</a></h3><h3 id="三方库-公司之外的开源库-jar包-。" tabindex="-1">三方库: 公司之外的开源库(jar包)。 <a class="header-anchor" href="#三方库-公司之外的开源库-jar包-。" aria-label="Permalink to &quot;三方库: 公司之外的开源库(jar包)。&quot;">​</a></h3><h2 id="pojo实体类" tabindex="-1">POJO实体类 <a class="header-anchor" href="#pojo实体类" aria-label="Permalink to &quot;POJO实体类&quot;">​</a></h2><h3 id="pojo-plain-ordinary-java-object-在手册中-pojo-专指只有-setter-getter-tostring-的简单类-包括do-dto-bo-vo-等-禁止命名成xxxpojo" tabindex="-1">POJO(Plain Ordinary Java Object): 在手册中，POJO 专指只有 setter / getter / toString 的简单类，包括DO/DTO/BO/VO 等，禁止命名成xxxPOJO <a class="header-anchor" href="#pojo-plain-ordinary-java-object-在手册中-pojo-专指只有-setter-getter-tostring-的简单类-包括do-dto-bo-vo-等-禁止命名成xxxpojo" aria-label="Permalink to &quot;POJO(Plain Ordinary Java Object): 在手册中，POJO 专指只有 setter / getter / toString 的简单类，包括DO/DTO/BO/VO 等，禁止命名成xxxPOJO&quot;">​</a></h3><h2 id="各个层级约束规范" tabindex="-1">各个层级约束规范 <a class="header-anchor" href="#各个层级约束规范" aria-label="Permalink to &quot;各个层级约束规范&quot;">​</a></h2><h3 id="service-dao层方法命名规约" tabindex="-1">Service/DAO层方法命名规约 <a class="header-anchor" href="#service-dao层方法命名规约" aria-label="Permalink to &quot;Service/DAO层方法命名规约&quot;">​</a></h3><h4 id="获取单个对象的方法用get做前缀。" tabindex="-1">获取单个对象的方法用get做前缀。 <a class="header-anchor" href="#获取单个对象的方法用get做前缀。" aria-label="Permalink to &quot;获取单个对象的方法用get做前缀。&quot;">​</a></h4><h4 id="获取多个对象的方法用list做前缀-复数形式结尾-如-listobjects。" tabindex="-1">获取多个对象的方法用list做前缀，复数形式结尾，如: listObjects。 <a class="header-anchor" href="#获取多个对象的方法用list做前缀-复数形式结尾-如-listobjects。" aria-label="Permalink to &quot;获取多个对象的方法用list做前缀，复数形式结尾，如: listObjects。&quot;">​</a></h4><h4 id="获取统计值的方法用count做前缀。" tabindex="-1">获取统计值的方法用count做前缀。 <a class="header-anchor" href="#获取统计值的方法用count做前缀。" aria-label="Permalink to &quot;获取统计值的方法用count做前缀。&quot;">​</a></h4><h4 id="插入的方法用save-insert做前缀。" tabindex="-1">插入的方法用save/insert做前缀。 <a class="header-anchor" href="#插入的方法用save-insert做前缀。" aria-label="Permalink to &quot;插入的方法用save/insert做前缀。&quot;">​</a></h4><h4 id="删除的方法用remove-delete做前缀。" tabindex="-1">删除的方法用remove/delete做前缀。 <a class="header-anchor" href="#删除的方法用remove-delete做前缀。" aria-label="Permalink to &quot;删除的方法用remove/delete做前缀。&quot;">​</a></h4><h4 id="修改的方法用update做前缀。" tabindex="-1">修改的方法用update做前缀。 <a class="header-anchor" href="#修改的方法用update做前缀。" aria-label="Permalink to &quot;修改的方法用update做前缀。&quot;">​</a></h4><h3 id="领域模型命名规约" tabindex="-1">领域模型命名规约 <a class="header-anchor" href="#领域模型命名规约" aria-label="Permalink to &quot;领域模型命名规约&quot;">​</a></h3><h4 id="数据对象-xxxdo-xxx即为数据表名。" tabindex="-1">数据对象: xxxDO，xxx即为数据表名。 <a class="header-anchor" href="#数据对象-xxxdo-xxx即为数据表名。" aria-label="Permalink to &quot;数据对象: xxxDO，xxx即为数据表名。&quot;">​</a></h4><h4 id="一般数据传输对象-xxxdto-xxx为业务领域相关的名称-项目里面也用vo。" tabindex="-1">一般数据传输对象: xxxDTO，xxx为业务领域相关的名称，项目里面也用VO。 <a class="header-anchor" href="#一般数据传输对象-xxxdto-xxx为业务领域相关的名称-项目里面也用vo。" aria-label="Permalink to &quot;一般数据传输对象: xxxDTO，xxx为业务领域相关的名称，项目里面也用VO。&quot;">​</a></h4><h4 id="展示对象-xxxvo-也就是响应给前端的实体包装类。" tabindex="-1">展示对象: xxxVO，也就是响应给前端的实体包装类。 <a class="header-anchor" href="#展示对象-xxxvo-也就是响应给前端的实体包装类。" aria-label="Permalink to &quot;展示对象: xxxVO，也就是响应给前端的实体包装类。&quot;">​</a></h4><h4 id="接收前端json对象请求的命名为xxxrequest" tabindex="-1">接收前端json对象请求的命名为XXXRequest <a class="header-anchor" href="#接收前端json对象请求的命名为xxxrequest" aria-label="Permalink to &quot;接收前端json对象请求的命名为XXXRequest&quot;">​</a></h4><h2 id="manager分层说明" tabindex="-1">Manager分层说明 <a class="header-anchor" href="#manager分层说明" aria-label="Permalink to &quot;Manager分层说明&quot;">​</a></h2><h3 id="通用业务处理层-它有如下特征" tabindex="-1">通用业务处理层，它有如下特征 <a class="header-anchor" href="#通用业务处理层-它有如下特征" aria-label="Permalink to &quot;通用业务处理层，它有如下特征&quot;">​</a></h3><h4 id="对第三方平台封装的层-预处理返回结果及转化异常信息" tabindex="-1">对第三方平台封装的层，预处理返回结果及转化异常信息 <a class="header-anchor" href="#对第三方平台封装的层-预处理返回结果及转化异常信息" aria-label="Permalink to &quot;对第三方平台封装的层，预处理返回结果及转化异常信息&quot;">​</a></h4><h4 id="对service层通用能力的下沉-如缓存方案、中间件通用处理" tabindex="-1">对Service层通用能力的下沉，如缓存方案、中间件通用处理 <a class="header-anchor" href="#对service层通用能力的下沉-如缓存方案、中间件通用处理" aria-label="Permalink to &quot;对Service层通用能力的下沉，如缓存方案、中间件通用处理&quot;">​</a></h4><h4 id="与dao层交互-对多个dao的组合复用。" tabindex="-1">与DAO层交互，对多个DAO的组合复用。 <a class="header-anchor" href="#与dao层交互-对多个dao的组合复用。" aria-label="Permalink to &quot;与DAO层交互，对多个DAO的组合复用。&quot;">​</a></h4><p><img src="/images/c87979356f43e91f6c18e347177f1f06.png" alt="image.png"></p><h1 id="统一接口响应协议-响应工具类封装" tabindex="-1">统一接口响应协议-响应工具类封装 <a class="header-anchor" href="#统一接口响应协议-响应工具类封装" aria-label="Permalink to &quot;统一接口响应协议-响应工具类封装&quot;">​</a></h1><h2 id="_1-新建enums包-在新建的包中新建bizcodeenum枚举。" tabindex="-1">1. 新建<code>enums</code>包，在新建的包中新建<code>BizCodeEnum</code>枚举。 <a class="header-anchor" href="#_1-新建enums包-在新建的包中新建bizcodeenum枚举。" aria-label="Permalink to &quot;1. 新建`enums`包，在新建的包中新建`BizCodeEnum`枚举。&quot;">​</a></h2><h3 id="统一业务状态码-bizcodeenum-这是一个枚举类。" tabindex="-1">统一业务状态码 <code>BizCodeEnum</code>，这是一个枚举类。 <a class="header-anchor" href="#统一业务状态码-bizcodeenum-这是一个枚举类。" aria-label="Permalink to &quot;统一业务状态码 `BizCodeEnum`，这是一个枚举类。&quot;">​</a></h3><h2 id="_2-新建util包-在新建的包中新建jsondata类。" tabindex="-1">2. 新建<code>util</code>包，在新建的包中新建<code>JsonData</code>类。 <a class="header-anchor" href="#_2-新建util包-在新建的包中新建jsondata类。" aria-label="Permalink to &quot;2. 新建`util`包，在新建的包中新建`JsonData`类。&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AllArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NoArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JsonData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 状态码 0 表示成功</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer code;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object data;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 描述</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String msg;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *  获取远程调用数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *  注意事项：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *      支持多单词下划线专驼峰（序列化和反序列化）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> typeReference</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> &lt;T&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; T </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TypeReference&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">typeReference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JSON.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(JSON.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toJSONString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data),typeReference);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 成功，不传入数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JsonData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 成功，传入数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JsonData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 失败，传入描述信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JsonData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 自定义状态码和错误信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildCodeAndMsg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JsonData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, msg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 传入枚举，返回信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> codeEnum</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BizCodeEnum </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">codeEnum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildCodeAndMsg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(codeEnum.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),codeEnum.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="自定义全局异常-处理器开发" tabindex="-1">自定义全局异常+处理器开发 <a class="header-anchor" href="#自定义全局异常-处理器开发" aria-label="Permalink to &quot;自定义全局异常+处理器开发&quot;">​</a></h1><h2 id="_1-新建exception包-在新建的包中新建bizexception类。" tabindex="-1">1. 新建<code>exception</code>包，在新建的包中新建<code>BizException</code>类。 <a class="header-anchor" href="#_1-新建exception包-在新建的包中新建bizexception类。" aria-label="Permalink to &quot;1. 新建`exception`包，在新建的包中新建`BizException`类。&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Data</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BizException</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RuntimeException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> code;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String msg;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BizException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> code;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BizException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BizCodeEnum </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">bizCodeEnum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bizCodeEnum.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bizCodeEnum.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bizCodeEnum.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_2-继续-在新建的包中新建customexceptionhandler类-它是一个全局异常处理器。" tabindex="-1">2. 继续，在新建的包中新建<code>CustomExceptionHandler</code>类，它是一个全局异常处理器。 <a class="header-anchor" href="#_2-继续-在新建的包中新建customexceptionhandler类-它是一个全局异常处理器。" aria-label="Permalink to &quot;2. 继续，在新建的包中新建`CustomExceptionHandler`类，它是一个全局异常处理器。&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ControllerAdvice</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//@RestControllerAdvice</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomExceptionHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ExceptionHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Exception.class)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ResponseBody</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BizException){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            BizException bizException </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (BizException) e;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[业务异常]{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,e);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildCodeAndMsg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bizException.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),bizException.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMsg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[系统异常]{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,e);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;系统异常&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="common通用工具和时间格式化工具类" tabindex="-1">common通用工具和时间格式化工具类 <a class="header-anchor" href="#common通用工具和时间格式化工具类" aria-label="Permalink to &quot;common通用工具和时间格式化工具类&quot;">​</a></h1><h2 id="时间格式化工具类封装" tabindex="-1">时间格式化工具类封装 <a class="header-anchor" href="#时间格式化工具类封装" aria-label="Permalink to &quot;时间格式化工具类封装&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TimeUtil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 默认日期格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String DEFAULT_PATTERN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;yyyy-MM-dd HH:mm:ss&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 默认日期格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DateTimeFormatter DEFAULT_DATE_TIME_FORMATTER  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DateTimeFormatter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ofPattern</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DEFAULT_PATTERN);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ZoneId DEFAULT_ZONE_ID </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ZoneId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * LocalDateTime 转 字符串，指定日期格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> localDateTime</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> pattern</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LocalDateTime </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">localDateTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pattern</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        DateTimeFormatter formatter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DateTimeFormatter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ofPattern</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pattern);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String timeStr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> formatter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(localDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">atZone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DEFAULT_ZONE_ID));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timeStr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * Date 转 字符串, 指定日期格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> time</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> pattern</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Date </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pattern</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        DateTimeFormatter formatter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DateTimeFormatter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ofPattern</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pattern);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String timeStr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> formatter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(time.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toInstant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">atZone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DEFAULT_ZONE_ID));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timeStr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *  Date 转 字符串，默认日期格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> time</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Date </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String timeStr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFAULT_DATE_TIME_FORMATTER.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(time.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toInstant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">atZone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DEFAULT_ZONE_ID));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timeStr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * timestamp 转 字符串，默认日期格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> timestamp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">long</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> timestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String timeStr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DEFAULT_DATE_TIME_FORMATTER.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(timestamp).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toInstant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">atZone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DEFAULT_ZONE_ID));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> timeStr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 字符串 转 Date</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> time</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Date </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strToDate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LocalDateTime localDateTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(time, DEFAULT_DATE_TIME_FORMATTER);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Date.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(localDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">atZone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DEFAULT_ZONE_ID).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toInstant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 获取当天剩余的秒数,用于流量包过期配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> currentDate</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRemainSecondsOneDay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Date </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">currentDate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LocalDateTime midnight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ofInstant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(currentDate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toInstant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        ZoneId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">plusDays</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withHour</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withMinute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withSecond</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">withNano</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LocalDateTime currentDateTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ofInstant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(currentDate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toInstant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ZoneId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> seconds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChronoUnit.SECONDS.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">between</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(currentDateTime, midnight);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) seconds;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="json序列化工具类封装" tabindex="-1">Json序列化工具类封装 <a class="header-anchor" href="#json序列化工具类封装" aria-label="Permalink to &quot;Json序列化工具类封装&quot;">​</a></h2><h3 id="生产环境不能用e-printstacktrace-输出堆栈-有性能影响。" tabindex="-1">生产环境不能用<code>e.printStackTrace()</code>输出堆栈，有性能影响。 <a class="header-anchor" href="#生产环境不能用e-printstacktrace-输出堆栈-有性能影响。" aria-label="Permalink to &quot;生产环境不能用`e.printStackTrace()`输出堆栈，有性能影响。&quot;">​</a></h3><p><img src="/images/914ebb8ef21159cb8b2bb03ad4bec2de.png" alt="image.png"></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JsonUtil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ObjectMapper mapper </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //设置可用单引号</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(JsonParser.Feature.ALLOW_SINGLE_QUOTES, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //序列化的时候序列对象的所有属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSerializationInclusion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(JsonInclude.Include.ALWAYS);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //反序列化的时候如果多了其他属性,不抛出异常</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //如果是空对象的时候,不抛异常</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SerializationFeature.FAIL_ON_EMPTY_BEANS, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //取消时间的转化格式,默认是时间戳,可以取消,同时需要设置要表现的时间格式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDateFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SimpleDateFormat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 对象转为Json字符串</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> obj</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">obj2Json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String jsonStr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            jsonStr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeValueAsString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (JsonProcessingException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //e.printStackTrace();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json格式化异常:{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jsonStr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * json字符串转为对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> jsonStr</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> beanType</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; T </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json2Obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">jsonStr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Class&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">beanType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        T obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jsonStr, beanType);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //e.printStackTrace();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json格式化异常:{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * json数据转换成pojo对象list</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> jsonData</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> beanType</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json2List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">jsonData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Class&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">beanType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        JavaType javaType </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getTypeFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">constructParametricType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(List.class, beanType);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jsonData, javaType);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //e.printStackTrace();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json格式化异常:{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 对象转为byte数组</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> obj</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">obj2Bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] byteArr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            byteArr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeValueAsBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (JsonProcessingException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //e.printStackTrace();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json格式化异常:{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> byteArr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * byte数组转为对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byteArr</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> beanType</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; T </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bytes2Obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">byteArr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Class&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">beanType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        T obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(byteArr, beanType);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //e.printStackTrace();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json格式化异常:{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="common工具大集合" tabindex="-1">common工具大集合 <a class="header-anchor" href="#common工具大集合" aria-label="Permalink to &quot;common工具大集合&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CommonUtil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 获取ip</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> request</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getIpAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpServletRequest </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x-forwarded-for&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ipAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;unknown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsIgnoreCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ipAddress)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Proxy-Client-IP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ipAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;unknown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsIgnoreCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ipAddress)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;WL-Proxy-Client-IP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ipAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;unknown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsIgnoreCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ipAddress)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRemoteAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ipAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // 根据网卡取本机配置的IP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    InetAddress inet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        inet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InetAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLocalHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (UnknownHostException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        // e.printStackTrace();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;获取ip异常&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> inet.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHostAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照&#39;,&#39;分割</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ipAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // &quot;***.***.***.***&quot;.length()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // = 15</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ipAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;,&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ipAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">substring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ipAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;,&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ipAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ipAddress;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 获取全部请求头</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> request</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAllRequestHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpServletRequest </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Enumeration&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; headerNames </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeaderNames</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (headerNames.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hasMoreElements</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (String) headerNames.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //根据名称获取请求头的值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key, value);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * MD5加密</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MD5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            MessageDigest md </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MessageDigest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MD5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] array </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> md.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UTF-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            StringBuilder sb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StringBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> array) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                sb.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toHexString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0xFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0x100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">substring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sb.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exception</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 获取验证码随机数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRandomCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String sources </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0123456789&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Random random </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        StringBuilder sb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StringBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> length; j</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            sb.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sources.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">charAt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(random.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sb.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 获取当前时间戳</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> long</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCurrentTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 生成uuid</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UUID.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">randomUUID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replaceAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">substring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 获取随机长度的串</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String ALL_CHAR_NUM </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStringNumRandom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //生成随机数字和字母,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Random random </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        StringBuilder saltString </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StringBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(length);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> length; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            saltString.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ALL_CHAR_NUM.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">charAt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(random.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ALL_CHAR_NUM.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> saltString.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 响应json数据给前端</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> response</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> obj</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sendJsonMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpServletResponse </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setContentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;application/json; charset=utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (PrintWriter writer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            writer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(JsonUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">obj2Json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flushBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (IOException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;响应json数据给前端异常:{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, e);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="q-海量数据下每天免费次数怎么更新" tabindex="-1">Q: 海量数据下每天免费次数怎么更新? <a class="header-anchor" href="#q-海量数据下每天免费次数怎么更新" aria-label="Permalink to &quot;Q: 海量数据下每天免费次数怎么更新?&quot;">​</a></h1><p>记录中...</p><h1 id="q-海量数据付费流量套餐包每天次数限制怎么更新" tabindex="-1">Q: 海量数据付费流量套餐包每天次数限制怎么更新? <a class="header-anchor" href="#q-海量数据付费流量套餐包每天次数限制怎么更新" aria-label="Permalink to &quot;Q: 海量数据付费流量套餐包每天次数限制怎么更新?&quot;">​</a></h1><p>记录中...</p><h1 id="q-高性能扣减流量包设计怎么做" tabindex="-1">Q: 高性能扣减流量包设计怎么做? <a class="header-anchor" href="#q-高性能扣减流量包设计怎么做" aria-label="Permalink to &quot;Q: 高性能扣减流量包设计怎么做?&quot;">​</a></h1><p>记录中...</p><h1 id="q-流量包数据更新处理-高并发下分布式事务怎么解决" tabindex="-1">Q: 流量包数据更新处理-高并发下分布式事务怎么解决 <a class="header-anchor" href="#q-流量包数据更新处理-高并发下分布式事务怎么解决" aria-label="Permalink to &quot;Q: 流量包数据更新处理-高并发下分布式事务怎么解决&quot;">​</a></h1><p>记录中...</p><h1 id="账号微服务注册模块-短信验证码" tabindex="-1">账号微服务注册模块+短信验证码 <a class="header-anchor" href="#账号微服务注册模块-短信验证码" aria-label="Permalink to &quot;账号微服务注册模块+短信验证码&quot;">​</a></h1><h2 id="功能需求" tabindex="-1">功能需求 <a class="header-anchor" href="#功能需求" aria-label="Permalink to &quot;功能需求&quot;">​</a></h2><h3 id="使用手机号注册-已经注册的手机号不能︎重复注册-密码不能使用简单的md5加密" tabindex="-1">使用手机号注册，已经注册的手机号不能︎重复注册，密码不能使用简单的MD5加密 <a class="header-anchor" href="#使用手机号注册-已经注册的手机号不能︎重复注册-密码不能使用简单的md5加密" aria-label="Permalink to &quot;使用手机号注册，已经注册的手机号不能︎重复注册，密码不能使用简单的MD5加密&quot;">​</a></h3><h3 id="用户上传头像需要用文件存储" tabindex="-1">用户上传头像需要用文件存储 <a class="header-anchor" href="#用户上传头像需要用文件存储" aria-label="Permalink to &quot;用户上传头像需要用文件存储&quot;">​</a></h3><h2 id="安全需求" tabindex="-1">安全需求 <a class="header-anchor" href="#安全需求" aria-label="Permalink to &quot;安全需求&quot;">​</a></h2><h3 id="高并发下账号唯一性-注册邮箱或者手机验证码不能被恶意调用" tabindex="-1">高并发下账号唯一性，注册邮箱或者手机验证码不能被恶意调用 <a class="header-anchor" href="#高并发下账号唯一性-注册邮箱或者手机验证码不能被恶意调用" aria-label="Permalink to &quot;高并发下账号唯一性，注册邮箱或者手机验证码不能被恶意调用&quot;">​</a></h3><h4 id="验证码-唯一索引" tabindex="-1">验证码+唯一索引 <a class="header-anchor" href="#验证码-唯一索引" aria-label="Permalink to &quot;验证码+唯一索引&quot;">​</a></h4><h3 id="头像文件存储访问方便扩容和管理" tabindex="-1">头像文件存储访问方便扩容和管理 <a class="header-anchor" href="#头像文件存储访问方便扩容和管理" aria-label="Permalink to &quot;头像文件存储访问方便扩容和管理&quot;">​</a></h3><h4 id="阿里云oss" tabindex="-1">阿里云OSS <a class="header-anchor" href="#阿里云oss" aria-label="Permalink to &quot;阿里云OSS&quot;">​</a></h4><h3 id="高并发处理" tabindex="-1">高并发处理 <a class="header-anchor" href="#高并发处理" aria-label="Permalink to &quot;高并发处理&quot;">​</a></h3><h4 id="异步-池化思想" tabindex="-1">异步+池化思想 <a class="header-anchor" href="#异步-池化思想" aria-label="Permalink to &quot;异步+池化思想&quot;">​</a></h4><h2 id="短链平台选择" tabindex="-1">短链平台选择 <a class="header-anchor" href="#短链平台选择" aria-label="Permalink to &quot;短链平台选择&quot;">​</a></h2><h3 id="使用短信验证码注册" tabindex="-1">使用短信验证码注册 <a class="header-anchor" href="#使用短信验证码注册" aria-label="Permalink to &quot;使用短信验证码注册&quot;">​</a></h3><h3 id="头像存储使用阿里云oss" tabindex="-1">头像存储使用阿里云OSS <a class="header-anchor" href="#头像存储使用阿里云oss" aria-label="Permalink to &quot;头像存储使用阿里云OSS&quot;">​</a></h3><h1 id="jmeter压测" tabindex="-1">Jmeter压测 <a class="header-anchor" href="#jmeter压测" aria-label="Permalink to &quot;Jmeter压测&quot;">​</a></h1><h2 id="开源免费-功能强大-在互联网公司普遍使用" tabindex="-1">开源免费，功能强大，在互联网公司普遍使用 <a class="header-anchor" href="#开源免费-功能强大-在互联网公司普遍使用" aria-label="Permalink to &quot;开源免费，功能强大，在互联网公司普遍使用&quot;">​</a></h2><h1 id="常规压测流程" tabindex="-1">常规压测流程 <a class="header-anchor" href="#常规压测流程" aria-label="Permalink to &quot;常规压测流程&quot;">​</a></h1><h2 id="内网环境" tabindex="-1">内网环境 <a class="header-anchor" href="#内网环境" aria-label="Permalink to &quot;内网环境&quot;">​</a></h2><h2 id="非gui下压测" tabindex="-1">非GUI下压测 <a class="header-anchor" href="#非gui下压测" aria-label="Permalink to &quot;非GUI下压测&quot;">​</a></h2><h2 id="停止其他无关资源进程" tabindex="-1">停止其他无关资源进程 <a class="header-anchor" href="#停止其他无关资源进程" aria-label="Permalink to &quot;停止其他无关资源进程&quot;">​</a></h2><h2 id="压测机和被压测机器隔离" tabindex="-1">压测机和被压测机器隔离 <a class="header-anchor" href="#压测机和被压测机器隔离" aria-label="Permalink to &quot;压测机和被压测机器隔离&quot;">​</a></h2><h1 id="q-高并发下异步请求解决方案-async注解" tabindex="-1">Q: 高并发下异步请求解决方案-<code>@Async</code>注解 <a class="header-anchor" href="#q-高并发下异步请求解决方案-async注解" aria-label="Permalink to &quot;Q: 高并发下异步请求解决方案-`@Async`注解&quot;">​</a></h1><h2 id="同步发送请求在高并发下有性能问题-用测试工具压测结果" tabindex="-1">同步发送请求在高并发下有性能问题，用测试工具压测结果： <a class="header-anchor" href="#同步发送请求在高并发下有性能问题-用测试工具压测结果" aria-label="Permalink to &quot;同步发送请求在高并发下有性能问题，用测试工具压测结果：&quot;">​</a></h2><h3 id="错误-connection-timed-out" tabindex="-1">错误: Connection timed out <a class="header-anchor" href="#错误-connection-timed-out" aria-label="Permalink to &quot;错误: Connection timed out&quot;">​</a></h3><h3 id="_400到500qps" tabindex="-1">400到500qps <a class="header-anchor" href="#_400到500qps" aria-label="Permalink to &quot;400到500qps&quot;">​</a></h3><h2 id="解决方式是异步发送-池化思想" tabindex="-1">解决方式是异步发送+池化思想 <a class="header-anchor" href="#解决方式是异步发送-池化思想" aria-label="Permalink to &quot;解决方式是异步发送+池化思想&quot;">​</a></h2><h2 id="a-async组件" tabindex="-1">A: <code>@Async</code>组件 <a class="header-anchor" href="#a-async组件" aria-label="Permalink to &quot;A: `@Async`组件&quot;">​</a></h2><h3 id="使用场景" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景" aria-label="Permalink to &quot;使用场景&quot;">​</a></h3><h4 id="适用于处理log、发送邮件、短信-等" tabindex="-1">适用于处理log、发送邮件、短信......等 <a class="header-anchor" href="#适用于处理log、发送邮件、短信-等" aria-label="Permalink to &quot;适用于处理log、发送邮件、短信......等&quot;">​</a></h4><h4 id="涉及到网络io调用等操作" tabindex="-1">涉及到网络IO调用等操作 <a class="header-anchor" href="#涉及到网络io调用等操作" aria-label="Permalink to &quot;涉及到网络IO调用等操作&quot;">​</a></h4><h3 id="使用方式" tabindex="-1">使用方式 <a class="header-anchor" href="#使用方式" aria-label="Permalink to &quot;使用方式&quot;">​</a></h3><h4 id="启动类里面使用-enableasync注解开启功能-自动扫描" tabindex="-1">启动类里面使用<code>@EnableAsync</code>注解开启功能，自动扫描 <a class="header-anchor" href="#启动类里面使用-enableasync注解开启功能-自动扫描" aria-label="Permalink to &quot;启动类里面使用`@EnableAsync`注解开启功能，自动扫描&quot;">​</a></h4><h4 id="定义异步任务类并使用-component标记组件被容器扫描-异步方法加上-async" tabindex="-1">定义异步任务类并使用<code>@Component</code>标记组件被容器扫描，异步方法加上<code>@Async</code> <a class="header-anchor" href="#定义异步任务类并使用-component标记组件被容器扫描-异步方法加上-async" aria-label="Permalink to &quot;定义异步任务类并使用`@Component`标记组件被容器扫描，异步方法加上`@Async`&quot;">​</a></h4><h3 id="async失效情况" tabindex="-1"><code>@Async</code>失效情况 <a class="header-anchor" href="#async失效情况" aria-label="Permalink to &quot;`@Async`失效情况&quot;">​</a></h3><h4 id="注解-async的方法不是public方法" tabindex="-1">注解<code>@Async</code>的方法不是<code>public</code>方法 <a class="header-anchor" href="#注解-async的方法不是public方法" aria-label="Permalink to &quot;注解`@Async`的方法不是`public`方法&quot;">​</a></h4><h4 id="注解-async的返回值只能为void或者future" tabindex="-1">注解<code>@Async</code>的返回值只能为<code>void</code>或者<code>Future</code> <a class="header-anchor" href="#注解-async的返回值只能为void或者future" aria-label="Permalink to &quot;注解`@Async`的返回值只能为`void`或者`Future`&quot;">​</a></h4><h4 id="注解-async方法使用static修饰也会失效" tabindex="-1">注解<code>@Async</code>方法使用<code>static</code>修饰也会失效 <a class="header-anchor" href="#注解-async方法使用static修饰也会失效" aria-label="Permalink to &quot;注解`@Async`方法使用`static`修饰也会失效&quot;">​</a></h4><h4 id="spring无法扫描到异步类-没加注解-async-或-enableasync注解" tabindex="-1">spring无法扫描到异步类，没加注解<code>@Async</code> 或 <code>@EnableAsync</code>注解 <a class="header-anchor" href="#spring无法扫描到异步类-没加注解-async-或-enableasync注解" aria-label="Permalink to &quot;spring无法扫描到异步类，没加注解`@Async` 或 `@EnableAsync`注解&quot;">​</a></h4><h4 id="调用方与被调方不能在同一个类" tabindex="-1">调用方与被调方不能在同一个类 <a class="header-anchor" href="#调用方与被调方不能在同一个类" aria-label="Permalink to &quot;调用方与被调方不能在同一个类&quot;">​</a></h4><h5 id="spring-在扫描bean的时候会扫描方法上是否包含-async注解-动态地生成一个子类-即proxy代理类-当这个有注解的方法被调用的时候-实际上是由代理类来调用的-代理类在调用时增加异步作用" tabindex="-1">Spring 在扫描bean的时候会扫描方法上是否包含<code>@Async</code>注解，动态地生成一个子类(即proxy代理类)，当这个有注解的方法被调用的时候，实际上是由代理类来调用的，代理类在调用时增加异步作用 <a class="header-anchor" href="#spring-在扫描bean的时候会扫描方法上是否包含-async注解-动态地生成一个子类-即proxy代理类-当这个有注解的方法被调用的时候-实际上是由代理类来调用的-代理类在调用时增加异步作用" aria-label="Permalink to &quot;Spring 在扫描bean的时候会扫描方法上是否包含`@Async`注解，动态地生成一个子类(即proxy代理类)，当这个有注解的方法被调用的时候，实际上是由代理类来调用的，代理类在调用时增加异步作用&quot;">​</a></h5><h5 id="如果这个有注解的方法是被同一个类中的其他方法调用的-那么该方法的调用并没有通过代理类-而是直接通过原来的那个bean-所以就失效了" tabindex="-1">如果这个有注解的方法是被同一个类中的其他方法调用的，那么该方法的调用并没有通过代理类，而是直接通过原来的那个bean，所以就失效了 <a class="header-anchor" href="#如果这个有注解的方法是被同一个类中的其他方法调用的-那么该方法的调用并没有通过代理类-而是直接通过原来的那个bean-所以就失效了" aria-label="Permalink to &quot;如果这个有注解的方法是被同一个类中的其他方法调用的，那么该方法的调用并没有通过代理类，而是直接通过原来的那个bean，所以就失效了&quot;">​</a></h5><h5 id="所以调用方与被调方不能在同一个类-主要是使用了动态代理-同一个类的时候直接调用-不是通过生成的动态代理类调用" tabindex="-1">所以调用方与被调方不能在同一个类，主要是使用了动态代理，同一个类的时候直接调用，不是通过生成的动态代理类调用 <a class="header-anchor" href="#所以调用方与被调方不能在同一个类-主要是使用了动态代理-同一个类的时候直接调用-不是通过生成的动态代理类调用" aria-label="Permalink to &quot;所以调用方与被调方不能在同一个类，主要是使用了动态代理，同一个类的时候直接调用，不是通过生成的动态代理类调用&quot;">​</a></h5><h5 id="一般将要异步执行的方法单独抽取成一个类" tabindex="-1">一般将要异步执行的方法单独抽取成一个类 <a class="header-anchor" href="#一般将要异步执行的方法单独抽取成一个类" aria-label="Permalink to &quot;一般将要异步执行的方法单独抽取成一个类&quot;">​</a></h5><h4 id="类中需要使用-autowired或-resource等注解自动注入-不能自己手动new对象" tabindex="-1">类中需要使用<code>@Autowired</code>或<code>@Resource</code>等注解自动注入，不能自己手动new对象 <a class="header-anchor" href="#类中需要使用-autowired或-resource等注解自动注入-不能自己手动new对象" aria-label="Permalink to &quot;类中需要使用`@Autowired`或`@Resource`等注解自动注入，不能自己手动new对象&quot;">​</a></h4><h4 id="在async方法上标注-transactional是没用的-但在async方法调用的方法上标注-transactional是有效的" tabindex="-1">在Async方法上标注<code>@Transactional</code>是没用的，但在Async方法调用的方法上标注<code>@Transactional</code>是有效的 <a class="header-anchor" href="#在async方法上标注-transactional是没用的-但在async方法调用的方法上标注-transactional是有效的" aria-label="Permalink to &quot;在Async方法上标注`@Transactional`是没用的，但在Async方法调用的方法上标注`@Transactional`是有效的&quot;">​</a></h4><h3 id="线程池默认机制问题" tabindex="-1">线程池默认机制问题 <a class="header-anchor" href="#线程池默认机制问题" aria-label="Permalink to &quot;线程池默认机制问题&quot;">​</a></h3><h4 id="压测后很快跑完全部内容-是因为都在线程池内部的阻塞队列里面" tabindex="-1">压测后很快跑完全部内容，是因为都在线程池内部的阻塞队列里面 <a class="header-anchor" href="#压测后很快跑完全部内容-是因为都在线程池内部的阻塞队列里面" aria-label="Permalink to &quot;压测后很快跑完全部内容，是因为都在线程池内部的阻塞队列里面&quot;">​</a></h4><h4 id="极容易出现oom-或者消息丢失" tabindex="-1">极容易出现OOM，或者消息丢失 <a class="header-anchor" href="#极容易出现oom-或者消息丢失" aria-label="Permalink to &quot;极容易出现OOM，或者消息丢失&quot;">​</a></h4><h3 id="默认线程策略说明" tabindex="-1">默认线程策略说明 <a class="header-anchor" href="#默认线程策略说明" aria-label="Permalink to &quot;默认线程策略说明&quot;">​</a></h3><h4 id="代码位置" tabindex="-1">代码位置 <a class="header-anchor" href="#代码位置" aria-label="Permalink to &quot;代码位置&quot;">​</a></h4><h5 id="taskexecutionproperties" tabindex="-1"><code>TaskExecutionProperties</code> <a class="header-anchor" href="#taskexecutionproperties" aria-label="Permalink to &quot;`TaskExecutionProperties`&quot;">​</a></h5><h5 id="taskexecutionautoconfiguration" tabindex="-1"><code>TaskExecutionAutoConfiguration</code> <a class="header-anchor" href="#taskexecutionautoconfiguration" aria-label="Permalink to &quot;`TaskExecutionAutoConfiguration`&quot;">​</a></h5><h4 id="若未指定线程池-使用-async-注解时-将默认使用-spring-创建的-threadpooltaskexecutor。" tabindex="-1">若未指定线程池，使用 <code>@Async</code> 注解时，将默认使用 Spring 创建的 <code>ThreadPoolTaskExecutor</code>。 <a class="header-anchor" href="#若未指定线程池-使用-async-注解时-将默认使用-spring-创建的-threadpooltaskexecutor。" aria-label="Permalink to &quot;若未指定线程池，使用 `@Async` 注解时，将默认使用 Spring 创建的 `ThreadPoolTaskExecutor`。&quot;">​</a></h4><h4 id="核心线程数-8" tabindex="-1">核心线程数：8 <a class="header-anchor" href="#核心线程数-8" aria-label="Permalink to &quot;核心线程数：8&quot;">​</a></h4><h4 id="最大线程数-integer-max-value-约-21-亿多" tabindex="-1">最大线程数：<code>Integer.MAX_VALUE</code>（约 21 亿多） <a class="header-anchor" href="#最大线程数-integer-max-value-约-21-亿多" aria-label="Permalink to &quot;最大线程数：`Integer.MAX_VALUE`（约 21 亿多）&quot;">​</a></h4><h4 id="队列类型-linkedblockingqueue" tabindex="-1">队列类型：<code>LinkedBlockingQueue</code> <a class="header-anchor" href="#队列类型-linkedblockingqueue" aria-label="Permalink to &quot;队列类型：`LinkedBlockingQueue`&quot;">​</a></h4><h4 id="队列容量-integer-max-value" tabindex="-1">队列容量：<code>Integer.MAX_VALUE</code> <a class="header-anchor" href="#队列容量-integer-max-value" aria-label="Permalink to &quot;队列容量：`Integer.MAX_VALUE`&quot;">​</a></h4><h4 id="空闲线程保留时间-60-秒" tabindex="-1">空闲线程保留时间：60 秒 <a class="header-anchor" href="#空闲线程保留时间-60-秒" aria-label="Permalink to &quot;空闲线程保留时间：60 秒&quot;">​</a></h4><h4 id="线程池拒绝策略-abortpolicy" tabindex="-1">线程池拒绝策略：<code>AbortPolicy</code> <a class="header-anchor" href="#线程池拒绝策略-abortpolicy" aria-label="Permalink to &quot;线程池拒绝策略：`AbortPolicy`&quot;">​</a></h4><h3 id="线程池工作机制" tabindex="-1">线程池工作机制 <a class="header-anchor" href="#线程池工作机制" aria-label="Permalink to &quot;线程池工作机制&quot;">​</a></h3><h4 id="当新任务到达并且当前运行的线程数少于核心线程数时-线程池会创建新线程来处理任务-即使有空闲线程。" tabindex="-1">当新任务到达并且当前运行的线程数少于核心线程数时，线程池会创建新线程来处理任务，即使有空闲线程。 <a class="header-anchor" href="#当新任务到达并且当前运行的线程数少于核心线程数时-线程池会创建新线程来处理任务-即使有空闲线程。" aria-label="Permalink to &quot;当新任务到达并且当前运行的线程数少于核心线程数时，线程池会创建新线程来处理任务，即使有空闲线程。&quot;">​</a></h4><h4 id="当运行的线程数达到核心线程数但小于最大线程数时-新来的任务会被加入到队列中-如果队列已满-则会创建新线程-直到达到最大线程数-。" tabindex="-1">当运行的线程数达到核心线程数但小于最大线程数时，新来的任务会被加入到队列中（如果队列已满，则会创建新线程，直到达到最大线程数）。 <a class="header-anchor" href="#当运行的线程数达到核心线程数但小于最大线程数时-新来的任务会被加入到队列中-如果队列已满-则会创建新线程-直到达到最大线程数-。" aria-label="Permalink to &quot;当运行的线程数达到核心线程数但小于最大线程数时，新来的任务会被加入到队列中（如果队列已满，则会创建新线程，直到达到最大线程数）。&quot;">​</a></h4><h4 id="如果运行的线程数已经等于最大线程数-新来的任务将会根据配置的拒绝策略被处理-例如抛出异常、运行拒绝任务的处理程序等。" tabindex="-1">如果运行的线程数已经等于最大线程数，新来的任务将会根据配置的拒绝策略被处理，例如抛出异常、运行拒绝任务的处理程序等。 <a class="header-anchor" href="#如果运行的线程数已经等于最大线程数-新来的任务将会根据配置的拒绝策略被处理-例如抛出异常、运行拒绝任务的处理程序等。" aria-label="Permalink to &quot;如果运行的线程数已经等于最大线程数，新来的任务将会根据配置的拒绝策略被处理，例如抛出异常、运行拒绝任务的处理程序等。&quot;">​</a></h4><h3 id="自定义线程池策略" tabindex="-1">自定义线程池策略 <a class="header-anchor" href="#自定义线程池策略" aria-label="Permalink to &quot;自定义线程池策略&quot;">​</a></h3><h4 id="spring线程池的默认行为可能不会适当地处理运行时异常。如果没有正确配置错误处理逻辑-这可能导致问题被忽略或不正确地处理。" tabindex="-1">Spring线程池的默认行为可能不会适当地处理运行时异常。如果没有正确配置错误处理逻辑，这可能导致问题被忽略或不正确地处理。 <a class="header-anchor" href="#spring线程池的默认行为可能不会适当地处理运行时异常。如果没有正确配置错误处理逻辑-这可能导致问题被忽略或不正确地处理。" aria-label="Permalink to &quot;Spring线程池的默认行为可能不会适当地处理运行时异常。如果没有正确配置错误处理逻辑，这可能导致问题被忽略或不正确地处理。&quot;">​</a></h4><h4 id="存在oom风险-所以需要根据情况重新配置线程池策略。" tabindex="-1">存在OOM风险，所以需要根据情况重新配置线程池策略。 <a class="header-anchor" href="#存在oom风险-所以需要根据情况重新配置线程池策略。" aria-label="Permalink to &quot;存在OOM风险，所以需要根据情况重新配置线程池策略。&quot;">​</a></h4><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EnableAsync</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThreadPoolTaskConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;threadPoolTaskExecutor&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadPoolTaskExecutor </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">threadPoolTaskExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ThreadPoolTaskExecutor executor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ThreadPoolTaskExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //线程池创建的核心线程数，线程池维护线程的最少数量，即使没有任务需要执行，也会一直存活</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //如果设置allowCoreThreadTimeout=true（默认false）时，核心线程会超时关闭</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        executor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCorePoolSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //executor.setAllowCoreThreadTimeOut();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //阻塞队列 当核心线程数达到最大时，新任务会放在队列中排队等待执行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        executor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setQueueCapacity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">124</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //最大线程池数量，当线程数&gt;=corePoolSize，且任务队列已满时。线程池会创建新线程来处理任务</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //任务队列已满时, 且当线程数=maxPoolSize，，线程池会拒绝处理任务而抛出异常</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        executor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setMaxPoolSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //当线程空闲时间达到keepAliveTime时，线程会退出，直到线程数量=corePoolSize</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //允许线程空闲时间30秒，当maxPoolSize的线程在空闲时间到达的时候销毁</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //如果allowCoreThreadTimeout=true，则会直到线程数量=0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        executor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setKeepAliveSeconds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //spring 提供的 ThreadPoolTaskExecutor 线程池，是有 setThreadNamePrefix() 方法的。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //jdk 提供的ThreadPoolExecutor 线程池是没有 setThreadNamePrefix() 方法的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        executor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setThreadNamePrefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;自定义线程池-&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // rejection-policy：当pool已经达到max size的时候，如何处理新任务</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // CallerRunsPolicy()：交由调用方线程运行，比如 main 线程；如果添加到线程池失败，那么主线程会自己去执行该任务，不会等待线程池中的线程去执行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // AbortPolicy()：该策略是线程池的默认策略，如果线程池队列满了丢掉这个任务并且抛出RejectedExecutionException异常。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // DiscardPolicy()：如果线程池队列满了，会直接丢掉这个任务并且不会有任何异常</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // DiscardOldestPolicy()：丢弃队列中最老的任务，队列满了，会将最早进入队列的任务删掉腾出空间，再尝试加入队列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        executor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRejectedExecutionHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadPoolExecutor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AbortPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        executor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">initialize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> executor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="指定自定义线程池" tabindex="-1">指定自定义线程池 <a class="header-anchor" href="#指定自定义线程池" aria-label="Permalink to &quot;指定自定义线程池&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;threadPoolTaskExecutor&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="总结-1" tabindex="-1">总结 <a class="header-anchor" href="#总结-1" aria-label="Permalink to &quot;总结&quot;">​</a></h3><h4 id="先是corepoolsize是否满足-然后是queue阻塞队列是否满-最后才是maxpoolsize是否满足" tabindex="-1">先是<code>CorePoolSize</code>是否满足，然后是<code>Queue</code>阻塞队列是否满，最后才是<code>MaxPoolSize</code>是否满足 <a class="header-anchor" href="#先是corepoolsize是否满足-然后是queue阻塞队列是否满-最后才是maxpoolsize是否满足" aria-label="Permalink to &quot;先是`CorePoolSize`是否满足，然后是`Queue`阻塞队列是否满，最后才是`MaxPoolSize`是否满足&quot;">​</a></h4><h1 id="q-threadpooltaskexecutor线程池有哪几个重要参数-什么时候会创建线程" tabindex="-1">Q: ThreadPoolTaskExecutor线程池有哪几个重要参数，什么时候会创建线程？ <a class="header-anchor" href="#q-threadpooltaskexecutor线程池有哪几个重要参数-什么时候会创建线程" aria-label="Permalink to &quot;Q: ThreadPoolTaskExecutor线程池有哪几个重要参数，什么时候会创建线程？&quot;">​</a></h1><h2 id="查看核心线程池是否已满-不满就创建一条线程执行任务-否则执行第二步。" tabindex="-1">查看核心线程池是否已满，不满就创建一条线程执行任务，否则执行第二步。 <a class="header-anchor" href="#查看核心线程池是否已满-不满就创建一条线程执行任务-否则执行第二步。" aria-label="Permalink to &quot;查看核心线程池是否已满，不满就创建一条线程执行任务，否则执行第二步。&quot;">​</a></h2><h2 id="查看阻塞队列是否已满-不满就将任务存储在阻塞队列中-否则执行第三步。" tabindex="-1">查看阻塞队列是否已满，不满就将任务存储在阻塞队列中，否则执行第三步。 <a class="header-anchor" href="#查看阻塞队列是否已满-不满就将任务存储在阻塞队列中-否则执行第三步。" aria-label="Permalink to &quot;查看阻塞队列是否已满，不满就将任务存储在阻塞队列中，否则执行第三步。&quot;">​</a></h2><h2 id="查看线程池是否已满-即是否达到最大线程池数-不满就创建一条线程执行任务-否则就按照策略处理无法执行的任务。" tabindex="-1">查看线程池是否已满，即是否达到最大线程池数，不满就创建一条线程执行任务，否则就按照策略处理无法执行的任务。 <a class="header-anchor" href="#查看线程池是否已满-即是否达到最大线程池数-不满就创建一条线程执行任务-否则就按照策略处理无法执行的任务。" aria-label="Permalink to &quot;查看线程池是否已满，即是否达到最大线程池数，不满就创建一条线程执行任务，否则就按照策略处理无法执行的任务。&quot;">​</a></h2><h1 id="q-高并发下核心线程怎么设置" tabindex="-1">Q: 高并发下核心线程怎么设置? <a class="header-anchor" href="#q-高并发下核心线程怎么设置" aria-label="Permalink to &quot;Q: 高并发下核心线程怎么设置?&quot;">​</a></h1><h2 id="分io密集还是cpu密集-一般情况按以下设置性能更好" tabindex="-1">分IO密集还是CPU密集，一般情况按以下设置性能更好 <a class="header-anchor" href="#分io密集还是cpu密集-一般情况按以下设置性能更好" aria-label="Permalink to &quot;分IO密集还是CPU密集，一般情况按以下设置性能更好&quot;">​</a></h2><h3 id="cpu密集设置为跟核心数一样大小" tabindex="-1">CPU密集设置为跟核心数一样大小 <a class="header-anchor" href="#cpu密集设置为跟核心数一样大小" aria-label="Permalink to &quot;CPU密集设置为跟核心数一样大小&quot;">​</a></h3><h3 id="io密集型设置为2倍cpu核心数" tabindex="-1">IO密集型设置为2倍CPU核心数 <a class="header-anchor" href="#io密集型设置为2倍cpu核心数" aria-label="Permalink to &quot;IO密集型设置为2倍CPU核心数&quot;">​</a></h3><h2 id="没有固定的参数-根据实际情况压测进行调整" tabindex="-1">没有固定的参数，根据实际情况压测进行调整 <a class="header-anchor" href="#没有固定的参数-根据实际情况压测进行调整" aria-label="Permalink to &quot;没有固定的参数，根据实际情况压测进行调整&quot;">​</a></h2><h1 id="消费方⻆度-提高消费能力" tabindex="-1">消费方⻆度，提高消费能力 <a class="header-anchor" href="#消费方⻆度-提高消费能力" aria-label="Permalink to &quot;消费方⻆度，提高消费能力&quot;">​</a></h1><h2 id="客户端每次请求都要和服务端建立新的连接-即三次握手将会非常耗时" tabindex="-1">客户端每次请求都要和服务端建立新的连接，即三次握手将会非常耗时 <a class="header-anchor" href="#客户端每次请求都要和服务端建立新的连接-即三次握手将会非常耗时" aria-label="Permalink to &quot;客户端每次请求都要和服务端建立新的连接，即三次握手将会非常耗时&quot;">​</a></h2><h2 id="通过http连接池可以减少连接建立与释放的时间-提升http请求的性能" tabindex="-1">通过http连接池可以减少连接建立与释放的时间，提升http请求的性能 <a class="header-anchor" href="#通过http连接池可以减少连接建立与释放的时间-提升http请求的性能" aria-label="Permalink to &quot;通过http连接池可以减少连接建立与释放的时间，提升http请求的性能&quot;">​</a></h2><h2 id="spring的resttemplate是对httpclient进行了封装-而httpclient是支持池化机制" tabindex="-1">Spring的restTemplate是对httpclient进行了封装, 而httpclient是支持池化机制 <a class="header-anchor" href="#spring的resttemplate是对httpclient进行了封装-而httpclient是支持池化机制" aria-label="Permalink to &quot;Spring的restTemplate是对httpclient进行了封装, 而httpclient是支持池化机制&quot;">​</a></h2><h2 id="拓展" tabindex="-1">拓展 <a class="header-anchor" href="#拓展" aria-label="Permalink to &quot;拓展&quot;">​</a></h2><h3 id="对httpclient进行封装的有-apache的fluent、es的-resthighlevelclient、spring的resttemplate等" tabindex="-1">对httpclient进行封装的有: Apache的Fluent、es的 restHighLevelClient、spring的restTemplate等 <a class="header-anchor" href="#对httpclient进行封装的有-apache的fluent、es的-resthighlevelclient、spring的resttemplate等" aria-label="Permalink to &quot;对httpclient进行封装的有: Apache的Fluent、es的 restHighLevelClient、spring的restTemplate等&quot;">​</a></h3><h2 id="配置resttemplate连接池" tabindex="-1">配置RestTemplate连接池 <a class="header-anchor" href="#配置resttemplate连接池" aria-label="Permalink to &quot;配置RestTemplate连接池&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RestTemplateConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RestTemplate </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ClientHttpRequestFactory </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">requestFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RestTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(requestFactory);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ClientHttpRequestFactory </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">httpRequestFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpComponentsClientHttpRequestFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">httpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpClient </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">httpClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Registry&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ConnectionSocketFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; registry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RegistryBuilder.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ConnectionSocketFactory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, PlainConnectionSocketFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSocketFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SSLConnectionSocketFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSocketFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        PoolingHttpClientConnectionManager connectionManager </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PoolingHttpClientConnectionManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(registry);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //设置连接池最大是500个连接</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        connectionManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setMaxTotal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //MaxPerRoute是对maxTotal的细分，每个主机的并发最大是300，route是指域名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        connectionManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDefaultMaxPerRoute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         * 只请求resonance.fun, 最大并发300</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         * 请求resonance.fun, 最大并发300</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         * 请求open1024.com, 最大并发200</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        RequestConfig requestConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RequestConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">custom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                //返回数据的超时时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSocketTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                //连接上服务器的超时时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setConnectTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                //从连接池中获取连接的超时时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setConnectionRequestTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        CloseableHttpClient closeableHttpClient </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpClientBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDefaultRequestConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(requestConfig)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setConnectionManager</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(connectionManager)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> closeableHttpClient;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_10倍-提升-jmeter5-x压测优化后resttemplate前后性能对比" tabindex="-1">10倍+提升: Jmeter5.x压测优化后RestTemplate前后性能对比 <a class="header-anchor" href="#_10倍-提升-jmeter5-x压测优化后resttemplate前后性能对比" aria-label="Permalink to &quot;10倍+提升: Jmeter5.x压测优化后RestTemplate前后性能对比&quot;">​</a></h1><h2 id="同步发送-resttemplate未池化" tabindex="-1">同步发送+resttemplate未池化 <a class="header-anchor" href="#同步发送-resttemplate未池化" aria-label="Permalink to &quot;同步发送+resttemplate未池化&quot;">​</a></h2><h3 id="压测结果-几百qps" tabindex="-1">压测结果：几百qps <a class="header-anchor" href="#压测结果-几百qps" aria-label="Permalink to &quot;压测结果：几百qps&quot;">​</a></h3><h2 id="异步发送-resttemplate池化" tabindex="-1">异步发送+resttemplate池化 <a class="header-anchor" href="#异步发送-resttemplate池化" aria-label="Permalink to &quot;异步发送+resttemplate池化&quot;">​</a></h2><h3 id="压测结果-2000-3000qps-但这是同一台机器-实际分开测试更高" tabindex="-1">压测结果：2000～3000qps，但这是同一台机器，实际分开测试更高 <a class="header-anchor" href="#压测结果-2000-3000qps-但这是同一台机器-实际分开测试更高" aria-label="Permalink to &quot;压测结果：2000～3000qps，但这是同一台机器，实际分开测试更高&quot;">​</a></h3><h1 id="池化思想应用-redis6-x配置连接池实战" tabindex="-1">池化思想应用-Redis6.X配置连接池实战 <a class="header-anchor" href="#池化思想应用-redis6-x配置连接池实战" aria-label="Permalink to &quot;池化思想应用-Redis6.X配置连接池实战&quot;">​</a></h1><h2 id="连接池好处" tabindex="-1">连接池好处 <a class="header-anchor" href="#连接池好处" aria-label="Permalink to &quot;连接池好处&quot;">​</a></h2><h3 id="使用连接池不用每次都走三次握手、每次都关闭jedis" tabindex="-1">使用连接池不用每次都走三次握手、每次都关闭Jedis <a class="header-anchor" href="#使用连接池不用每次都走三次握手、每次都关闭jedis" aria-label="Permalink to &quot;使用连接池不用每次都走三次握手、每次都关闭Jedis&quot;">​</a></h3><h3 id="注意" tabindex="-1">注意 <a class="header-anchor" href="#注意" aria-label="Permalink to &quot;注意&quot;">​</a></h3><h4 id="相对于直连-使用相对麻烦-在资源管理上需要很多参数来保证-规划不合理也会出现问题" tabindex="-1">相对于直连，使用相对麻烦，在资源管理上需要很多参数来保证，规划不合理也会出现问题 <a class="header-anchor" href="#相对于直连-使用相对麻烦-在资源管理上需要很多参数来保证-规划不合理也会出现问题" aria-label="Permalink to &quot;相对于直连，使用相对麻烦，在资源管理上需要很多参数来保证，规划不合理也会出现问题&quot;">​</a></h4><h4 id="如果pool已经分配了maxactive个jedis实例-则此时pool的状态就成exhausted了" tabindex="-1">如果pool已经分配了maxActive个jedis实例，则此时pool的状态就成exhausted了 <a class="header-anchor" href="#如果pool已经分配了maxactive个jedis实例-则此时pool的状态就成exhausted了" aria-label="Permalink to &quot;如果pool已经分配了maxActive个jedis实例，则此时pool的状态就成exhausted了&quot;">​</a></h4><h2 id="连接池配置common项目" tabindex="-1">连接池配置common项目 <a class="header-anchor" href="#连接池配置common项目" aria-label="Permalink to &quot;连接池配置common项目&quot;">​</a></h2><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!--redis客户端--&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;spring-boot-starter-data-redis&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">exclusions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">exclusion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;io.lettuce&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;lettuce-core&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">exclusion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">exclusions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;redis.clients&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;jedis&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;org.apache.commons&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;commons-pool2&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="配置redis连接" tabindex="-1">配置Redis连接 <a class="header-anchor" href="#配置redis连接" aria-label="Permalink to &quot;配置Redis连接&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  redis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    client-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">jedis</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">47.108.67.134</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">resonancefun</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      pool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 连接池最大连接数（使用负值表示没有限制）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        max-active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 连接池中的最大空闲连接</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        max-idle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 连接池中的最小空闲连接</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        min-idle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 连接池最大阻塞等待时间（使用负值表示没有限制）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        max-wait</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60000</span></span></code></pre></div><h2 id="序列化配置" tabindex="-1">序列化配置 <a class="header-anchor" href="#序列化配置" aria-label="Permalink to &quot;序列化配置&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RedisTemplateConfiguration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RedisTemplate&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redisTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RedisConnectionFactory </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">redisConnectionFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        RedisTemplate&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; redisTemplate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RedisTemplate&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setConnectionFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(redisConnectionFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //配置序列化规则</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Jackson2JsonRedisSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Object.class);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ObjectMapper objectMapper </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        objectMapper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setVisibility</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jackson2JsonRedisSerializer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setObjectMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(objectMapper);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //设置key-value序列化规则</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setKeySerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StringRedisSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setValueSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jackson2JsonRedisSerializer);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //设置hash-value序列化规则</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setHashKeySerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StringRedisSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setHashValueSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jackson2JsonRedisSerializer);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redisTemplate;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="try-with-resources" tabindex="-1">try-with-resources <a class="header-anchor" href="#try-with-resources" aria-label="Permalink to &quot;try-with-resources&quot;">​</a></h1><h2 id="在try-里声明的资源-会在try-catch代码块结束后自动关闭掉" tabindex="-1">在<code>try(...)</code>里声明的资源，会在try-catch代码块结束后自动关闭掉 <a class="header-anchor" href="#在try-里声明的资源-会在try-catch代码块结束后自动关闭掉" aria-label="Permalink to &quot;在`try(...)`里声明的资源，会在try-catch代码块结束后自动关闭掉&quot;">​</a></h2><h2 id="注意点" tabindex="-1">注意点 <a class="header-anchor" href="#注意点" aria-label="Permalink to &quot;注意点&quot;">​</a></h2><h3 id="实现了autocloseable接口的类-在try-里声明该类实例的时候-try结束后自动调用的close方法-这个动作会早于finally里调用的方法" tabindex="-1">实现了<code>AutoCloseable</code>接口的类，在<code>try()</code>里声明该类实例的时候，try结束后自动调用的<code>close</code>方法，这个动作会早于<code>finally</code>里调用的方法 <a class="header-anchor" href="#实现了autocloseable接口的类-在try-里声明该类实例的时候-try结束后自动调用的close方法-这个动作会早于finally里调用的方法" aria-label="Permalink to &quot;实现了`AutoCloseable`接口的类，在`try()`里声明该类实例的时候，try结束后自动调用的`close`方法，这个动作会早于`finally`里调用的方法&quot;">​</a></h3><h3 id="不管是否出现异常-try-里的实例都会被调用close方法" tabindex="-1">不管是否出现异常，<code>try()</code>里的实例都会被调用close方法 <a class="header-anchor" href="#不管是否出现异常-try-里的实例都会被调用close方法" aria-label="Permalink to &quot;不管是否出现异常，`try()`里的实例都会被调用close方法&quot;">​</a></h3><h3 id="try里面可以声明多个自动关闭的对象-越早声明的对象-会越晚被close掉" tabindex="-1">try里面可以声明多个自动关闭的对象，越早声明的对象， 会越晚被close掉 <a class="header-anchor" href="#try里面可以声明多个自动关闭的对象-越早声明的对象-会越晚被close掉" aria-label="Permalink to &quot;try里面可以声明多个自动关闭的对象，越早声明的对象， 会越晚被close掉&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (BufferedReader reader </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BufferedReader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FileReader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;somefile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     BufferedWriter writer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BufferedWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FileWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;outputfile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String line;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((line </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> reader.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readLine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        writer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(line);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 可能还有一些其他的处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (IOException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 处理异常</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 这里 reader 和 writer 都会自动关闭</span></span></code></pre></div><h1 id="注册短信验证码防刷方案" tabindex="-1">注册短信验证码防刷方案 <a class="header-anchor" href="#注册短信验证码防刷方案" aria-label="Permalink to &quot;注册短信验证码防刷方案&quot;">​</a></h1><h2 id="需求" tabindex="-1">需求 <a class="header-anchor" href="#需求" aria-label="Permalink to &quot;需求&quot;">​</a></h2><h3 id="一定时间内禁止重复发送短信" tabindex="-1">一定时间内禁止重复发送短信 <a class="header-anchor" href="#一定时间内禁止重复发送短信" aria-label="Permalink to &quot;一定时间内禁止重复发送短信&quot;">​</a></h3><h2 id="两个时间要求" tabindex="-1">两个时间要求 <a class="header-anchor" href="#两个时间要求" aria-label="Permalink to &quot;两个时间要求&quot;">​</a></h2><h3 id="_60秒后才可以重新发送短信验证码" tabindex="-1">60秒后才可以重新发送短信验证码 <a class="header-anchor" href="#_60秒后才可以重新发送短信验证码" aria-label="Permalink to &quot;60秒后才可以重新发送短信验证码&quot;">​</a></h3><h3 id="发送的短信验证码10分钟内有效" tabindex="-1">发送的短信验证码10分钟内有效 <a class="header-anchor" href="#发送的短信验证码10分钟内有效" aria-label="Permalink to &quot;发送的短信验证码10分钟内有效&quot;">​</a></h3><h2 id="方案-redis中code存储-基于原先的code拼接时间戳" tabindex="-1">方案：Redis中code存储，基于原先的code拼接时间戳 <a class="header-anchor" href="#方案-redis中code存储-基于原先的code拼接时间戳" aria-label="Permalink to &quot;方案：Redis中code存储，基于原先的code拼接时间戳&quot;">​</a></h2><h3 id="控制层" tabindex="-1">控制层 <a class="header-anchor" href="#控制层" aria-label="Permalink to &quot;控制层&quot;">​</a></h3><h4 id="匹配上图形验证码后-先删除redis中的旧数据-再发送。" tabindex="-1">匹配上图形验证码后，先删除redis中的旧数据，再发送。 <a class="header-anchor" href="#匹配上图形验证码后-先删除redis中的旧数据-再发送。" aria-label="Permalink to &quot;匹配上图形验证码后，先删除redis中的旧数据，再发送。&quot;">​</a></h4><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PostMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/send_code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequestBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SendCodeRequest sendCodeRequest, HttpServletRequest request) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCaptchaKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String cacheCaptcha </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String captcha </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sendCodeRequest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCaptcha</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (captcha </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cacheCaptcha </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cacheCaptcha.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsIgnoreCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(captcha)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //成功</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        JsonData jsonData </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> notifyService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SendCodeEnum.USER_REGISTER, sendCodeRequest.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getTo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jsonData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BizCodeEnum.CODE_CAPTCHA_ERROR);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="服务层-防刷实现" tabindex="-1">服务层：防刷实现 <a class="header-anchor" href="#服务层-防刷实现" aria-label="Permalink to &quot;服务层：防刷实现&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SendCodeEnum sendCodeEnum, String to) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String cacheKey </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RedisKey.CHECK_CODE_KEY, sendCodeEnum.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), to);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String cacheValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cacheKey);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StringUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isNotBlank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cacheValue)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ttl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseLong</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cacheValue.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;_&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //当前时间戳-验证码发送的时间戳，如果小于60秒，则不给重复发送</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> leftTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CommonUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCurrentTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ttl;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (leftTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;重复发送短信验证码，时间间隔:{}秒&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, leftTime);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BizCodeEnum.CODE_LIMITED);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CommonUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRandomCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //生成拼接好验证码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CommonUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCurrentTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cacheKey, value, CODE_EXPIRED, TimeUnit.MILLISECONDS);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CheckUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(to)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //发送邮箱验证码  TODO</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CheckUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isPhone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(to)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //发送手机验证码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        smsComponent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(to, smsConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getTemplateId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), code);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="q-分库分表下-注册的手机号唯一性保证怎么做" tabindex="-1">Q: 分库分表下 注册的手机号唯一性保证怎么做？ <a class="header-anchor" href="#q-分库分表下-注册的手机号唯一性保证怎么做" aria-label="Permalink to &quot;Q: 分库分表下 注册的手机号唯一性保证怎么做？&quot;">​</a></h1><h2 id="如果允许更换手机号-使用phone作为partitionkey-会触发大量的更新-这个方案不是很好-有没更好的方式" tabindex="-1">如果允许更换手机号，使用phone作为partitionKey，会触发大量的更新，这个方案不是很好，有没更好的方式 <a class="header-anchor" href="#如果允许更换手机号-使用phone作为partitionkey-会触发大量的更新-这个方案不是很好-有没更好的方式" aria-label="Permalink to &quot;如果允许更换手机号，使用phone作为partitionKey，会触发大量的更新，这个方案不是很好，有没更好的方式&quot;">​</a></h2><h1 id="jwt介绍" tabindex="-1">JWT介绍 <a class="header-anchor" href="#jwt介绍" aria-label="Permalink to &quot;JWT介绍&quot;">​</a></h1><h2 id="什么是jwt" tabindex="-1">什么是JWT <a class="header-anchor" href="#什么是jwt" aria-label="Permalink to &quot;什么是JWT&quot;">​</a></h2><h3 id="jwt-是一个开放标准-它定义了一种用于简洁-自包含的用于通信双方之间以-json-对象的形式安全传递信息的方法。-可以使用-hmac-算法或者是-rsa-的公钥密钥对进行签名" tabindex="-1">JWT 是一个开放标准，它定义了一种用于简洁，自包含的用于通信双方之间以 JSON 对象的形式安全传递信息的方法。 可以使用 HMAC 算法或者是 RSA 的公钥密钥对进行签名 <a class="header-anchor" href="#jwt-是一个开放标准-它定义了一种用于简洁-自包含的用于通信双方之间以-json-对象的形式安全传递信息的方法。-可以使用-hmac-算法或者是-rsa-的公钥密钥对进行签名" aria-label="Permalink to &quot;JWT 是一个开放标准，它定义了一种用于简洁，自包含的用于通信双方之间以 JSON 对象的形式安全传递信息的方法。 可以使用 HMAC 算法或者是 RSA 的公钥密钥对进行签名&quot;">​</a></h3><h3 id="简单来说-就是通过一定规范来生成token-然后可以通过解密算法逆向解密token-这样就可以获取用户信息" tabindex="-1">简单来说: 就是通过一定规范来生成token，然后可以通过解密算法逆向解密token，这样就可以获取用户信息 <a class="header-anchor" href="#简单来说-就是通过一定规范来生成token-然后可以通过解密算法逆向解密token-这样就可以获取用户信息" aria-label="Permalink to &quot;简单来说: 就是通过一定规范来生成token，然后可以通过解密算法逆向解密token，这样就可以获取用户信息&quot;">​</a></h3><h2 id="优点" tabindex="-1">优点 <a class="header-anchor" href="#优点" aria-label="Permalink to &quot;优点&quot;">​</a></h2><h3 id="生产的token可以包含基本信息-比如id、用户昵称、头像-等信息-避免再次查库" tabindex="-1">生产的token可以包含基本信息，比如id、用户昵称、头像 等信息，避免再次查库 <a class="header-anchor" href="#生产的token可以包含基本信息-比如id、用户昵称、头像-等信息-避免再次查库" aria-label="Permalink to &quot;生产的token可以包含基本信息，比如id、用户昵称、头像 等信息，避免再次查库&quot;">​</a></h3><h3 id="存储在客户端-不占用服务端的内存资源" tabindex="-1">存储在客户端，不占用服务端的内存资源 <a class="header-anchor" href="#存储在客户端-不占用服务端的内存资源" aria-label="Permalink to &quot;存储在客户端，不占用服务端的内存资源&quot;">​</a></h3><h2 id="缺点" tabindex="-1">缺点 <a class="header-anchor" href="#缺点" aria-label="Permalink to &quot;缺点&quot;">​</a></h2><h3 id="token是经过base64编码-所以可以解码-因此token加密-前的对象不应该包含敏感信息-如用户权限-密码等" tabindex="-1">token是经过base64编码，所以可以解码，因此token加密 前的对象不应该包含敏感信息，如用户权限，密码等 <a class="header-anchor" href="#token是经过base64编码-所以可以解码-因此token加密-前的对象不应该包含敏感信息-如用户权限-密码等" aria-label="Permalink to &quot;token是经过base64编码，所以可以解码，因此token加密 前的对象不应该包含敏感信息，如用户权限，密码等&quot;">​</a></h3><h3 id="如果没有服务端存储-则不能做登录失效处理-除非服务端改秘钥" tabindex="-1">如果没有服务端存储，则不能做登录失效处理，除非服务端改秘钥 <a class="header-anchor" href="#如果没有服务端存储-则不能做登录失效处理-除非服务端改秘钥" aria-label="Permalink to &quot;如果没有服务端存储，则不能做登录失效处理，除非服务端改秘钥&quot;">​</a></h3><h4 id="通常需要判断用户ip和token中的ip是否一致-防止黑产攻击" tabindex="-1">通常需要判断用户IP和token中的IP是否一致，防止黑产攻击 <a class="header-anchor" href="#通常需要判断用户ip和token中的ip是否一致-防止黑产攻击" aria-label="Permalink to &quot;通常需要判断用户IP和token中的IP是否一致，防止黑产攻击&quot;">​</a></h4><h2 id="jwt格式组成-头部、负载、签名" tabindex="-1">JWT格式组成：头部、负载、签名 <a class="header-anchor" href="#jwt格式组成-头部、负载、签名" aria-label="Permalink to &quot;JWT格式组成：头部、负载、签名&quot;">​</a></h2><h3 id="header-payload-signature" tabindex="-1">header+payload+signature <a class="header-anchor" href="#header-payload-signature" aria-label="Permalink to &quot;header+payload+signature&quot;">​</a></h3><h4 id="头部-主要是描述签名算法" tabindex="-1">头部: 主要是描述签名算法 <a class="header-anchor" href="#头部-主要是描述签名算法" aria-label="Permalink to &quot;头部: 主要是描述签名算法&quot;">​</a></h4><h4 id="负载-主要描述是加密对象的信息-如用户的id等-也可以加些规范里面的东⻄-如iss签发者-exp-过期时间-sub-面向的用户" tabindex="-1">负载: 主要描述是加密对象的信息，如用户的id等，也可以加些规范里面的东⻄，如iss签发者，exp 过期时间， sub 面向的用户 <a class="header-anchor" href="#负载-主要描述是加密对象的信息-如用户的id等-也可以加些规范里面的东⻄-如iss签发者-exp-过期时间-sub-面向的用户" aria-label="Permalink to &quot;负载: 主要描述是加密对象的信息，如用户的id等，也可以加些规范里面的东⻄，如iss签发者，exp 过期时间， sub 面向的用户&quot;">​</a></h4><h4 id="签名-主要是把前面两部分进行加密-防止别人拿到token进行base解密后篡改token" tabindex="-1">签名: 主要是把前面两部分进行加密，防止别人拿到token进行base解密后篡改token <a class="header-anchor" href="#签名-主要是把前面两部分进行加密-防止别人拿到token进行base解密后篡改token" aria-label="Permalink to &quot;签名: 主要是把前面两部分进行加密，防止别人拿到token进行base解密后篡改token&quot;">​</a></h4><h3 id="关于jwt客户端存储" tabindex="-1">关于jwt客户端存储 <a class="header-anchor" href="#关于jwt客户端存储" aria-label="Permalink to &quot;关于jwt客户端存储&quot;">​</a></h3><h4 id="可以存储在cookie-localstorage和sessionstorage里面" tabindex="-1">可以存储在cookie，localstorage和sessionStorage里面 <a class="header-anchor" href="#可以存储在cookie-localstorage和sessionstorage里面" aria-label="Permalink to &quot;可以存储在cookie，localstorage和sessionStorage里面&quot;">​</a></h4><h2 id="封装生产token方法和校验token方法" tabindex="-1">封装生产token方法和校验token方法 <a class="header-anchor" href="#封装生产token方法和校验token方法" aria-label="Permalink to &quot;封装生产token方法和校验token方法&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JWTUtil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 主题</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String SUBJECT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;forest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 加密密钥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String SECRET </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;resonance.fun168&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 令牌前缀</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String TOKNE_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;dcloud-link&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * token过期时间，7天</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EXPIRED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 24</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 生成token</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> loginUser</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">geneJsonWebToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LoginUser </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">loginUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (loginUser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NullPointerException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;对象为空&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Jwts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSubject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SUBJECT)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                //配置payload</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">claim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;head_img&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loginUser.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeadImg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">claim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;account_no&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loginUser.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAccountNo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">claim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loginUser.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUsername</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">claim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mail&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loginUser.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">claim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;phone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loginUser.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPhone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">claim</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, loginUser.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAuth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setIssuedAt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setExpiration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CommonUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCurrentTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EXPIRED))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">signWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SignatureAlgorithm.HS256, SECRET).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TOKNE_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> token;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> token;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 解密jwt</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> token</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Claims </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkJWT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Claims claims </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Jwts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSigningKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SECRET)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseClaimsJws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(token.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TOKNE_PREFIX, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> claims;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jwt 解密失败&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="全局登录拦截器" tabindex="-1">全局登录拦截器 <a class="header-anchor" href="#全局登录拦截器" aria-label="Permalink to &quot;全局登录拦截器&quot;">​</a></h1><h2 id="在common模块编写全局拦截器逻辑" tabindex="-1">在common模块编写全局拦截器逻辑 <a class="header-anchor" href="#在common模块编写全局拦截器逻辑" aria-label="Permalink to &quot;在common模块编写全局拦截器逻辑&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LoginInterceptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HandlerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadLocal&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LoginUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; threadLocal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadLocal&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> preHandle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpServletRequest </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HttpServletResponse </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 放行options方法</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpMethod.OPTIONS.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsIgnoreCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatus.NO_CONTENT.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String accessToken </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StringUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isBlank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(accessToken)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            accessToken </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getParameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StringUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isNotBlank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(accessToken)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Claims claims </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JWTUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkJWT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(accessToken);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (claims </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                //未登录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                CommonUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sendJsonMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response, JsonData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BizCodeEnum.ACCOUNT_UNLOGIN));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accountNo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseLong</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(claims.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;account_no&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String headImg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (String) claims.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;head_img&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String username </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (String) claims.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String mail </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (String) claims.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mail&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (String) claims.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;phone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String auth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (String) claims.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;auth&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LoginUser loginUser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LoginUser.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">accountNo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(accountNo)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(auth)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">phone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(phone)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">headImg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(headImg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mail)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">username</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(username)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //request.setAttribute(&quot;loginUser&quot;,loginUser);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //通过threadlocal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            threadLocal.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(loginUser);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> postHandle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpServletRequest </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HttpServletResponse </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ModelAndView </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">modelAndView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> afterCompletion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpServletRequest </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HttpServletResponse </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        threadLocal.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="微服务登录拦截器配置" tabindex="-1">微服务登录拦截器配置 <a class="header-anchor" href="#微服务登录拦截器配置" aria-label="Permalink to &quot;微服务登录拦截器配置&quot;">​</a></h2><h3 id="在微服务模块配置拦截器并引入全局拦截器" tabindex="-1">在微服务模块配置拦截器并引入全局拦截器 <a class="header-anchor" href="#在微服务模块配置拦截器并引入全局拦截器" aria-label="Permalink to &quot;在微服务模块配置拦截器并引入全局拦截器&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InterceptorConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WebMvcConfigurer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addInterceptors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(InterceptorRegistry </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">registry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        registry.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LoginInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                //添加拦截的路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addPathPatterns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/account/*/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                //排除不拦截</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">excludePathPatterns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;/api/account/*/register&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/account/*/upload&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/account/*/login&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;/api/notify/v1/captcha&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/notify/*/send_code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="q-这边有个数据库-单表1千万数据-未来1年还会增⻓多500万-性能比较慢-说下你的优化思路" tabindex="-1">Q: 这边有个数据库-单表1千万数据，未来1年还会增⻓多500万，性能比较慢，说下你的优化思路 <a class="header-anchor" href="#q-这边有个数据库-单表1千万数据-未来1年还会增⻓多500万-性能比较慢-说下你的优化思路" aria-label="Permalink to &quot;Q: 这边有个数据库-单表1千万数据，未来1年还会增⻓多500万，性能比较慢，说下你的优化思路&quot;">​</a></h1><h2 id="a-两个角度思考" tabindex="-1">A: 两个角度思考 <a class="header-anchor" href="#a-两个角度思考" aria-label="Permalink to &quot;A: 两个角度思考&quot;">​</a></h2><h3 id="不分库分表" tabindex="-1">不分库分表 <a class="header-anchor" href="#不分库分表" aria-label="Permalink to &quot;不分库分表&quot;">​</a></h3><h4 id="软优化" tabindex="-1">软优化 <a class="header-anchor" href="#软优化" aria-label="Permalink to &quot;软优化&quot;">​</a></h4><h5 id="数据库参数调优" tabindex="-1">数据库参数调优 <a class="header-anchor" href="#数据库参数调优" aria-label="Permalink to &quot;数据库参数调优&quot;">​</a></h5><h5 id="分析慢查询sql语句-分析执行计划-进行sql改写和程序改写" tabindex="-1">分析慢查询SQL语句，分析执行计划，进行sql改写和程序改写 <a class="header-anchor" href="#分析慢查询sql语句-分析执行计划-进行sql改写和程序改写" aria-label="Permalink to &quot;分析慢查询SQL语句，分析执行计划，进行sql改写和程序改写&quot;">​</a></h5><h5 id="优化数据库索引结构" tabindex="-1">优化数据库索引结构 <a class="header-anchor" href="#优化数据库索引结构" aria-label="Permalink to &quot;优化数据库索引结构&quot;">​</a></h5><h5 id="优化数据表结构优化" tabindex="-1">优化数据表结构优化 <a class="header-anchor" href="#优化数据表结构优化" aria-label="Permalink to &quot;优化数据表结构优化&quot;">​</a></h5><h5 id="引入nosql和程序架构调整-读写分离" tabindex="-1">引入NOSQL和程序架构调整，读写分离 <a class="header-anchor" href="#引入nosql和程序架构调整-读写分离" aria-label="Permalink to &quot;引入NOSQL和程序架构调整，读写分离&quot;">​</a></h5><h4 id="硬优化" tabindex="-1">硬优化 <a class="header-anchor" href="#硬优化" aria-label="Permalink to &quot;硬优化&quot;">​</a></h4><h5 id="提升系统硬件-更快的io、更多的内存-带宽、cpu、硬盘" tabindex="-1">提升系统硬件(更快的IO、更多的内存): 带宽、CPU、硬盘 <a class="header-anchor" href="#提升系统硬件-更快的io、更多的内存-带宽、cpu、硬盘" aria-label="Permalink to &quot;提升系统硬件(更快的IO、更多的内存): 带宽、CPU、硬盘&quot;">​</a></h5><h2 id="分库分表" tabindex="-1">分库分表 <a class="header-anchor" href="#分库分表" aria-label="Permalink to &quot;分库分表&quot;">​</a></h2><h3 id="根据业务情况而定-选择合适的分库分表策略-没有通用的策略" tabindex="-1">根据业务情况而定，选择合适的分库分表策略(没有通用的策略) <a class="header-anchor" href="#根据业务情况而定-选择合适的分库分表策略-没有通用的策略" aria-label="Permalink to &quot;根据业务情况而定，选择合适的分库分表策略(没有通用的策略)&quot;">​</a></h3><h4 id="外卖、物流、电商领域" tabindex="-1">外卖、物流、电商领域 <a class="header-anchor" href="#外卖、物流、电商领域" aria-label="Permalink to &quot;外卖、物流、电商领域&quot;">​</a></h4><h3 id="先看只分表是否满足业务的需求和未来增⻓" tabindex="-1">先看只分表是否满足业务的需求和未来增⻓ <a class="header-anchor" href="#先看只分表是否满足业务的需求和未来增⻓" aria-label="Permalink to &quot;先看只分表是否满足业务的需求和未来增⻓&quot;">​</a></h3><h4 id="数据库分表能够解决单表数据量很大的时候-数据查询的效率问题" tabindex="-1">数据库分表能够解决单表数据量很大的时候，数据查询的效率问题 <a class="header-anchor" href="#数据库分表能够解决单表数据量很大的时候-数据查询的效率问题" aria-label="Permalink to &quot;数据库分表能够解决单表数据量很大的时候，数据查询的效率问题&quot;">​</a></h4><h4 id="无法给数据库的并发操作带来效率上的提高-分表的实质还是在一个数据库上进行的操作-受数据库io性能的限制" tabindex="-1">无法给数据库的并发操作带来效率上的提高，分表的实质还是在一个数据库上进行的操作，受数据库IO性能的限制 <a class="header-anchor" href="#无法给数据库的并发操作带来效率上的提高-分表的实质还是在一个数据库上进行的操作-受数据库io性能的限制" aria-label="Permalink to &quot;无法给数据库的并发操作带来效率上的提高，分表的实质还是在一个数据库上进行的操作，受数据库IO性能的限制&quot;">​</a></h4><h3 id="如果单分表满足不了需求-再分库分表一起" tabindex="-1">如果单分表满足不了需求，再分库分表一起 <a class="header-anchor" href="#如果单分表满足不了需求-再分库分表一起" aria-label="Permalink to &quot;如果单分表满足不了需求，再分库分表一起&quot;">​</a></h3><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><h3 id="在数据量及访问压力不是特别大的情况-首先考虑缓存、读写分离、索引技术等方案" tabindex="-1">在数据量及访问压力不是特别大的情况，首先考虑缓存、读写分离、索引技术等方案 <a class="header-anchor" href="#在数据量及访问压力不是特别大的情况-首先考虑缓存、读写分离、索引技术等方案" aria-label="Permalink to &quot;在数据量及访问压力不是特别大的情况，首先考虑缓存、读写分离、索引技术等方案&quot;">​</a></h3><h3 id="如果数据量极大-且业务持续增⻓快-再考虑分库分表方案" tabindex="-1">如果数据量极大，且业务持续增⻓快，再考虑分库分表方案 <a class="header-anchor" href="#如果数据量极大-且业务持续增⻓快-再考虑分库分表方案" aria-label="Permalink to &quot;如果数据量极大，且业务持续增⻓快，再考虑分库分表方案&quot;">​</a></h3><h1 id="mysql数据库分库分表" tabindex="-1">Mysql数据库分库分表 <a class="header-anchor" href="#mysql数据库分库分表" aria-label="Permalink to &quot;Mysql数据库分库分表&quot;">​</a></h1><h2 id="优点和缺点" tabindex="-1">优点和缺点 <a class="header-anchor" href="#优点和缺点" aria-label="Permalink to &quot;优点和缺点&quot;">​</a></h2><h3 id="优点-分库分表解决的现状问题" tabindex="-1">优点: 分库分表解决的现状问题 <a class="header-anchor" href="#优点-分库分表解决的现状问题" aria-label="Permalink to &quot;优点: 分库分表解决的现状问题&quot;">​</a></h3><h4 id="解决数据库本身瓶颈" tabindex="-1">解决数据库本身瓶颈 <a class="header-anchor" href="#解决数据库本身瓶颈" aria-label="Permalink to &quot;解决数据库本身瓶颈&quot;">​</a></h4><h5 id="连接数-连接数过多时-就会出现-too-many-connections-的错误-访问量太大或者数据库设置的最大连接数太小的原因" tabindex="-1">连接数: 连接数过多时，就会出现‘too many connections’的错误，访问量太大或者数据库设置的最大连接数太小的原因 <a class="header-anchor" href="#连接数-连接数过多时-就会出现-too-many-connections-的错误-访问量太大或者数据库设置的最大连接数太小的原因" aria-label="Permalink to &quot;连接数: 连接数过多时，就会出现‘too many connections’的错误，访问量太大或者数据库设置的最大连接数太小的原因&quot;">​</a></h5><h5 id="mysql默认的最大连接数为100-可以修改-而mysql服务允许的最大连接数为16384" tabindex="-1">Mysql默认的最大连接数为100，可以修改，而mysql服务允许的最大连接数为16384 <a class="header-anchor" href="#mysql默认的最大连接数为100-可以修改-而mysql服务允许的最大连接数为16384" aria-label="Permalink to &quot;Mysql默认的最大连接数为100，可以修改，而mysql服务允许的最大连接数为16384&quot;">​</a></h5><h5 id="数据库分表可以解决单表海量数据的查询性能问题" tabindex="-1">数据库分表可以解决单表海量数据的查询性能问题 <a class="header-anchor" href="#数据库分表可以解决单表海量数据的查询性能问题" aria-label="Permalink to &quot;数据库分表可以解决单表海量数据的查询性能问题&quot;">​</a></h5><h5 id="数据库分库可以解决单台数据库的并发访问压力问题" tabindex="-1">数据库分库可以解决单台数据库的并发访问压力问题 <a class="header-anchor" href="#数据库分库可以解决单台数据库的并发访问压力问题" aria-label="Permalink to &quot;数据库分库可以解决单台数据库的并发访问压力问题&quot;">​</a></h5><h4 id="解决系统本身io、cpu瓶颈" tabindex="-1">解决系统本身IO、CPU瓶颈 <a class="header-anchor" href="#解决系统本身io、cpu瓶颈" aria-label="Permalink to &quot;解决系统本身IO、CPU瓶颈&quot;">​</a></h4><h5 id="磁盘读写io瓶颈-热点数据太多-尽管使用了数据库本身缓存-但是依旧有大量io-导致sql执行速度慢" tabindex="-1">磁盘读写IO瓶颈，热点数据太多，尽管使用了数据库本身缓存，但是依旧有大量IO，导致sql执行速度慢 <a class="header-anchor" href="#磁盘读写io瓶颈-热点数据太多-尽管使用了数据库本身缓存-但是依旧有大量io-导致sql执行速度慢" aria-label="Permalink to &quot;磁盘读写IO瓶颈，热点数据太多，尽管使用了数据库本身缓存，但是依旧有大量IO，导致sql执行速度慢&quot;">​</a></h5><h5 id="网络io瓶颈-请求的数据太多-数据传输大-网络带宽不够-链路响应时间变⻓" tabindex="-1">网络IO瓶颈，请求的数据太多，数据传输大，网络带宽不够，链路响应时间变⻓ <a class="header-anchor" href="#网络io瓶颈-请求的数据太多-数据传输大-网络带宽不够-链路响应时间变⻓" aria-label="Permalink to &quot;网络IO瓶颈，请求的数据太多，数据传输大，网络带宽不够，链路响应时间变⻓&quot;">​</a></h5><h5 id="cpu瓶颈-尤其在基础数据量大单机复杂sql计算-sql语句执行占用cpu使用率高-也有扫描行数大、锁冲突、锁等待等原因" tabindex="-1">CPU瓶颈，尤其在基础数据量大单机复杂SQL计算，SQL语句执行占用CPU使用率高，也有扫描行数大、锁冲突、锁等待等原因 <a class="header-anchor" href="#cpu瓶颈-尤其在基础数据量大单机复杂sql计算-sql语句执行占用cpu使用率高-也有扫描行数大、锁冲突、锁等待等原因" aria-label="Permalink to &quot;CPU瓶颈，尤其在基础数据量大单机复杂SQL计算，SQL语句执行占用CPU使用率高，也有扫描行数大、锁冲突、锁等待等原因&quot;">​</a></h5><h3 id="缺点-带来新的问题" tabindex="-1">缺点: 带来新的问题 <a class="header-anchor" href="#缺点-带来新的问题" aria-label="Permalink to &quot;缺点: 带来新的问题&quot;">​</a></h3><h4 id="问题一-跨节点数据库join关联查询和多维度查询" tabindex="-1">问题一: 跨节点数据库Join关联查询和多维度查询 <a class="header-anchor" href="#问题一-跨节点数据库join关联查询和多维度查询" aria-label="Permalink to &quot;问题一: 跨节点数据库Join关联查询和多维度查询&quot;">​</a></h4><h5 id="数据库切分前-多表关联查询-可以通过sql-join进行实现" tabindex="-1">数据库切分前，多表关联查询，可以通过sql join进行实现 <a class="header-anchor" href="#数据库切分前-多表关联查询-可以通过sql-join进行实现" aria-label="Permalink to &quot;数据库切分前，多表关联查询，可以通过sql join进行实现&quot;">​</a></h5><h5 id="分库分表后-数据可能分布在不同的节点上-sql-join带来的问题就比较麻烦" tabindex="-1">分库分表后，数据可能分布在不同的节点上，sql join带来的问题就比较麻烦 <a class="header-anchor" href="#分库分表后-数据可能分布在不同的节点上-sql-join带来的问题就比较麻烦" aria-label="Permalink to &quot;分库分表后，数据可能分布在不同的节点上，sql join带来的问题就比较麻烦&quot;">​</a></h5><h5 id="不同维度查看数据-利用的partitionkey是不一样的" tabindex="-1">不同维度查看数据，利用的partitionKey是不一样的 <a class="header-anchor" href="#不同维度查看数据-利用的partitionkey是不一样的" aria-label="Permalink to &quot;不同维度查看数据，利用的partitionKey是不一样的&quot;">​</a></h5><h6 id="例如" tabindex="-1">例如 <a class="header-anchor" href="#例如" aria-label="Permalink to &quot;例如&quot;">​</a></h6><ul><li>订单表 的partionKey是user_id，用户查看自己的订单列表方便</li><li>但商家查看自己店铺的订单列表就麻烦，分布在不同数据节点</li></ul><h4 id="问题二-分库操作带来的分布式事务问题" tabindex="-1">问题二: 分库操作带来的分布式事务问题 <a class="header-anchor" href="#问题二-分库操作带来的分布式事务问题" aria-label="Permalink to &quot;问题二: 分库操作带来的分布式事务问题&quot;">​</a></h4><h5 id="操作内容同时分布在不同库中-不可避免会带来跨库事务问题-即分布式事务" tabindex="-1">操作内容同时分布在不同库中，不可避免会带来跨库事务问题，即分布式事务 <a class="header-anchor" href="#操作内容同时分布在不同库中-不可避免会带来跨库事务问题-即分布式事务" aria-label="Permalink to &quot;操作内容同时分布在不同库中，不可避免会带来跨库事务问题，即分布式事务&quot;">​</a></h5><h4 id="问题三-执行的sql排序、翻⻚、函数计算问题" tabindex="-1">问题三: 执行的SQL排序、翻⻚、函数计算问题 <a class="header-anchor" href="#问题三-执行的sql排序、翻⻚、函数计算问题" aria-label="Permalink to &quot;问题三: 执行的SQL排序、翻⻚、函数计算问题&quot;">​</a></h4><h5 id="分库后-数据分布再不同的节点上-跨节点多库进行查询时-会出现limit分⻚、order-by排序等问题" tabindex="-1">分库后，数据分布再不同的节点上，跨节点多库进行查询时，会出现limit分⻚、order by排序等问题 <a class="header-anchor" href="#分库后-数据分布再不同的节点上-跨节点多库进行查询时-会出现limit分⻚、order-by排序等问题" aria-label="Permalink to &quot;分库后，数据分布再不同的节点上，跨节点多库进行查询时，会出现limit分⻚、order by排序等问题&quot;">​</a></h5><h5 id="而且当排序字段非分片字段时-更加复杂了-要在不同的分片节点中将数据进行排序并返回-然后将不同分片返回的结果集进行汇总和再次排序-也会带来更多的cpu-io资源损耗" tabindex="-1">而且当排序字段非分片字段时，更加复杂了，要在不同的分片节点中将数据进行排序并返回，然后将不同分片返回的结果集进行汇总和再次排序(也会带来更多的CPU/IO资源损耗) <a class="header-anchor" href="#而且当排序字段非分片字段时-更加复杂了-要在不同的分片节点中将数据进行排序并返回-然后将不同分片返回的结果集进行汇总和再次排序-也会带来更多的cpu-io资源损耗" aria-label="Permalink to &quot;而且当排序字段非分片字段时，更加复杂了，要在不同的分片节点中将数据进行排序并返回，然后将不同分片返回的结果集进行汇总和再次排序(也会带来更多的CPU/IO资源损耗)&quot;">​</a></h5><h4 id="问题四-数据库全局主键重复问题" tabindex="-1">问题四: 数据库全局主键重复问题 <a class="header-anchor" href="#问题四-数据库全局主键重复问题" aria-label="Permalink to &quot;问题四: 数据库全局主键重复问题&quot;">​</a></h4><h5 id="常规表的id是使用自增id进行实现-分库分表后-由于表中数据同时存在不同数据库中-如果用自增id-则会出现冲突问题" tabindex="-1">常规表的id是使用自增id进行实现，分库分表后，由于表中数据同时存在不同数据库中，如果用自增id，则会出现冲突问题 <a class="header-anchor" href="#常规表的id是使用自增id进行实现-分库分表后-由于表中数据同时存在不同数据库中-如果用自增id-则会出现冲突问题" aria-label="Permalink to &quot;常规表的id是使用自增id进行实现，分库分表后，由于表中数据同时存在不同数据库中，如果用自增id，则会出现冲突问题&quot;">​</a></h5><h4 id="问题五-容量规划-分库分表后二次扩容问题" tabindex="-1">问题五: 容量规划，分库分表后二次扩容问题 <a class="header-anchor" href="#问题五-容量规划-分库分表后二次扩容问题" aria-label="Permalink to &quot;问题五: 容量规划，分库分表后二次扩容问题&quot;">​</a></h4><h5 id="业务发展快-初次分库分表后-满足不了数据存储-导致需要多次扩容" tabindex="-1">业务发展快，初次分库分表后，满足不了数据存储，导致需要多次扩容 <a class="header-anchor" href="#业务发展快-初次分库分表后-满足不了数据存储-导致需要多次扩容" aria-label="Permalink to &quot;业务发展快，初次分库分表后，满足不了数据存储，导致需要多次扩容&quot;">​</a></h5><h4 id="问题六-分库分表技术选型问题" tabindex="-1">问题六: 分库分表技术选型问题 <a class="header-anchor" href="#问题六-分库分表技术选型问题" aria-label="Permalink to &quot;问题六: 分库分表技术选型问题&quot;">​</a></h4><h5 id="市场分库分表中间件相对􏰀多-框架各有各的优势与短板-应该如何选择" tabindex="-1">市场分库分表中间件相对􏰀多，框架各有各的优势与短板，应该如何选择 <a class="header-anchor" href="#市场分库分表中间件相对􏰀多-框架各有各的优势与短板-应该如何选择" aria-label="Permalink to &quot;市场分库分表中间件相对􏰀多，框架各有各的优势与短板，应该如何选择&quot;">​</a></h5><h2 id="垂直分表-也就是-大表拆小表-基于列字段进行的" tabindex="-1">垂直分表: 也就是“大表拆小表”，基于列字段进行的 <a class="header-anchor" href="#垂直分表-也就是-大表拆小表-基于列字段进行的" aria-label="Permalink to &quot;垂直分表: 也就是“大表拆小表”，基于列字段进行的&quot;">​</a></h2><h2 id="垂直分库-针对的是一个系统中的不同业务进行拆分" tabindex="-1">垂直分库: 针对的是一个系统中的不同业务进行拆分 <a class="header-anchor" href="#垂直分库-针对的是一个系统中的不同业务进行拆分" aria-label="Permalink to &quot;垂直分库: 针对的是一个系统中的不同业务进行拆分&quot;">​</a></h2><h2 id="水平分表-核心是把一个大表-分割n个小表-每个表的结构是一样的-数据不一样-全部表的数据合起来就是全部数据" tabindex="-1">水平分表: 核心是把一个大表，分割N个小表，每个表的结构是一样的，数据不一样，全部表的数据合起来就是全部数据 <a class="header-anchor" href="#水平分表-核心是把一个大表-分割n个小表-每个表的结构是一样的-数据不一样-全部表的数据合起来就是全部数据" aria-label="Permalink to &quot;水平分表: 核心是把一个大表，分割N个小表，每个表的结构是一样的，数据不一样，全部表的数据合起来就是全部数据&quot;">​</a></h2><h2 id="水平分库-水平分库是把不同表拆到不同数据库中-它是对数据行的拆分-不影响表结构" tabindex="-1">水平分库: 水平分库是把不同表拆到不同数据库中，它是对数据行的拆分，不影响表结构 <a class="header-anchor" href="#水平分库-水平分库是把不同表拆到不同数据库中-它是对数据行的拆分-不影响表结构" aria-label="Permalink to &quot;水平分库: 水平分库是把不同表拆到不同数据库中，它是对数据行的拆分，不影响表结构&quot;">​</a></h2><h1 id="动态指定sharding-jdbc-的雪花算法中的属性work-id属性" tabindex="-1">动态指定sharding jdbc 的雪花算法中的属性work.id属性 <a class="header-anchor" href="#动态指定sharding-jdbc-的雪花算法中的属性work-id属性" aria-label="Permalink to &quot;动态指定sharding jdbc 的雪花算法中的属性work.id属性&quot;">​</a></h1><h2 id="要百分百避免雪花算法中的workid重复-则需要动态指定sharding-jdbc的雪花算法中的属性work-id属性-通过调用system-setproperty-的方式实现-可用容器的-id-或者机器标识位" tabindex="-1">要百分百避免雪花算法中的workid重复，则需要动态指定sharding jdbc的雪花算法中的属性<code>work.id</code>属性，通过调用<code>System.setProperty()</code>的方式实现，可用容器的 id 或者机器标识位 <a class="header-anchor" href="#要百分百避免雪花算法中的workid重复-则需要动态指定sharding-jdbc的雪花算法中的属性work-id属性-通过调用system-setproperty-的方式实现-可用容器的-id-或者机器标识位" aria-label="Permalink to &quot;要百分百避免雪花算法中的workid重复，则需要动态指定sharding jdbc的雪花算法中的属性`work.id`属性，通过调用`System.setProperty()`的方式实现，可用容器的 id 或者机器标识位&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SnowFlakeWordIdConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 动态指定sharding jdbc 的雪花算法中的属性work.id属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 通过调用System.setProperty()的方式实现,可用容器的 id 或者机器标识位</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * workId最大值 1L &lt;&lt; 100，就是1024，即 0&lt;= workId &lt; 1024</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * {@linkSnowflakeShardingKeyGenerator#getWorkerId()}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            InetAddress ip4 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Inet4Address.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLocalHost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String hostAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ip4.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHostAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String workId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(hostAddress.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;workId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, workId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (UnknownHostException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BizException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BizCodeEnum.OPS_NETWORK_ADDRESS_ERROR);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="配置文件中使用" tabindex="-1">配置文件中使用 <a class="header-anchor" href="#配置文件中使用" aria-label="Permalink to &quot;配置文件中使用&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${workId}</span></span></code></pre></div><h3 id="时间回拨可能导致雪花算法id重复-在sharing-jdbc-4已经解决" tabindex="-1">时间回拨可能导致雪花算法ID重复，在sharing-jdbc 4已经解决 <a class="header-anchor" href="#时间回拨可能导致雪花算法id重复-在sharing-jdbc-4已经解决" aria-label="Permalink to &quot;时间回拨可能导致雪花算法ID重复，在sharing-jdbc 4已经解决&quot;">​</a></h3><h2 id="利用雪花算法生成唯一id" tabindex="-1">利用雪花算法生成唯一ID <a class="header-anchor" href="#利用雪花算法生成唯一id" aria-label="Permalink to &quot;利用雪花算法生成唯一ID&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IDUtil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SnowflakeShardingKeyGenerator shardingKeyGenerator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SnowflakeShardingKeyGenerator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 雪花算法生成器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Comparable&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">geneSnowFlakeID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shardingKeyGenerator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="敏感数据-自增id暴露的商业秘密" tabindex="-1">敏感数据+自增ID暴露的商业秘密 <a class="header-anchor" href="#敏感数据-自增id暴露的商业秘密" aria-label="Permalink to &quot;敏感数据+自增ID暴露的商业秘密&quot;">​</a></h1><h2 id="什么是数据脱敏" tabindex="-1">什么是数据脱敏 <a class="header-anchor" href="#什么是数据脱敏" aria-label="Permalink to &quot;什么是数据脱敏&quot;">​</a></h2><h3 id="也叫数据的去隐私化-在给定脱敏规则和策略的情况下-对敏感数据比如-手机号、身份证-等信息-进行转换或者修改的一种技术手段-防止敏感数据直接在不可靠的环境下使用和泄露、撞库等。" tabindex="-1">也叫数据的去隐私化，在给定脱敏规则和策略的情况下，对敏感数据比如 手机号、身份证 等信息，进行转换或者修改的一种技术手段，防止敏感数据直接在不可靠的环境下使用和泄露、撞库等。 <a class="header-anchor" href="#也叫数据的去隐私化-在给定脱敏规则和策略的情况下-对敏感数据比如-手机号、身份证-等信息-进行转换或者修改的一种技术手段-防止敏感数据直接在不可靠的环境下使用和泄露、撞库等。" aria-label="Permalink to &quot;也叫数据的去隐私化，在给定脱敏规则和策略的情况下，对敏感数据比如 手机号、身份证 等信息，进行转换或者修改的一种技术手段，防止敏感数据直接在不可靠的环境下使用和泄露、撞库等。&quot;">​</a></h3><h2 id="数据库业务规则安全-自增id暴露的商业秘密" tabindex="-1">数据库业务规则安全:自增ID暴露的商业秘密 <a class="header-anchor" href="#数据库业务规则安全-自增id暴露的商业秘密" aria-label="Permalink to &quot;数据库业务规则安全:自增ID暴露的商业秘密&quot;">​</a></h2><h3 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h3><h4 id="作为后端开发人员肯定离不开数据库设计-尽管你知道数据安全、接口安全、网络安全-但你也很大可能不小心暴露的公司的核心机密。" tabindex="-1">作为后端开发人员肯定离不开数据库设计，尽管你知道数据安全、接口安全、网络安全，但你也很大可能不小心暴露的公司的核心机密。 <a class="header-anchor" href="#作为后端开发人员肯定离不开数据库设计-尽管你知道数据安全、接口安全、网络安全-但你也很大可能不小心暴露的公司的核心机密。" aria-label="Permalink to &quot;作为后端开发人员肯定离不开数据库设计，尽管你知道数据安全、接口安全、网络安全，但你也很大可能不小心暴露的公司的核心机密。&quot;">​</a></h4><h4 id="【做空上市公司的股票】如果你有炒股-那你知道如果这个数据库设计漏洞被他人知道-就可以做空一个上司公司的股票的不" tabindex="-1">【做空上市公司的股票】如果你有炒股，那你知道如果这个数据库设计漏洞被他人知道，就可以做空一个上司公司的股票的不? <a class="header-anchor" href="#【做空上市公司的股票】如果你有炒股-那你知道如果这个数据库设计漏洞被他人知道-就可以做空一个上司公司的股票的不" aria-label="Permalink to &quot;【做空上市公司的股票】如果你有炒股，那你知道如果这个数据库设计漏洞被他人知道，就可以做空一个上司公司的股票的不?&quot;">​</a></h4><h5 id="【摧毁对手的利器】如果一个公司在是靠业务数据来说话的-如果被他人知道-在核心的时间点-被披露出来-那融资可能凉凉-企业可能面临倒闭。" tabindex="-1">【摧毁对手的利器】如果一个公司在是靠业务数据来说话的，如果被他人知道，在核心的时间点，被披露出来，那融资可能凉凉，企业可能面临倒闭。 <a class="header-anchor" href="#【摧毁对手的利器】如果一个公司在是靠业务数据来说话的-如果被他人知道-在核心的时间点-被披露出来-那融资可能凉凉-企业可能面临倒闭。" aria-label="Permalink to &quot;【摧毁对手的利器】如果一个公司在是靠业务数据来说话的，如果被他人知道，在核心的时间点，被披露出来，那融资可能凉凉，企业可能面临倒闭。&quot;">​</a></h5><h3 id="结语" tabindex="-1">结语 <a class="header-anchor" href="#结语" aria-label="Permalink to &quot;结语&quot;">​</a></h3><h4 id="合格的架构-不单止某个技术厉害-更要考虑和业务-商业上的结合。" tabindex="-1">合格的架构，不单止某个技术厉害，更要考虑和业务-商业上的结合。 <a class="header-anchor" href="#合格的架构-不单止某个技术厉害-更要考虑和业务-商业上的结合。" aria-label="Permalink to &quot;合格的架构，不单止某个技术厉害，更要考虑和业务-商业上的结合。&quot;">​</a></h4><h4 id="正常的业务表-会用自增id-但是也会加个业务id-如果有关联-则用-biz-id进行关联并返回" tabindex="-1">正常的业务表，会用自增id，但是也会加个业务id，如果有关联，则用 biz_id进行关联并返回 <a class="header-anchor" href="#正常的业务表-会用自增id-但是也会加个业务id-如果有关联-则用-biz-id进行关联并返回" aria-label="Permalink to &quot;正常的业务表，会用自增id，但是也会加个业务id，如果有关联，则用 biz_id进行关联并返回&quot;">​</a></h4><h4 id="其实最靠谱的就是-不要把有业务规则的id暴露给用户-不止id字段-类似的敏感字段都是" tabindex="-1">其实最靠谱的就是，不要把有业务规则的id暴露给用户，不止id字段，类似的敏感字段都是 <a class="header-anchor" href="#其实最靠谱的就是-不要把有业务规则的id暴露给用户-不止id字段-类似的敏感字段都是" aria-label="Permalink to &quot;其实最靠谱的就是，不要把有业务规则的id暴露给用户，不止id字段，类似的敏感字段都是&quot;">​</a></h4><h1 id="q-为什么要用62进制转换-不是64进制" tabindex="-1">Q: 为什么要用62进制转换，不是64进制？ <a class="header-anchor" href="#q-为什么要用62进制转换-不是64进制" aria-label="Permalink to &quot;Q: 为什么要用62进制转换，不是64进制？&quot;">​</a></h1><h2 id="_62进制转换是因为62进制转换后只含数字-小写-大写字母" tabindex="-1">62进制转换是因为62进制转换后只含数字+小写+大写字母 <a class="header-anchor" href="#_62进制转换是因为62进制转换后只含数字-小写-大写字母" aria-label="Permalink to &quot;62进制转换是因为62进制转换后只含数字+小写+大写字母&quot;">​</a></h2><h2 id="而64进制转换会含有-、-这样的符号-不符合正常url的字符" tabindex="-1">而64进制转换会含有/、+这样的符号(不符合正常URL的字符) <a class="header-anchor" href="#而64进制转换会含有-、-这样的符号-不符合正常url的字符" aria-label="Permalink to &quot;而64进制转换会含有/、+这样的符号(不符合正常URL的字符)&quot;">​</a></h2><h2 id="_10进制转62进制可以缩短字符-如果我们要6位字符的话-已经有560亿个组合了" tabindex="-1">10进制转62进制可以缩短字符，如果我们要6位字符的话，已经有560亿个组合了 <a class="header-anchor" href="#_10进制转62进制可以缩短字符-如果我们要6位字符的话-已经有560亿个组合了" aria-label="Permalink to &quot;10进制转62进制可以缩短字符，如果我们要6位字符的话，已经有560亿个组合了&quot;">​</a></h2><h1 id="分库分表多维度查询解决方案" tabindex="-1">分库分表多维度查询解决方案 <a class="header-anchor" href="#分库分表多维度查询解决方案" aria-label="Permalink to &quot;分库分表多维度查询解决方案&quot;">​</a></h1><h2 id="字段解析配置" tabindex="-1">字段解析配置 <a class="header-anchor" href="#字段解析配置" aria-label="Permalink to &quot;字段解析配置&quot;">​</a></h2><h3 id="code存储格式-库位-短链码-表位" tabindex="-1">code存储格式：库位+短链码+表位 <a class="header-anchor" href="#code存储格式-库位-短链码-表位" aria-label="Permalink to &quot;code存储格式：库位+短链码+表位&quot;">​</a></h3><h3 id="业务量超过评估量-分库分表-二次扩容的时候避免数据迁移" tabindex="-1">业务量超过评估量，分库分表-二次扩容的时候避免数据迁移 <a class="header-anchor" href="#业务量超过评估量-分库分表-二次扩容的时候避免数据迁移" aria-label="Permalink to &quot;业务量超过评估量，分库分表-二次扩容的时候避免数据迁移&quot;">​</a></h3><h3 id="不用一次性建立很多个库表-可以动态添加-节省服务器资源" tabindex="-1">不用一次性建立很多个库表，可以动态添加，节省服务器资源 <a class="header-anchor" href="#不用一次性建立很多个库表-可以动态添加-节省服务器资源" aria-label="Permalink to &quot;不用一次性建立很多个库表，可以动态添加，节省服务器资源&quot;">​</a></h3><p><img src="/images/80a9fb82a46ac744a3d5ebe1531bca42.jpeg" alt=""></p><h2 id="nosql" tabindex="-1">NOSQL <a class="header-anchor" href="#nosql" aria-label="Permalink to &quot;NOSQL&quot;">​</a></h2><p><img src="/images/b5367350c70eb7c713abd31a69ee1e58.jpeg" alt=""></p><h2 id="冗余双写方案" tabindex="-1">冗余双写方案 <a class="header-anchor" href="#冗余双写方案" aria-label="Permalink to &quot;冗余双写方案&quot;">​</a></h2><p><img src="/images/b4655541791398c7defd4ce8e8ec36af.jpeg" alt=""></p><h3 id="缺点-并发事物带来性能问题" tabindex="-1">缺点：并发事物带来性能问题 <a class="header-anchor" href="#缺点-并发事物带来性能问题" aria-label="Permalink to &quot;缺点：并发事物带来性能问题&quot;">​</a></h3><h3 id="优化解决方案" tabindex="-1">优化解决方案 <a class="header-anchor" href="#优化解决方案" aria-label="Permalink to &quot;优化解决方案&quot;">​</a></h3><p><img src="/images/d1cafb0282d9301881aa6ba5d30f6c32.jpeg" alt=""></p><h1 id="数据库表负载均衡" tabindex="-1">数据库表负载均衡 <a class="header-anchor" href="#数据库表负载均衡" aria-label="Permalink to &quot;数据库表负载均衡&quot;">​</a></h1><blockquote><p>使用加权库表位算法，解决扩容后数据倾斜不均匀问题</p></blockquote><h2 id="数据库权重算法" tabindex="-1">数据库权重算法 <a class="header-anchor" href="#数据库权重算法" aria-label="Permalink to &quot;数据库权重算法&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ShardingDBConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 存储数据库位置编号</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> List&lt;Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; dbPrefixList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ArrayList&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Random random </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //配置启用那些库的前缀</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dbPrefixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dbPrefixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dbPrefixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;6&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getTotalWeight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalWeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dbPrefixList) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            totalWeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weight;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalWeight;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 获取随机的前缀</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 根据权重获取value，负载均衡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRandomDBPrefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalWeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getTotalWeight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomNum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> random.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(totalWeight);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dbPrefixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dbPrefixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 权重越大，被减去小于0的可能性更大</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            randomNum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weight;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (randomNum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                randomIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dbPrefixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(randomIndex).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="数据表权重算法" tabindex="-1">数据表权重算法 <a class="header-anchor" href="#数据表权重算法" aria-label="Permalink to &quot;数据表权重算法&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ShardingTableConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 存储数据表位置编号</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> List&lt;Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; tableSuffixList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ArrayList&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Random random </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 配置启用哪些表的后缀</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tableSuffixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tableSuffixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getTotalWeight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalWeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tableSuffixList) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            totalWeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weight;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalWeight;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 获取随机的后缀</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRandomTableSuffix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> totalWeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getTotalWeight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> randomNum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> random.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(totalWeight);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tableSuffixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tableSuffixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;weight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            randomNum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weight;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (randomNum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                randomIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tableSuffixList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(randomIndex).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="创建短链关键代码" tabindex="-1">创建短链关键代码 <a class="header-anchor" href="#创建短链关键代码" aria-label="Permalink to &quot;创建短链关键代码&quot;">​</a></h2><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createShortLinkCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String originalUrl) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> murmur32 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CommonUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">murmurHash32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(originalUrl);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //转62进制</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> encodeToBase62</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(murmur32);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String shortLinkCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ShardingDBConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRandomDBPrefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ShardingTableConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRandomTableSuffix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shortLinkCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="rabbitmq" tabindex="-1">RabbitMQ <a class="header-anchor" href="#rabbitmq" aria-label="Permalink to &quot;RabbitMQ&quot;">​</a></h1><h2 id="选择rabbitmq理由" tabindex="-1">选择RabbitMQ理由 <a class="header-anchor" href="#选择rabbitmq理由" aria-label="Permalink to &quot;选择RabbitMQ理由&quot;">​</a></h2><h3 id="业务开发团队本身熟悉rabbitmq-对内-省了学习成本、运维成本、现有基础设施" tabindex="-1">业务开发团队本身熟悉RabbitMQ(对内，省了学习成本、运维成本、现有基础设施) <a class="header-anchor" href="#业务开发团队本身熟悉rabbitmq-对内-省了学习成本、运维成本、现有基础设施" aria-label="Permalink to &quot;业务开发团队本身熟悉RabbitMQ(对内，省了学习成本、运维成本、现有基础设施)&quot;">​</a></h3><h3 id="rabbitmq自带延迟队列-更适合业务这块-比如定时任务、分布式事务处理" tabindex="-1">RabbitMQ自带延迟队列，更适合业务这块，比如定时任务、分布式事务处理 <a class="header-anchor" href="#rabbitmq自带延迟队列-更适合业务这块-比如定时任务、分布式事务处理" aria-label="Permalink to &quot;RabbitMQ自带延迟队列，更适合业务这块，比如定时任务、分布式事务处理&quot;">​</a></h3><h3 id="kafka比较适合在大数据领域流式计算" tabindex="-1">Kafka比较适合在大数据领域流式计算 <a class="header-anchor" href="#kafka比较适合在大数据领域流式计算" aria-label="Permalink to &quot;Kafka比较适合在大数据领域流式计算&quot;">​</a></h3><h2 id="routingkey和bindingkey的作用" tabindex="-1">RoutingKey和BindingKey的作用 <a class="header-anchor" href="#routingkey和bindingkey的作用" aria-label="Permalink to &quot;RoutingKey和BindingKey的作用&quot;">​</a></h2><h3 id="区别发送的绑定的概念" tabindex="-1">区别发送的绑定的概念 <a class="header-anchor" href="#区别发送的绑定的概念" aria-label="Permalink to &quot;区别发送的绑定的概念&quot;">​</a></h3><h3 id="routingkey-是发送时用-细化到具体名称" tabindex="-1">routingKey 是发送时用，细化到具体名称 <a class="header-anchor" href="#routingkey-是发送时用-细化到具体名称" aria-label="Permalink to &quot;routingKey 是发送时用，细化到具体名称&quot;">​</a></h3><h3 id="bindingkey-是绑定时使用-通常包含通配符" tabindex="-1">bindingKey 是绑定时使用，通常包含通配符 <a class="header-anchor" href="#bindingkey-是绑定时使用-通常包含通配符" aria-label="Permalink to &quot;bindingKey 是绑定时使用，通常包含通配符&quot;">​</a></h3><h2 id="mq不会自动创建队列解决方案" tabindex="-1">MQ不会自动创建队列解决方案 <a class="header-anchor" href="#mq不会自动创建队列解决方案" aria-label="Permalink to &quot;MQ不会自动创建队列解决方案&quot;">​</a></h2><h3 id="懒加载-bean-rabbitlistener" tabindex="-1">懒加载：@Bean+@RabbitListener <a class="header-anchor" href="#懒加载-bean-rabbitlistener" aria-label="Permalink to &quot;懒加载：@Bean+@RabbitListener&quot;">​</a></h3><h3 id="没有-bean-用queuestodeclare也会自动创建" tabindex="-1">没有@Bean，用queuesToDeclare也会自动创建 <a class="header-anchor" href="#没有-bean-用queuestodeclare也会自动创建" aria-label="Permalink to &quot;没有@Bean，用queuesToDeclare也会自动创建&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RabbitListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">queuesToDeclare</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;short_link.add.link.queue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) })</span></span></code></pre></div><h2 id="mq冗余双写带来的问题" tabindex="-1">MQ冗余双写带来的问题 <a class="header-anchor" href="#mq冗余双写带来的问题" aria-label="Permalink to &quot;MQ冗余双写带来的问题&quot;">​</a></h2><h3 id="短链码是哪里生成的-生产者端还是消费者端" tabindex="-1">短链码是哪里生成的？生产者端还是消费者端？ <a class="header-anchor" href="#短链码是哪里生成的-生产者端还是消费者端" aria-label="Permalink to &quot;短链码是哪里生成的？生产者端还是消费者端？&quot;">​</a></h3><h3 id="短链码重复了怎么办" tabindex="-1">短链码重复了怎么办？ <a class="header-anchor" href="#短链码重复了怎么办" aria-label="Permalink to &quot;短链码重复了怎么办？&quot;">​</a></h3><h4 id="生产者端生成-怎么保证短链码发送前、消费后一致性" tabindex="-1">生产者端生成，怎么保证短链码发送前、消费后一致性？ <a class="header-anchor" href="#生产者端生成-怎么保证短链码发送前、消费后一致性" aria-label="Permalink to &quot;生产者端生成，怎么保证短链码发送前、消费后一致性？&quot;">​</a></h4><h4 id="消费者端生成-b端和c端并非同时插入-怎么保证短链码一致性" tabindex="-1">消费者端生成，B端和C端并非同时插入，怎么保证短链码一致性？ <a class="header-anchor" href="#消费者端生成-b端和c端并非同时插入-怎么保证短链码一致性" aria-label="Permalink to &quot;消费者端生成，B端和C端并非同时插入，怎么保证短链码一致性？&quot;">​</a></h4><h3 id="解决方案-分布式重入锁" tabindex="-1">解决方案：分布式重入锁 <a class="header-anchor" href="#解决方案-分布式重入锁" aria-label="Permalink to &quot;解决方案：分布式重入锁&quot;">​</a></h3><h4 id="先判断是否有-如没这个key-则设置key-value-配置过期时间-加锁成功" tabindex="-1">先判断是否有，如没这个key，则设置key-value，配置过期时间，加锁成功 <a class="header-anchor" href="#先判断是否有-如没这个key-则设置key-value-配置过期时间-加锁成功" aria-label="Permalink to &quot;先判断是否有，如没这个key，则设置key-value，配置过期时间，加锁成功&quot;">​</a></h4><h4 id="如果有同个key-则判断value是否为同一个账号-如果是则返回加锁成功" tabindex="-1">如果有同个key，则判断value是否为同一个账号，如果是则返回加锁成功 <a class="header-anchor" href="#如果有同个key-则判断value是否为同一个账号-如果是则返回加锁成功" aria-label="Permalink to &quot;如果有同个key，则判断value是否为同一个账号，如果是则返回加锁成功&quot;">​</a></h4><h4 id="如果不是同个账号则加锁失败" tabindex="-1">如果不是同个账号则加锁失败 <a class="header-anchor" href="#如果不是同个账号则加锁失败" aria-label="Permalink to &quot;如果不是同个账号则加锁失败&quot;">​</a></h4><h5 id="解决方式-配置key过期时间久点-比如2-5天" tabindex="-1">解决方式，配置key过期时间久点，比如2~5天 <a class="header-anchor" href="#解决方式-配置key过期时间久点-比如2-5天" aria-label="Permalink to &quot;解决方式，配置key过期时间久点，比如2~5天&quot;">​</a></h5><h2 id="以下情况会发生队列转发" tabindex="-1">以下情况会发生队列转发 <a class="header-anchor" href="#以下情况会发生队列转发" aria-label="Permalink to &quot;以下情况会发生队列转发&quot;">​</a></h2><h3 id="延迟队列" tabindex="-1">延迟队列 <a class="header-anchor" href="#延迟队列" aria-label="Permalink to &quot;延迟队列&quot;">​</a></h3><h4 id="未被消费并且超时后转发的队列" tabindex="-1">未被消费并且超时后转发的队列 <a class="header-anchor" href="#未被消费并且超时后转发的队列" aria-label="Permalink to &quot;未被消费并且超时后转发的队列&quot;">​</a></h4><h3 id="消息消费超过一定重试次数-需要改为自动ack确认消息" tabindex="-1">消息消费超过一定重试次数(需要改为自动ack确认消息) <a class="header-anchor" href="#消息消费超过一定重试次数-需要改为自动ack确认消息" aria-label="Permalink to &quot;消息消费超过一定重试次数(需要改为自动ack确认消息)&quot;">​</a></h3><h3 id="队列超过长度" tabindex="-1">队列超过长度 <a class="header-anchor" href="#队列超过长度" aria-label="Permalink to &quot;队列超过长度&quot;">​</a></h3><h4 id="防重提交注解实现" tabindex="-1">防重提交注解实现 <a class="header-anchor" href="#防重提交注解实现" aria-label="Permalink to &quot;防重提交注解实现&quot;">​</a></h4><h2 id="元注解-注解的注解" tabindex="-1">元注解：注解的注解 <a class="header-anchor" href="#元注解-注解的注解" aria-label="Permalink to &quot;元注解：注解的注解&quot;">​</a></h2><h3 id="元注解定义" tabindex="-1">元注解定义 <a class="header-anchor" href="#元注解定义" aria-label="Permalink to &quot;元注解定义&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Documented</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ElementType.METHOD)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Retention</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RetentionPolicy.RUNTIME)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> RepeatSubmit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 防重复提交，支持两种，一个是方法参数，一个是令牌</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PARAM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TOKEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 防重复提交方式，默认是方法参数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * @return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Type </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">limitType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Type.PARAM;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 加锁过期时间，默认是5秒</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * @return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    long</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lockTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">default</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="documented-可以在-doc-中使用注解" tabindex="-1">@Documented 可以在 doc 中使用注解 <a class="header-anchor" href="#documented-可以在-doc-中使用注解" aria-label="Permalink to &quot;@Documented 可以在 doc 中使用注解&quot;">​</a></h4><h4 id="target-elementtype-method-可以在方法上使用注解" tabindex="-1">@Target(ElementType.METHOD) 可以在方法上使用注解 <a class="header-anchor" href="#target-elementtype-method-可以在方法上使用注解" aria-label="Permalink to &quot;@Target(ElementType.METHOD) 可以在方法上使用注解&quot;">​</a></h4><h4 id="retention-retentionpolicy-runtime-在运行时作用-可以用反射获取类" tabindex="-1">@Retention(RetentionPolicy.RUNTIME) 在运行时作用，可以用反射获取类 <a class="header-anchor" href="#retention-retentionpolicy-runtime-在运行时作用-可以用反射获取类" aria-label="Permalink to &quot;@Retention(RetentionPolicy.RUNTIME) 在运行时作用，可以用反射获取类&quot;">​</a></h4><h3 id="注解切面类实现" tabindex="-1">注解切面类实现 <a class="header-anchor" href="#注解切面类实现" aria-label="Permalink to &quot;注解切面类实现&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Aspect</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RepeatSubmitAspect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StringRedisTemplate redisTemplate;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RedissonClient redissonClient;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 定义 @Pointcut注解表达式，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 方式一：@annotation：当执行的方法上拥有指定的注解时生效（我们采用这）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 方式二：execution：一般用于指定方法的执行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Pointcut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@annotation(repeatSubmit)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pointCutNoRepeatSubmit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RepeatSubmit </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">repeatSubmit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 环绕通知, 围绕着方法执行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> joinPoint</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> repeatSubmit</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@throws</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Throwable</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * @Around 可以用来在调用一个具体方法前和调用后来完成一些具体的任务。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 方式一：单用 @Around(&quot;execution(* net.xdclass.controller.*.*(..))&quot;)可以</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 方式二：用@Pointcut和@Around联合注解也可以（我们采用这个）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 两种方式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 方式一：加锁 固定时间内不能重复提交</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 方式二：先请求获取token，这边再删除token,删除成功则是第一次提交</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Around</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pointCutNoRepeatSubmit(repeatSubmit)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Object </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">around</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ProceedingJoinPoint </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">joinPoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, RepeatSubmit </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">repeatSubmit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Throwable {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HttpServletRequest request </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((ServletRequestAttributes) RequestContextHolder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRequestAttributes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accountNo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LoginInterceptor.threadLocal.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAccountNo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //用于记录成功或者失败</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //防重提交类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> repeatSubmit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">limitType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (type.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsIgnoreCase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RepeatSubmit.Type.PARAM.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //方式一，参数形式防重提交</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lockTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> repeatSubmit.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lockTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String ipAddr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CommonUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getIpAddr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            MethodSignature methodSignature </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (MethodSignature) joinPoint.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSignature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Method method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> methodSignature.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String className </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> method.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDeclaringClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;order-service:repeat_submit:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CommonUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MD5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;%s-%s-%s-%s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ipAddr, className, method, accountNo));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 加锁</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // redisTemplate.opsForValue().setIfAbsent(key, &quot;1&quot;, lockTime, TimeUnit.SECONDS);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            RLock lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redissonClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 尝试加锁，最多等待0秒，上锁以后5秒自动解锁 [lockTime默认为5s, 可以自定义]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lock.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tryLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lockTime, TimeUnit.SECONDS);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //方式二，令牌形式防重提交</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String requestToken </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;request-token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (StringUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isBlank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(requestToken)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BizException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BizCodeEnum.ORDER_CONFIRM_TOKEN_EQUAL_FAIL);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RedisKey.SUBMIT_ORDER_TOKEN_KEY, accountNo, requestToken);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             * 提交表单的token key</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             * 方式一：不用lua脚本获取再判断，之前是因为 key组成是 order:submit:accountNo, value是对应的token，所以需要先获取值，再判断</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             * 方式二：可以直接key是 order:submit:accountNo:token,然后直接删除成功则完成</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BizException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BizCodeEnum.ORDER_CONFIRM_REPEAT);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;环绕通知执行前&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Object obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> joinPoint.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">proceed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;环绕通知执行后&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="aspect-定义这是一个切面类" tabindex="-1">@Aspect 定义这是一个切面类 <a class="header-anchor" href="#aspect-定义这是一个切面类" aria-label="Permalink to &quot;@Aspect 定义这是一个切面类&quot;">​</a></h4><h4 id="component-加入-springboot-容器" tabindex="-1">@Component 加入 SpringBoot 容器 <a class="header-anchor" href="#component-加入-springboot-容器" aria-label="Permalink to &quot;@Component 加入 SpringBoot 容器&quot;">​</a></h4><h1 id="订单更新和流量包权益更新" tabindex="-1">订单更新和流量包权益更新 <a class="header-anchor" href="#订单更新和流量包权益更新" aria-label="Permalink to &quot;订单更新和流量包权益更新&quot;">​</a></h1><h2 id="不推荐同步调用-造成高并发性能问题和分布式事务问题" tabindex="-1">不推荐同步调用，造成高并发性能问题和分布式事务问题 <a class="header-anchor" href="#不推荐同步调用-造成高并发性能问题和分布式事务问题" aria-label="Permalink to &quot;不推荐同步调用，造成高并发性能问题和分布式事务问题&quot;">​</a></h2><h2 id="方案一-直接进入队列冗余双写-然后响应微信支付接口-再消费消息-更新数据库订单状态和发放流量包" tabindex="-1">方案一：直接进入队列冗余双写，然后响应微信支付接口，再消费消息-更新数据库订单状态和发放流量包 <a class="header-anchor" href="#方案一-直接进入队列冗余双写-然后响应微信支付接口-再消费消息-更新数据库订单状态和发放流量包" aria-label="Permalink to &quot;方案一：直接进入队列冗余双写，然后响应微信支付接口，再消费消息-更新数据库订单状态和发放流量包&quot;">​</a></h2><p><img src="/images/6a5c30e8d7927a911efe48cac7ef61ac.jpeg" alt=""></p><h2 id="方案二-折中方案-接收微信回调通知更新数据库-发送新增流量包-mq-消息-响应微信-再消费流量包消息" tabindex="-1">方案二：折中方案，接收微信回调通知更新数据库，发送新增流量包 MQ 消息，响应微信，再消费流量包消息 <a class="header-anchor" href="#方案二-折中方案-接收微信回调通知更新数据库-发送新增流量包-mq-消息-响应微信-再消费流量包消息" aria-label="Permalink to &quot;方案二：折中方案，接收微信回调通知更新数据库，发送新增流量包 MQ 消息，响应微信，再消费流量包消息&quot;">​</a></h2><p><img src="/images/cbfd4eb508c2c9afbffa2057b8fc2923.jpeg" alt=""></p><h2 id="高并发下扣减流量包解决方案-通用秒杀" tabindex="-1">高并发下扣减流量包解决方案-通用秒杀 <a class="header-anchor" href="#高并发下扣减流量包解决方案-通用秒杀" aria-label="Permalink to &quot;高并发下扣减流量包解决方案-通用秒杀&quot;">​</a></h2><h3 id="如果创建短链加上rpc调用扣减流量包接口-性能是非常差的" tabindex="-1">如果创建短链加上rpc调用扣减流量包接口，性能是非常差的 <a class="header-anchor" href="#如果创建短链加上rpc调用扣减流量包接口-性能是非常差的" aria-label="Permalink to &quot;如果创建短链加上rpc调用扣减流量包接口，性能是非常差的&quot;">​</a></h3><h3 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h3><h4 id="使用预扣减-存入redis中-key的过期时间刚好是流量包的过期时间。" tabindex="-1">使用预扣减，存入redis中，key的过期时间刚好是流量包的过期时间。 <a class="header-anchor" href="#使用预扣减-存入redis中-key的过期时间刚好是流量包的过期时间。" aria-label="Permalink to &quot;使用预扣减，存入redis中，key的过期时间刚好是流量包的过期时间。&quot;">​</a></h4><h4 id="第一次redis中没有key-则一定有免费流量包-直接创建短链-然后在消费端消费后存入当前剩余流量包到redis中" tabindex="-1">第一次redis中没有key，则一定有免费流量包，直接创建短链，然后在消费端消费后存入当前剩余流量包到redis中 <a class="header-anchor" href="#第一次redis中没有key-则一定有免费流量包-直接创建短链-然后在消费端消费后存入当前剩余流量包到redis中" aria-label="Permalink to &quot;第一次redis中没有key，则一定有免费流量包，直接创建短链，然后在消费端消费后存入当前剩余流量包到redis中&quot;">​</a></h4><p><img src="/images/1b2d67d94e1826ae5f636a594e7abef0.jpeg" alt=""></p><h1 id="流量包服务" tabindex="-1">流量包服务 <a class="header-anchor" href="#流量包服务" aria-label="Permalink to &quot;流量包服务&quot;">​</a></h1><h2 id="流量包订单不是用户经常关注的-因此并发量不高-只需要分表避免单表数据过多" tabindex="-1">流量包订单不是用户经常关注的，因此并发量不高，只需要分表避免单表数据过多 <a class="header-anchor" href="#流量包订单不是用户经常关注的-因此并发量不高-只需要分表避免单表数据过多" aria-label="Permalink to &quot;流量包订单不是用户经常关注的，因此并发量不高，只需要分表避免单表数据过多&quot;">​</a></h2><h2 id="订单下单模块链路流程分析" tabindex="-1">订单下单模块链路流程分析 <a class="header-anchor" href="#订单下单模块链路流程分析" aria-label="Permalink to &quot;订单下单模块链路流程分析&quot;">​</a></h2><h3 id="防重提交-重点" tabindex="-1">防重提交(重点) <a class="header-anchor" href="#防重提交-重点" aria-label="Permalink to &quot;防重提交(重点)&quot;">​</a></h3><h4 id="服务端token令牌" tabindex="-1">服务端token令牌 <a class="header-anchor" href="#服务端token令牌" aria-label="Permalink to &quot;服务端token令牌&quot;">​</a></h4><h4 id="aop-自定义注解" tabindex="-1">AOP+自定义注解 <a class="header-anchor" href="#aop-自定义注解" aria-label="Permalink to &quot;AOP+自定义注解&quot;">​</a></h4><h3 id="获取最新的流量包价格" tabindex="-1">获取最新的流量包价格 <a class="header-anchor" href="#获取最新的流量包价格" aria-label="Permalink to &quot;获取最新的流量包价格&quot;">​</a></h3><h3 id="订单验价" tabindex="-1">订单验价 <a class="header-anchor" href="#订单验价" aria-label="Permalink to &quot;订单验价&quot;">​</a></h3><h4 id="如果有优惠券或者其他抵扣" tabindex="-1">如果有优惠券或者其他抵扣 <a class="header-anchor" href="#如果有优惠券或者其他抵扣" aria-label="Permalink to &quot;如果有优惠券或者其他抵扣&quot;">​</a></h4><h4 id="验证前端显示和后台计算价格" tabindex="-1">验证前端显示和后台计算价格 <a class="header-anchor" href="#验证前端显示和后台计算价格" aria-label="Permalink to &quot;验证前端显示和后台计算价格&quot;">​</a></h4><h3 id="创建订单对象保存数据库" tabindex="-1">创建订单对象保存数据库 <a class="header-anchor" href="#创建订单对象保存数据库" aria-label="Permalink to &quot;创建订单对象保存数据库&quot;">​</a></h3><h3 id="发送延迟消息-用于自动关单-重点" tabindex="-1">发送延迟消息-用于自动关单(重点) <a class="header-anchor" href="#发送延迟消息-用于自动关单-重点" aria-label="Permalink to &quot;发送延迟消息-用于自动关单(重点)&quot;">​</a></h3><h3 id="创建支付信息-对接三方支付-重点" tabindex="-1">创建支付信息-对接三方支付(重点) <a class="header-anchor" href="#创建支付信息-对接三方支付-重点" aria-label="Permalink to &quot;创建支付信息-对接三方支付(重点)&quot;">​</a></h3><h3 id="回调更新订单状态-重点" tabindex="-1">回调更新订单状态(重点) <a class="header-anchor" href="#回调更新订单状态-重点" aria-label="Permalink to &quot;回调更新订单状态(重点)&quot;">​</a></h3><h3 id="支付成功创建流量包-重点" tabindex="-1">支付成功创建流量包(重点) <a class="header-anchor" href="#支付成功创建流量包-重点" aria-label="Permalink to &quot;支付成功创建流量包(重点)&quot;">​</a></h3><h2 id="支付平台使用非对称加密算法" tabindex="-1">支付平台使用非对称加密算法 <a class="header-anchor" href="#支付平台使用非对称加密算法" aria-label="Permalink to &quot;支付平台使用非对称加密算法&quot;">​</a></h2><h3 id="一套或者两套rsa加密都可以-具体看平台机制。" tabindex="-1">一套或者两套RSA加密都可以，具体看平台机制。 <a class="header-anchor" href="#一套或者两套rsa加密都可以-具体看平台机制。" aria-label="Permalink to &quot;一套或者两套RSA加密都可以，具体看平台机制。&quot;">​</a></h3><h3 id="一套" tabindex="-1">一套 <a class="header-anchor" href="#一套" aria-label="Permalink to &quot;一套&quot;">​</a></h3><h4 id="应用用私钥加密发送-支付平台用公钥解密" tabindex="-1">应用用私钥加密发送，支付平台用公钥解密 <a class="header-anchor" href="#应用用私钥加密发送-支付平台用公钥解密" aria-label="Permalink to &quot;应用用私钥加密发送，支付平台用公钥解密&quot;">​</a></h4><h4 id="支付平台用公钥加密发送-应用用私钥解密" tabindex="-1">支付平台用公钥加密发送，应用用私钥解密 <a class="header-anchor" href="#支付平台用公钥加密发送-应用用私钥解密" aria-label="Permalink to &quot;支付平台用公钥加密发送，应用用私钥解密&quot;">​</a></h4><h3 id="两套公钥和私钥" tabindex="-1">两套公钥和私钥 <a class="header-anchor" href="#两套公钥和私钥" aria-label="Permalink to &quot;两套公钥和私钥&quot;">​</a></h3><h4 id="应用给支付平台发送信息一套-支付平台给应用发送-回调-信息一套" tabindex="-1">应用给支付平台发送信息一套，支付平台给应用发送(回调)信息一套 <a class="header-anchor" href="#应用给支付平台发送信息一套-支付平台给应用发送-回调-信息一套" aria-label="Permalink to &quot;应用给支付平台发送信息一套，支付平台给应用发送(回调)信息一套&quot;">​</a></h4><h4 id="两套rsa加密" tabindex="-1">两套RSA加密 <a class="header-anchor" href="#两套rsa加密" aria-label="Permalink to &quot;两套RSA加密&quot;">​</a></h4><h5 id="一套用于保证统一下单时的信息安全" tabindex="-1">一套用于保证统一下单时的信息安全 <a class="header-anchor" href="#一套用于保证统一下单时的信息安全" aria-label="Permalink to &quot;一套用于保证统一下单时的信息安全&quot;">​</a></h5><h5 id="另一套用于保证支付平台回调时的信息安全" tabindex="-1">另一套用于保证支付平台回调时的信息安全 <a class="header-anchor" href="#另一套用于保证支付平台回调时的信息安全" aria-label="Permalink to &quot;另一套用于保证支付平台回调时的信息安全&quot;">​</a></h5><h1 id="aop" tabindex="-1">AOP <a class="header-anchor" href="#aop" aria-label="Permalink to &quot;AOP&quot;">​</a></h1><h2 id="能否解释下aop里面常⻅的概念-比如-横切、通知、连接点、切入点、切面" tabindex="-1">能否解释下AOP里面常⻅的概念，比如 横切、通知、连接点、切入点、切面 ? <a class="header-anchor" href="#能否解释下aop里面常⻅的概念-比如-横切、通知、连接点、切入点、切面" aria-label="Permalink to &quot;能否解释下AOP里面常⻅的概念，比如 横切、通知、连接点、切入点、切面 ?&quot;">​</a></h2><h2 id="横切关注点" tabindex="-1">横切关注点 <a class="header-anchor" href="#横切关注点" aria-label="Permalink to &quot;横切关注点&quot;">​</a></h2><h3 id="对哪些方法进行拦截-拦截后怎么处理-这些就叫横切关-注点" tabindex="-1">对哪些方法进行拦截，拦截后怎么处理，这些就叫横切关 注点 <a class="header-anchor" href="#对哪些方法进行拦截-拦截后怎么处理-这些就叫横切关-注点" aria-label="Permalink to &quot;对哪些方法进行拦截，拦截后怎么处理，这些就叫横切关 注点&quot;">​</a></h3><h3 id="比如-权限认证、日志、事物" tabindex="-1">比如 权限认证、日志、事物 <a class="header-anchor" href="#比如-权限认证、日志、事物" aria-label="Permalink to &quot;比如 权限认证、日志、事物&quot;">​</a></h3><h2 id="通知-advice" tabindex="-1">通知 Advice <a class="header-anchor" href="#通知-advice" aria-label="Permalink to &quot;通知 Advice&quot;">​</a></h2><h3 id="在特定的切入点上执行的增强处理" tabindex="-1">在特定的切入点上执行的增强处理 <a class="header-anchor" href="#在特定的切入点上执行的增强处理" aria-label="Permalink to &quot;在特定的切入点上执行的增强处理&quot;">​</a></h3><h3 id="做啥-比如你需要记录日志-控制事务-提前编写好通用-的模块-需要的地方直接调用" tabindex="-1">做啥? 比如你需要记录日志，控制事务 ，提前编写好通用 的模块，需要的地方直接调用 <a class="header-anchor" href="#做啥-比如你需要记录日志-控制事务-提前编写好通用-的模块-需要的地方直接调用" aria-label="Permalink to &quot;做啥? 比如你需要记录日志，控制事务 ，提前编写好通用 的模块，需要的地方直接调用&quot;">​</a></h3><h3 id="比如重复提交判断逻辑" tabindex="-1">比如重复提交判断逻辑 <a class="header-anchor" href="#比如重复提交判断逻辑" aria-label="Permalink to &quot;比如重复提交判断逻辑&quot;">​</a></h3><h3 id="类型" tabindex="-1">类型 <a class="header-anchor" href="#类型" aria-label="Permalink to &quot;类型&quot;">​</a></h3><h4 id="before前置通知" tabindex="-1">@Before前置通知 <a class="header-anchor" href="#before前置通知" aria-label="Permalink to &quot;@Before前置通知&quot;">​</a></h4><h5 id="在执行目标方法之前运行" tabindex="-1">在执行目标方法之前运行 <a class="header-anchor" href="#在执行目标方法之前运行" aria-label="Permalink to &quot;在执行目标方法之前运行&quot;">​</a></h5><h4 id="after后置通知" tabindex="-1">@After后置通知 <a class="header-anchor" href="#after后置通知" aria-label="Permalink to &quot;@After后置通知&quot;">​</a></h4><h5 id="在目标方法运行结束之后" tabindex="-1">在目标方法运行结束之后 <a class="header-anchor" href="#在目标方法运行结束之后" aria-label="Permalink to &quot;在目标方法运行结束之后&quot;">​</a></h5><h4 id="afterreturning返回通知" tabindex="-1">@AfterReturning返回通知 <a class="header-anchor" href="#afterreturning返回通知" aria-label="Permalink to &quot;@AfterReturning返回通知&quot;">​</a></h4><h5 id="在目标方法正常返回值后运行" tabindex="-1">在目标方法正常返回值后运行 <a class="header-anchor" href="#在目标方法正常返回值后运行" aria-label="Permalink to &quot;在目标方法正常返回值后运行&quot;">​</a></h5><h4 id="afterthrowing异常通知" tabindex="-1">@AfterThrowing异常通知 <a class="header-anchor" href="#afterthrowing异常通知" aria-label="Permalink to &quot;@AfterThrowing异常通知&quot;">​</a></h4><h5 id="在目标方法出现异常后运行" tabindex="-1">在目标方法出现异常后运行 <a class="header-anchor" href="#在目标方法出现异常后运行" aria-label="Permalink to &quot;在目标方法出现异常后运行&quot;">​</a></h5><h4 id="around环绕通知" tabindex="-1">@Around环绕通知 <a class="header-anchor" href="#around环绕通知" aria-label="Permalink to &quot;@Around环绕通知&quot;">​</a></h4><h5 id="在目标方法完成前、后做增强处理-环绕通知是最重要的通知类型-像事务-日志等都是环绕通知-注意编-程中核心是一个proceedingjoinpoint-需要手动执行-joinpoint-procced" tabindex="-1">在目标方法完成前、后做增强处理 ,环绕通知是最重要的通知类型 ,像事务,日志等都是环绕通知,注意编 程中核心是一个ProceedingJoinPoint，需要手动执行 joinPoint.procced() <a class="header-anchor" href="#在目标方法完成前、后做增强处理-环绕通知是最重要的通知类型-像事务-日志等都是环绕通知-注意编-程中核心是一个proceedingjoinpoint-需要手动执行-joinpoint-procced" aria-label="Permalink to &quot;在目标方法完成前、后做增强处理 ,环绕通知是最重要的通知类型 ,像事务,日志等都是环绕通知,注意编 程中核心是一个ProceedingJoinPoint，需要手动执行 joinPoint.procced()&quot;">​</a></h5><h2 id="连接点-jointpoint" tabindex="-1">连接点 JointPoint <a class="header-anchor" href="#连接点-jointpoint" aria-label="Permalink to &quot;连接点 JointPoint&quot;">​</a></h2><h3 id="要用通知的地方-业务流程在运行过程中需要插入切面的具体位置" tabindex="-1">要用通知的地方，业务流程在运行过程中需要插入切面的具体位置， <a class="header-anchor" href="#要用通知的地方-业务流程在运行过程中需要插入切面的具体位置" aria-label="Permalink to &quot;要用通知的地方，业务流程在运行过程中需要插入切面的具体位置，&quot;">​</a></h3><h3 id="一般是方法的调用前后-全部方法都可以是连接点" tabindex="-1">一般是方法的调用前后，全部方法都可以是连接点 <a class="header-anchor" href="#一般是方法的调用前后-全部方法都可以是连接点" aria-label="Permalink to &quot;一般是方法的调用前后，全部方法都可以是连接点&quot;">​</a></h3><h3 id="只是概念-没啥特殊" tabindex="-1">只是概念，没啥特殊 <a class="header-anchor" href="#只是概念-没啥特殊" aria-label="Permalink to &quot;只是概念，没啥特殊&quot;">​</a></h3><h2 id="切入点-pointcut" tabindex="-1">切入点 Pointcut <a class="header-anchor" href="#切入点-pointcut" aria-label="Permalink to &quot;切入点 Pointcut&quot;">​</a></h2><h3 id="不能全部方法都是连接点-通过特定的规则来筛选连接点-就是pointcut-选中那几个你想要的方法" tabindex="-1">不能全部方法都是连接点，通过特定的规则来筛选连接点, 就是Pointcut，选中那几个你想要的方法 <a class="header-anchor" href="#不能全部方法都是连接点-通过特定的规则来筛选连接点-就是pointcut-选中那几个你想要的方法" aria-label="Permalink to &quot;不能全部方法都是连接点，通过特定的规则来筛选连接点, 就是Pointcut，选中那几个你想要的方法&quot;">​</a></h3><h3 id="在程序中主要体现为书写切入点表达式-通过通配、正则-表达式-过滤出特定的一组-jointpoint连接点" tabindex="-1">在程序中主要体现为书写切入点表达式(通过通配、正则 表达式)过滤出特定的一组 JointPoint连接点 <a class="header-anchor" href="#在程序中主要体现为书写切入点表达式-通过通配、正则-表达式-过滤出特定的一组-jointpoint连接点" aria-label="Permalink to &quot;在程序中主要体现为书写切入点表达式(通过通配、正则 表达式)过滤出特定的一组 JointPoint连接点&quot;">​</a></h3><h3 id="过滤出相应的-advice-将要发生的joinpoint地方" tabindex="-1">过滤出相应的 Advice 将要发生的joinpoint地方 <a class="header-anchor" href="#过滤出相应的-advice-将要发生的joinpoint地方" aria-label="Permalink to &quot;过滤出相应的 Advice 将要发生的joinpoint地方&quot;">​</a></h3><h2 id="切面-aspect" tabindex="-1">切面 Aspect <a class="header-anchor" href="#切面-aspect" aria-label="Permalink to &quot;切面 Aspect&quot;">​</a></h2><h3 id="通常是一个类-里面定义-切入点-通知-定义在什么地方-什么时间点、做什么事情" tabindex="-1">通常是一个类，里面定义 切入点+通知 , 定义在什么地方; 什么时间点、做什么事情 <a class="header-anchor" href="#通常是一个类-里面定义-切入点-通知-定义在什么地方-什么时间点、做什么事情" aria-label="Permalink to &quot;通常是一个类，里面定义 切入点+通知 , 定义在什么地方; 什么时间点、做什么事情&quot;">​</a></h3><h3 id="通知-advice指明了时间和做的事情-前置、后置等" tabindex="-1">通知 advice指明了时间和做的事情(前置、后置等) <a class="header-anchor" href="#通知-advice指明了时间和做的事情-前置、后置等" aria-label="Permalink to &quot;通知 advice指明了时间和做的事情(前置、后置等)&quot;">​</a></h3><h3 id="切入点-pointcut-指定在什么地方干这个事情" tabindex="-1">切入点 pointcut 指定在什么地方干这个事情 <a class="header-anchor" href="#切入点-pointcut-指定在什么地方干这个事情" aria-label="Permalink to &quot;切入点 pointcut 指定在什么地方干这个事情&quot;">​</a></h3><h3 id="web接口设计中-web层-网关层-服务层-数据层-每一-层之间也是一个切面-对象和对象-方法和方法之间都是一个个切面" tabindex="-1">web接口设计中，web层-&gt;网关层-&gt;服务层-&gt;数据层，每一 层之间也是一个切面，对象和对象，方法和方法之间都是一个个切面 <a class="header-anchor" href="#web接口设计中-web层-网关层-服务层-数据层-每一-层之间也是一个切面-对象和对象-方法和方法之间都是一个个切面" aria-label="Permalink to &quot;web接口设计中，web层-&gt;网关层-&gt;服务层-&gt;数据层，每一 层之间也是一个切面，对象和对象，方法和方法之间都是一个个切面&quot;">​</a></h3><h2 id="目标-target" tabindex="-1">目标 target <a class="header-anchor" href="#目标-target" aria-label="Permalink to &quot;目标 target&quot;">​</a></h2><h3 id="目标类-真正的业务逻辑-可以在目标类不知情的条件下-增加新的功能到目标类的链路上" tabindex="-1">目标类，真正的业务逻辑，可以在目标类不知情的条件下，增加新的功能到目标类的链路上 <a class="header-anchor" href="#目标类-真正的业务逻辑-可以在目标类不知情的条件下-增加新的功能到目标类的链路上" aria-label="Permalink to &quot;目标类，真正的业务逻辑，可以在目标类不知情的条件下，增加新的功能到目标类的链路上&quot;">​</a></h3><h2 id="织入-weaving" tabindex="-1">织入 Weaving <a class="header-anchor" href="#织入-weaving" aria-label="Permalink to &quot;织入 Weaving&quot;">​</a></h2><h3 id="把切面-某个类-应用到目标函数的过程称为织入" tabindex="-1">把切面(某个类)应用到目标函数的过程称为织入 <a class="header-anchor" href="#把切面-某个类-应用到目标函数的过程称为织入" aria-label="Permalink to &quot;把切面(某个类)应用到目标函数的过程称为织入&quot;">​</a></h3><h1 id="密码学" tabindex="-1">密码学 <a class="header-anchor" href="#密码学" aria-label="Permalink to &quot;密码学&quot;">​</a></h1><h2 id="对称加密" tabindex="-1">对称加密 <a class="header-anchor" href="#对称加密" aria-label="Permalink to &quot;对称加密&quot;">​</a></h2><h3 id="加密和解密是用的同一个" tabindex="-1">加密和解密是用的同一个 <a class="header-anchor" href="#加密和解密是用的同一个" aria-label="Permalink to &quot;加密和解密是用的同一个&quot;">​</a></h3><h3 id="常见算法" tabindex="-1">常见算法 <a class="header-anchor" href="#常见算法" aria-label="Permalink to &quot;常见算法&quot;">​</a></h3><h4 id="des-已被破解" tabindex="-1">DES(已被破解) <a class="header-anchor" href="#des-已被破解" aria-label="Permalink to &quot;DES(已被破解)&quot;">​</a></h4><h4 id="_3des-暂时未被破解" tabindex="-1">3DES(暂时未被破解) <a class="header-anchor" href="#_3des-暂时未被破解" aria-label="Permalink to &quot;3DES(暂时未被破解)&quot;">​</a></h4><h4 id="aes" tabindex="-1">AES <a class="header-anchor" href="#aes" aria-label="Permalink to &quot;AES&quot;">​</a></h4><h3 id="优点-1" tabindex="-1">优点 <a class="header-anchor" href="#优点-1" aria-label="Permalink to &quot;优点&quot;">​</a></h3><h4 id="操作简单-加密快-密钥简单" tabindex="-1">操作简单，加密快，密钥简单 <a class="header-anchor" href="#操作简单-加密快-密钥简单" aria-label="Permalink to &quot;操作简单，加密快，密钥简单&quot;">​</a></h4><h3 id="缺点-1" tabindex="-1">缺点 <a class="header-anchor" href="#缺点-1" aria-label="Permalink to &quot;缺点&quot;">​</a></h3><h4 id="密钥一旦被窃取-信息会暴露-安全性不高" tabindex="-1">密钥一旦被窃取，信息会暴露，安全性不高 <a class="header-anchor" href="#密钥一旦被窃取-信息会暴露-安全性不高" aria-label="Permalink to &quot;密钥一旦被窃取，信息会暴露，安全性不高&quot;">​</a></h4><h2 id="非对称加密" tabindex="-1">非对称加密 <a class="header-anchor" href="#非对称加密" aria-label="Permalink to &quot;非对称加密&quot;">​</a></h2><h3 id="a要向b发送消息-那么b首先用rsa算法生成一个密钥对-然后把私钥自己存储-把公钥发送给a" tabindex="-1">A要向B发送消息，那么B首先用RSA算法生成一个密钥对，然后把私钥自己存储，把公钥发送给A <a class="header-anchor" href="#a要向b发送消息-那么b首先用rsa算法生成一个密钥对-然后把私钥自己存储-把公钥发送给a" aria-label="Permalink to &quot;A要向B发送消息，那么B首先用RSA算法生成一个密钥对，然后把私钥自己存储，把公钥发送给A&quot;">​</a></h3><h3 id="发送方通过公钥加密-接收方通过密钥解密" tabindex="-1">发送方通过公钥加密，接收方通过密钥解密 <a class="header-anchor" href="#发送方通过公钥加密-接收方通过密钥解密" aria-label="Permalink to &quot;发送方通过公钥加密，接收方通过密钥解密&quot;">​</a></h3><h3 id="常见算法-1" tabindex="-1">常见算法 <a class="header-anchor" href="#常见算法-1" aria-label="Permalink to &quot;常见算法&quot;">​</a></h3><h4 id="rsa" tabindex="-1">RSA <a class="header-anchor" href="#rsa" aria-label="Permalink to &quot;RSA&quot;">​</a></h4><h4 id="dsa" tabindex="-1">DSA <a class="header-anchor" href="#dsa" aria-label="Permalink to &quot;DSA&quot;">​</a></h4><h4 id="ecc" tabindex="-1">ECC <a class="header-anchor" href="#ecc" aria-label="Permalink to &quot;ECC&quot;">​</a></h4><h3 id="优点-2" tabindex="-1">优点 <a class="header-anchor" href="#优点-2" aria-label="Permalink to &quot;优点&quot;">​</a></h3><h4 id="安全性高" tabindex="-1">安全性高 <a class="header-anchor" href="#安全性高" aria-label="Permalink to &quot;安全性高&quot;">​</a></h4><h3 id="缺点-2" tabindex="-1">缺点 <a class="header-anchor" href="#缺点-2" aria-label="Permalink to &quot;缺点&quot;">​</a></h3><h4 id="加密较慢-时间长-只适合对少量数据进行加密" tabindex="-1">加密较慢，时间长，只适合对少量数据进行加密 <a class="header-anchor" href="#加密较慢-时间长-只适合对少量数据进行加密" aria-label="Permalink to &quot;加密较慢，时间长，只适合对少量数据进行加密&quot;">​</a></h4><h2 id="hash算法-单项加密" tabindex="-1">Hash算法-单项加密 <a class="header-anchor" href="#hash算法-单项加密" aria-label="Permalink to &quot;Hash算法-单项加密&quot;">​</a></h2><h3 id="无法被解密-只有重新输入明文-经过hash算法加密得到相同的密文-才算解密" tabindex="-1">无法被解密，只有重新输入明文，经过hash算法加密得到相同的密文，才算解密 <a class="header-anchor" href="#无法被解密-只有重新输入明文-经过hash算法加密得到相同的密文-才算解密" aria-label="Permalink to &quot;无法被解密，只有重新输入明文，经过hash算法加密得到相同的密文，才算解密&quot;">​</a></h3><h3 id="常见算法-2" tabindex="-1">常见算法 <a class="header-anchor" href="#常见算法-2" aria-label="Permalink to &quot;常见算法&quot;">​</a></h3><h4 id="md5" tabindex="-1">MD5 <a class="header-anchor" href="#md5" aria-label="Permalink to &quot;MD5&quot;">​</a></h4><h5 id="彩虹表暴力破解www-cmd5-com" tabindex="-1">彩虹表暴力破解www.cmd5.com <a class="header-anchor" href="#彩虹表暴力破解www-cmd5-com" aria-label="Permalink to &quot;彩虹表暴力破解www.cmd5.com&quot;">​</a></h5><h4 id="sha1" tabindex="-1">SHA1 <a class="header-anchor" href="#sha1" aria-label="Permalink to &quot;SHA1&quot;">​</a></h4><h4 id="sha224" tabindex="-1">SHA224 <a class="header-anchor" href="#sha224" aria-label="Permalink to &quot;SHA224&quot;">​</a></h4><h4 id="sha256" tabindex="-1">SHA256 <a class="header-anchor" href="#sha256" aria-label="Permalink to &quot;SHA256&quot;">​</a></h4><h3 id="优点-3" tabindex="-1">优点 <a class="header-anchor" href="#优点-3" aria-label="Permalink to &quot;优点&quot;">​</a></h3><h4 id="快速计算-具有单向性-不可通过散列值推出原消息" tabindex="-1">快速计算，具有单向性，不可通过散列值推出原消息 <a class="header-anchor" href="#快速计算-具有单向性-不可通过散列值推出原消息" aria-label="Permalink to &quot;快速计算，具有单向性，不可通过散列值推出原消息&quot;">​</a></h4><h3 id="场景" tabindex="-1">场景 <a class="header-anchor" href="#场景" aria-label="Permalink to &quot;场景&quot;">​</a></h3><h4 id="文件完整性校验-checksum-算法、常规加密等" tabindex="-1">文件完整性校验(Checksum)算法、常规加密等 <a class="header-anchor" href="#文件完整性校验-checksum-算法、常规加密等" aria-label="Permalink to &quot;文件完整性校验(Checksum)算法、常规加密等&quot;">​</a></h4><h3 id="密码存储常用方式" tabindex="-1">密码存储常用方式 <a class="header-anchor" href="#密码存储常用方式" aria-label="Permalink to &quot;密码存储常用方式&quot;">​</a></h3><h4 id="双重md5" tabindex="-1">双重MD5 <a class="header-anchor" href="#双重md5" aria-label="Permalink to &quot;双重MD5&quot;">​</a></h4><h4 id="md5加盐" tabindex="-1">MD5加盐 <a class="header-anchor" href="#md5加盐" aria-label="Permalink to &quot;MD5加盐&quot;">​</a></h4><h4 id="双重md5-加盐" tabindex="-1">双重MD5+加盐 <a class="header-anchor" href="#双重md5-加盐" aria-label="Permalink to &quot;双重MD5+加盐&quot;">​</a></h4><h3 id="为什么不用最强的算法" tabindex="-1">为什么不用最强的算法？ <a class="header-anchor" href="#为什么不用最强的算法" aria-label="Permalink to &quot;为什么不用最强的算法？&quot;">​</a></h3><h4 id="更安全的算法-加密解密更复杂-接口性能下降更严重" tabindex="-1">更安全的算法，加密解密更复杂，接口性能下降更严重 <a class="header-anchor" href="#更安全的算法-加密解密更复杂-接口性能下降更严重" aria-label="Permalink to &quot;更安全的算法，加密解密更复杂，接口性能下降更严重&quot;">​</a></h4><h2 id="对称加密和非对称加密混合使用的例子" tabindex="-1">对称加密和非对称加密混合使用的例子 <a class="header-anchor" href="#对称加密和非对称加密混合使用的例子" aria-label="Permalink to &quot;对称加密和非对称加密混合使用的例子&quot;">​</a></h2><h3 id="前面通信使用非对称加密-发送方和接收方都得到相同的口令之后-后续通信使用对称加密-密钥就是口令" tabindex="-1">前面通信使用非对称加密，发送方和接收方都得到相同的口令之后，后续通信使用对称加密，密钥就是口令 <a class="header-anchor" href="#前面通信使用非对称加密-发送方和接收方都得到相同的口令之后-后续通信使用对称加密-密钥就是口令" aria-label="Permalink to &quot;前面通信使用非对称加密，发送方和接收方都得到相同的口令之后，后续通信使用对称加密，密钥就是口令&quot;">​</a></h3><h3 id="应用场景" tabindex="-1">应用场景 <a class="header-anchor" href="#应用场景" aria-label="Permalink to &quot;应用场景&quot;">​</a></h3><h4 id="https" tabindex="-1">HTTPS <a class="header-anchor" href="#https" aria-label="Permalink to &quot;HTTPS&quot;">​</a></h4><h5 id="https非对称加密只作用在证书验证阶段" tabindex="-1">HTTPS非对称加密只作用在证书验证阶段 <a class="header-anchor" href="#https非对称加密只作用在证书验证阶段" aria-label="Permalink to &quot;HTTPS非对称加密只作用在证书验证阶段&quot;">​</a></h5><h5 id="内容传输加密使用的是对称加密" tabindex="-1">内容传输加密使用的是对称加密 <a class="header-anchor" href="#内容传输加密使用的是对称加密" aria-label="Permalink to &quot;内容传输加密使用的是对称加密&quot;">​</a></h5><h5 id="既保证了密钥的安全性-又保证了后续数据传输的数据加解密的性能" tabindex="-1">既保证了密钥的安全性，又保证了后续数据传输的数据加解密的性能 <a class="header-anchor" href="#既保证了密钥的安全性-又保证了后续数据传输的数据加解密的性能" aria-label="Permalink to &quot;既保证了密钥的安全性，又保证了后续数据传输的数据加解密的性能&quot;">​</a></h5><h4 id="微信支付" tabindex="-1">微信支付 <a class="header-anchor" href="#微信支付" aria-label="Permalink to &quot;微信支付&quot;">​</a></h4><h1 id="设计模式" tabindex="-1">设计模式 <a class="header-anchor" href="#设计模式" aria-label="Permalink to &quot;设计模式&quot;">​</a></h1><h2 id="软件设计开发原则" tabindex="-1">软件设计开发原则 <a class="header-anchor" href="#软件设计开发原则" aria-label="Permalink to &quot;软件设计开发原则&quot;">​</a></h2><blockquote><p>(SOLID原则)</p></blockquote><h3 id="单一职责原则" tabindex="-1">单一职责原则 <a class="header-anchor" href="#单一职责原则" aria-label="Permalink to &quot;单一职责原则&quot;">​</a></h3><h3 id="开闭原则" tabindex="-1">开闭原则 <a class="header-anchor" href="#开闭原则" aria-label="Permalink to &quot;开闭原则&quot;">​</a></h3><h4 id="对扩展开放-对修改关闭" tabindex="-1">对扩展开放，对修改关闭 <a class="header-anchor" href="#对扩展开放-对修改关闭" aria-label="Permalink to &quot;对扩展开放，对修改关闭&quot;">​</a></h4><h3 id="里氏替换原则lsp" tabindex="-1">里氏替换原则LSP <a class="header-anchor" href="#里氏替换原则lsp" aria-label="Permalink to &quot;里氏替换原则LSP&quot;">​</a></h3><h4 id="在程序中尽量使用基类类型来对对象进行定义" tabindex="-1">在程序中尽量使用基类类型来对对象进行定义 <a class="header-anchor" href="#在程序中尽量使用基类类型来对对象进行定义" aria-label="Permalink to &quot;在程序中尽量使用基类类型来对对象进行定义&quot;">​</a></h4><h3 id="依赖倒转原则" tabindex="-1">依赖倒转原则 <a class="header-anchor" href="#依赖倒转原则" aria-label="Permalink to &quot;依赖倒转原则&quot;">​</a></h3><h4 id="是开闭原则的基础-针对接口编程-依赖于抽象而不依赖于具体" tabindex="-1">是开闭原则的基础，针对接口编程，依赖于抽象而不依赖于具体 <a class="header-anchor" href="#是开闭原则的基础-针对接口编程-依赖于抽象而不依赖于具体" aria-label="Permalink to &quot;是开闭原则的基础，针对接口编程，依赖于抽象而不依赖于具体&quot;">​</a></h4><h4 id="高层模块不应该依赖低层模块-二者都应该依赖其抽象" tabindex="-1">高层模块不应该依赖低层模块，二者都应该依赖其抽象 <a class="header-anchor" href="#高层模块不应该依赖低层模块-二者都应该依赖其抽象" aria-label="Permalink to &quot;高层模块不应该依赖低层模块，二者都应该依赖其抽象&quot;">​</a></h4><h3 id="接口隔离原则" tabindex="-1">接口隔离原则 <a class="header-anchor" href="#接口隔离原则" aria-label="Permalink to &quot;接口隔离原则&quot;">​</a></h3><h4 id="客户端不应该依赖那些它不需要的接口" tabindex="-1">客户端不应该依赖那些它不需要的接口 <a class="header-anchor" href="#客户端不应该依赖那些它不需要的接口" aria-label="Permalink to &quot;客户端不应该依赖那些它不需要的接口&quot;">​</a></h4><h4 id="使用多个隔离的接口-比使用单个接口要好-降低类之间的耦合度" tabindex="-1">使用多个隔离的接口，比使用单个接口要好，降低类之间的耦合度 <a class="header-anchor" href="#使用多个隔离的接口-比使用单个接口要好-降低类之间的耦合度" aria-label="Permalink to &quot;使用多个隔离的接口，比使用单个接口要好，降低类之间的耦合度&quot;">​</a></h4><h3 id="迪米特法则" tabindex="-1">迪米特法则 <a class="header-anchor" href="#迪米特法则" aria-label="Permalink to &quot;迪米特法则&quot;">​</a></h3><h4 id="最少知道原则-一个实体应当尽量少地与其他实体之间发生相互作用-使得系统功能模块相对独立" tabindex="-1">最少知道原则，一个实体应当尽量少地与其他实体之间发生相互作用，使得系统功能模块相对独立 <a class="header-anchor" href="#最少知道原则-一个实体应当尽量少地与其他实体之间发生相互作用-使得系统功能模块相对独立" aria-label="Permalink to &quot;最少知道原则，一个实体应当尽量少地与其他实体之间发生相互作用，使得系统功能模块相对独立&quot;">​</a></h4><h2 id="工厂模式" tabindex="-1">工厂模式 <a class="header-anchor" href="#工厂模式" aria-label="Permalink to &quot;工厂模式&quot;">​</a></h2><h3 id="简单工厂模式" tabindex="-1">简单工厂模式 <a class="header-anchor" href="#简单工厂模式" aria-label="Permalink to &quot;简单工厂模式&quot;">​</a></h3><h4 id="又称静态工厂方法-可以根据参数的不同返回不同类的实例-专⻔定义一个类来负责创建其他类的实例-被创建的实例通常都具有共同的父类" tabindex="-1">又称静态工厂方法, 可以根据参数的不同返回不同类的实例， 专⻔定义一个类来负责创建其他类的实例，被创建的实例通常都具有共同的父类 <a class="header-anchor" href="#又称静态工厂方法-可以根据参数的不同返回不同类的实例-专⻔定义一个类来负责创建其他类的实例-被创建的实例通常都具有共同的父类" aria-label="Permalink to &quot;又称静态工厂方法, 可以根据参数的不同返回不同类的实例， 专⻔定义一个类来负责创建其他类的实例，被创建的实例通常都具有共同的父类&quot;">​</a></h4><h4 id="优点-4" tabindex="-1">优点 <a class="header-anchor" href="#优点-4" aria-label="Permalink to &quot;优点&quot;">​</a></h4><h5 id="将对象的创建和对象本身业务处理分离可以降低系统的耦合度-使得两者修改起来都相对容易。" tabindex="-1">将对象的创建和对象本身业务处理分离可以降低系统的耦合度，使得两者修改起来都相对容易。 <a class="header-anchor" href="#将对象的创建和对象本身业务处理分离可以降低系统的耦合度-使得两者修改起来都相对容易。" aria-label="Permalink to &quot;将对象的创建和对象本身业务处理分离可以降低系统的耦合度，使得两者修改起来都相对容易。&quot;">​</a></h5><h4 id="缺点-3" tabindex="-1">缺点 <a class="header-anchor" href="#缺点-3" aria-label="Permalink to &quot;缺点&quot;">​</a></h4><h5 id="工厂类的职责相对过重-增加新的产品需要修改工厂类的判断逻辑-这一点与开闭原则是相违背" tabindex="-1">工厂类的职责相对过重，增加新的产品需要修改工厂类的判断逻辑，这一点与开闭原则是相违背 <a class="header-anchor" href="#工厂类的职责相对过重-增加新的产品需要修改工厂类的判断逻辑-这一点与开闭原则是相违背" aria-label="Permalink to &quot;工厂类的职责相对过重，增加新的产品需要修改工厂类的判断逻辑，这一点与开闭原则是相违背&quot;">​</a></h5><h5 id="将会增加系统中类的个数-在一定程度上增加了系统的复杂度和理解难度-不利于系统的扩展和维护" tabindex="-1">将会增加系统中类的个数，在一定程度上增加了系统的复杂度和理解难度，不利于系统的扩展和维护 <a class="header-anchor" href="#将会增加系统中类的个数-在一定程度上增加了系统的复杂度和理解难度-不利于系统的扩展和维护" aria-label="Permalink to &quot;将会增加系统中类的个数，在一定程度上增加了系统的复杂度和理解难度，不利于系统的扩展和维护&quot;">​</a></h5><h3 id="工厂方法模式" tabindex="-1">工厂方法模式 <a class="header-anchor" href="#工厂方法模式" aria-label="Permalink to &quot;工厂方法模式&quot;">​</a></h3><h4 id="通过实现类实现相应的方法来决定相应的返回结果-这种方式的可扩展性比较强" tabindex="-1">通过实现类实现相应的方法来决定相应的返回结果，这种方式的可扩展性比较强; <a class="header-anchor" href="#通过实现类实现相应的方法来决定相应的返回结果-这种方式的可扩展性比较强" aria-label="Permalink to &quot;通过实现类实现相应的方法来决定相应的返回结果，这种方式的可扩展性比较强;&quot;">​</a></h4><h3 id="抽象工厂模式" tabindex="-1">抽象工厂模式 <a class="header-anchor" href="#抽象工厂模式" aria-label="Permalink to &quot;抽象工厂模式&quot;">​</a></h3><h4 id="基于上述两种模式的拓展-且支持细化产品" tabindex="-1">基于上述两种模式的拓展，且支持细化产品 <a class="header-anchor" href="#基于上述两种模式的拓展-且支持细化产品" aria-label="Permalink to &quot;基于上述两种模式的拓展，且支持细化产品&quot;">​</a></h4><h2 id="策略模式" tabindex="-1">策略模式 <a class="header-anchor" href="#策略模式" aria-label="Permalink to &quot;策略模式&quot;">​</a></h2><h3 id="定义一系列的算法-把它们一个个封装起来-并且使它们可相互替换" tabindex="-1">定义一系列的算法,把它们一个个封装起来, 并且使它们可相互替换 <a class="header-anchor" href="#定义一系列的算法-把它们一个个封装起来-并且使它们可相互替换" aria-label="Permalink to &quot;定义一系列的算法,把它们一个个封装起来, 并且使它们可相互替换&quot;">​</a></h3><h3 id="⻆色" tabindex="-1">⻆色 <a class="header-anchor" href="#⻆色" aria-label="Permalink to &quot;⻆色&quot;">​</a></h3><h4 id="context上下文-屏蔽高层模块对策略、算法的直接访问-封装可能存在的变化" tabindex="-1">Context上下文:屏蔽高层模块对策略、算法的直接访问，封装可能存在的变化 <a class="header-anchor" href="#context上下文-屏蔽高层模块对策略、算法的直接访问-封装可能存在的变化" aria-label="Permalink to &quot;Context上下文:屏蔽高层模块对策略、算法的直接访问，封装可能存在的变化&quot;">​</a></h4><h4 id="strategy策略⻆色-抽象策略⻆色-是对策略、算法家族的抽象-定义每个策略或算法必须具有的方法和属性" tabindex="-1">Strategy策略⻆色:抽象策略⻆色，是对策略、算法家族的抽象，定义每个策略或算法必须具有的方法和属性 <a class="header-anchor" href="#strategy策略⻆色-抽象策略⻆色-是对策略、算法家族的抽象-定义每个策略或算法必须具有的方法和属性" aria-label="Permalink to &quot;Strategy策略⻆色:抽象策略⻆色，是对策略、算法家族的抽象，定义每个策略或算法必须具有的方法和属性&quot;">​</a></h4><h4 id="concretestrategy具体策略⻆色-用于实现抽象策略中的操作-即实现具体的算法" tabindex="-1">ConcreteStrategy具体策略⻆色:用于实现抽象策略中的操作，即实现具体的算法 <a class="header-anchor" href="#concretestrategy具体策略⻆色-用于实现抽象策略中的操作-即实现具体的算法" aria-label="Permalink to &quot;ConcreteStrategy具体策略⻆色:用于实现抽象策略中的操作，即实现具体的算法&quot;">​</a></h4><h2 id="单例模式" tabindex="-1">单例模式 <a class="header-anchor" href="#单例模式" aria-label="Permalink to &quot;单例模式&quot;">​</a></h2><h3 id="懒汉方式" tabindex="-1">懒汉方式 <a class="header-anchor" href="#懒汉方式" aria-label="Permalink to &quot;懒汉方式&quot;">​</a></h3><h4 id="延迟创建对象" tabindex="-1">延迟创建对象 <a class="header-anchor" href="#延迟创建对象" aria-label="Permalink to &quot;延迟创建对象&quot;">​</a></h4><h4 id="优点-5" tabindex="-1">优点 <a class="header-anchor" href="#优点-5" aria-label="Permalink to &quot;优点&quot;">​</a></h4><h5 id="前期不占用内存-用时才创建" tabindex="-1">前期不占用内存，用时才创建 <a class="header-anchor" href="#前期不占用内存-用时才创建" aria-label="Permalink to &quot;前期不占用内存，用时才创建&quot;">​</a></h5><h4 id="缺点-4" tabindex="-1">缺点 <a class="header-anchor" href="#缺点-4" aria-label="Permalink to &quot;缺点&quot;">​</a></h4><h5 id="初次创建时有延迟" tabindex="-1">初次创建时有延迟 <a class="header-anchor" href="#初次创建时有延迟" aria-label="Permalink to &quot;初次创建时有延迟&quot;">​</a></h5><h3 id="饿汉方式" tabindex="-1">饿汉方式 <a class="header-anchor" href="#饿汉方式" aria-label="Permalink to &quot;饿汉方式&quot;">​</a></h3><h4 id="提前创建好对象" tabindex="-1">提前创建好对象 <a class="header-anchor" href="#提前创建好对象" aria-label="Permalink to &quot;提前创建好对象&quot;">​</a></h4><h4 id="优点-6" tabindex="-1">优点 <a class="header-anchor" href="#优点-6" aria-label="Permalink to &quot;优点&quot;">​</a></h4><h5 id="实现简单-使用时没延迟" tabindex="-1">实现简单，使用时没延迟 <a class="header-anchor" href="#实现简单-使用时没延迟" aria-label="Permalink to &quot;实现简单，使用时没延迟&quot;">​</a></h5><h4 id="缺点-5" tabindex="-1">缺点 <a class="header-anchor" href="#缺点-5" aria-label="Permalink to &quot;缺点&quot;">​</a></h4><h5 id="instance会一直占用内存" tabindex="-1">instance会一直占用内存 <a class="header-anchor" href="#instance会一直占用内存" aria-label="Permalink to &quot;instance会一直占用内存&quot;">​</a></h5><h3 id="如何选择" tabindex="-1">如何选择 <a class="header-anchor" href="#如何选择" aria-label="Permalink to &quot;如何选择&quot;">​</a></h3><h4 id="如果对象不大-且创建对象不复杂-直接使用饿汉方式即可" tabindex="-1">如果对象不大，且创建对象不复杂，直接使用饿汉方式即可 <a class="header-anchor" href="#如果对象不大-且创建对象不复杂-直接使用饿汉方式即可" aria-label="Permalink to &quot;如果对象不大，且创建对象不复杂，直接使用饿汉方式即可&quot;">​</a></h4><h4 id="其他情况则使用懒汉实现方式" tabindex="-1">其他情况则使用懒汉实现方式 <a class="header-anchor" href="#其他情况则使用懒汉实现方式" aria-label="Permalink to &quot;其他情况则使用懒汉实现方式&quot;">​</a></h4><h1 id="微信支付回调验签流程" tabindex="-1">微信支付回调验签流程 <a class="header-anchor" href="#微信支付回调验签流程" aria-label="Permalink to &quot;微信支付回调验签流程&quot;">​</a></h1><h2 id="获取报文" tabindex="-1">获取报文 <a class="header-anchor" href="#获取报文" aria-label="Permalink to &quot;获取报文&quot;">​</a></h2><h2 id="验证签名-确保是微信传输过来的" tabindex="-1">验证签名(确保是微信传输过来的) <a class="header-anchor" href="#验证签名-确保是微信传输过来的" aria-label="Permalink to &quot;验证签名(确保是微信传输过来的)&quot;">​</a></h2><h2 id="解密-aes对称解密出原始数据" tabindex="-1">解密(AES对称解密出原始数据) <a class="header-anchor" href="#解密-aes对称解密出原始数据" aria-label="Permalink to &quot;解密(AES对称解密出原始数据)&quot;">​</a></h2><h2 id="处理业务逻辑" tabindex="-1">处理业务逻辑 <a class="header-anchor" href="#处理业务逻辑" aria-label="Permalink to &quot;处理业务逻辑&quot;">​</a></h2><h2 id="响应请求" tabindex="-1">响应请求 <a class="header-anchor" href="#响应请求" aria-label="Permalink to &quot;响应请求&quot;">​</a></h2><h1 id="账号服务" tabindex="-1">账号服务 <a class="header-anchor" href="#账号服务" aria-label="Permalink to &quot;账号服务&quot;">​</a></h1><h2 id="新用户注册拉新赠送免费流量包方案" tabindex="-1">新用户注册拉新赠送免费流量包方案 <a class="header-anchor" href="#新用户注册拉新赠送免费流量包方案" aria-label="Permalink to &quot;新用户注册拉新赠送免费流量包方案&quot;">​</a></h2><h3 id="新用户注册直接主逻辑返回成功" tabindex="-1">新用户注册直接主逻辑返回成功 <a class="header-anchor" href="#新用户注册直接主逻辑返回成功" aria-label="Permalink to &quot;新用户注册直接主逻辑返回成功&quot;">​</a></h3><h3 id="发送mq消息发放新用户注册权益" tabindex="-1">发送MQ消息发放新用户注册权益 <a class="header-anchor" href="#发送mq消息发放新用户注册权益" aria-label="Permalink to &quot;发送MQ消息发放新用户注册权益&quot;">​</a></h3><h3 id="mq保证幂等性" tabindex="-1">MQ保证幂等性 <a class="header-anchor" href="#mq保证幂等性" aria-label="Permalink to &quot;MQ保证幂等性&quot;">​</a></h3><h4 id="付费流量包唯一索引-accountno-outtradeno" tabindex="-1">付费流量包唯一索引：accountNo+outTradeNo <a class="header-anchor" href="#付费流量包唯一索引-accountno-outtradeno" aria-label="Permalink to &quot;付费流量包唯一索引：accountNo+outTradeNo&quot;">​</a></h4><h4 id="免费流量包唯一索引-accountno-free-init" tabindex="-1">免费流量包唯一索引：accountNo+free_init <a class="header-anchor" href="#免费流量包唯一索引-accountno-free-init" aria-label="Permalink to &quot;免费流量包唯一索引：accountNo+free_init&quot;">​</a></h4><h2 id="过期的流量包删除" tabindex="-1">过期的流量包删除 <a class="header-anchor" href="#过期的流量包删除" aria-label="Permalink to &quot;过期的流量包删除&quot;">​</a></h2><h3 id="直接使用物理删除-避免数据过多" tabindex="-1">直接使用物理删除，避免数据过多 <a class="header-anchor" href="#直接使用物理删除-避免数据过多" aria-label="Permalink to &quot;直接使用物理删除，避免数据过多&quot;">​</a></h3><h3 id="数据过多-删除较慢-使用分布式调度xxl-job" tabindex="-1">数据过多，删除较慢，使用分布式调度XXL-Job <a class="header-anchor" href="#数据过多-删除较慢-使用分布式调度xxl-job" aria-label="Permalink to &quot;数据过多，删除较慢，使用分布式调度XXL-Job&quot;">​</a></h3><h2 id="xxl-job" tabindex="-1">XXL-Job <a class="header-anchor" href="#xxl-job" aria-label="Permalink to &quot;XXL-Job&quot;">​</a></h2><h3 id="为什么选择xxl-job" tabindex="-1">为什么选择xxl-job <a class="header-anchor" href="#为什么选择xxl-job" aria-label="Permalink to &quot;为什么选择xxl-job&quot;">​</a></h3><h4 id="xxl-job使用简单-上手较快" tabindex="-1">xxl-job使用简单，上手较快 <a class="header-anchor" href="#xxl-job使用简单-上手较快" aria-label="Permalink to &quot;xxl-job使用简单，上手较快&quot;">​</a></h4><h4 id="基本满足业务需求" tabindex="-1">基本满足业务需求 <a class="header-anchor" href="#基本满足业务需求" aria-label="Permalink to &quot;基本满足业务需求&quot;">​</a></h4><h4 id="团队里大部分人都熟悉" tabindex="-1">团队里大部分人都熟悉 <a class="header-anchor" href="#团队里大部分人都熟悉" aria-label="Permalink to &quot;团队里大部分人都熟悉&quot;">​</a></h4><h2 id="用户每天都有免费的流量包-怎么维护" tabindex="-1">用户每天都有免费的流量包，怎么维护？ <a class="header-anchor" href="#用户每天都有免费的流量包-怎么维护" aria-label="Permalink to &quot;用户每天都有免费的流量包，怎么维护？&quot;">​</a></h2><h3 id="采用惰性更新-用户用的时候再更新即可" tabindex="-1">采用惰性更新，用户用的时候再更新即可 <a class="header-anchor" href="#采用惰性更新-用户用的时候再更新即可" aria-label="Permalink to &quot;采用惰性更新，用户用的时候再更新即可&quot;">​</a></h3><h3 id="更进阶的" tabindex="-1">更进阶的 <a class="header-anchor" href="#更进阶的" aria-label="Permalink to &quot;更进阶的&quot;">​</a></h3><h4 id="定时-惰性" tabindex="-1">定时+惰性 <a class="header-anchor" href="#定时-惰性" aria-label="Permalink to &quot;定时+惰性&quot;">​</a></h4><h5 id="把每日或每周活跃的用户单独拿出来-更新定时流量包-避免数据更新太多造成延迟" tabindex="-1">把每日或每周活跃的用户单独拿出来，更新定时流量包，避免数据更新太多造成延迟 <a class="header-anchor" href="#把每日或每周活跃的用户单独拿出来-更新定时流量包-避免数据更新太多造成延迟" aria-label="Permalink to &quot;把每日或每周活跃的用户单独拿出来，更新定时流量包，避免数据更新太多造成延迟&quot;">​</a></h5><h5 id="用户用时再更新" tabindex="-1">用户用时再更新 <a class="header-anchor" href="#用户用时再更新" aria-label="Permalink to &quot;用户用时再更新&quot;">​</a></h5><h1 id="redis过期key淘汰机制" tabindex="-1">Redis过期key淘汰机制 <a class="header-anchor" href="#redis过期key淘汰机制" aria-label="Permalink to &quot;Redis过期key淘汰机制&quot;">​</a></h1><h2 id="定期删除" tabindex="-1">定期删除 <a class="header-anchor" href="#定期删除" aria-label="Permalink to &quot;定期删除&quot;">​</a></h2><h3 id="隔一段时间就随机抽取一些设置了过期时间的key-判断是否过期-如果过期就删除" tabindex="-1">隔一段时间就随机抽取一些设置了过期时间的key，判断是否过期，如果过期就删除 <a class="header-anchor" href="#隔一段时间就随机抽取一些设置了过期时间的key-判断是否过期-如果过期就删除" aria-label="Permalink to &quot;隔一段时间就随机抽取一些设置了过期时间的key，判断是否过期，如果过期就删除&quot;">​</a></h3><h3 id="定期删除可能导致很多过期的key到了时间并没有被删除" tabindex="-1">定期删除可能导致很多过期的key到了时间并没有被删除 <a class="header-anchor" href="#定期删除可能导致很多过期的key到了时间并没有被删除" aria-label="Permalink to &quot;定期删除可能导致很多过期的key到了时间并没有被删除&quot;">​</a></h3><h2 id="惰性删除" tabindex="-1">惰性删除 <a class="header-anchor" href="#惰性删除" aria-label="Permalink to &quot;惰性删除&quot;">​</a></h2><h3 id="当客户端试图访问key时-发现该key已超时会把此key从内存中删除" tabindex="-1">当客户端试图访问key时，发现该key已超时会把此key从内存中删除 <a class="header-anchor" href="#当客户端试图访问key时-发现该key已超时会把此key从内存中删除" aria-label="Permalink to &quot;当客户端试图访问key时，发现该key已超时会把此key从内存中删除&quot;">​</a></h3><h1 id="分布式事务" tabindex="-1">分布式事务 <a class="header-anchor" href="#分布式事务" aria-label="Permalink to &quot;分布式事务&quot;">​</a></h1><h2 id="一个操作单元-所有操作最终要保持一致-要么全部成功-要么全部失败" tabindex="-1">一个操作单元，所有操作最终要保持一致，要么全部成功，要么全部失败 <a class="header-anchor" href="#一个操作单元-所有操作最终要保持一致-要么全部成功-要么全部失败" aria-label="Permalink to &quot;一个操作单元，所有操作最终要保持一致，要么全部成功，要么全部失败&quot;">​</a></h2><h2 id="本地事物" tabindex="-1">本地事物 <a class="header-anchor" href="#本地事物" aria-label="Permalink to &quot;本地事物&quot;">​</a></h2><h3 id="数据库提供的" tabindex="-1">数据库提供的 <a class="header-anchor" href="#数据库提供的" aria-label="Permalink to &quot;数据库提供的&quot;">​</a></h3><h2 id="分布式事务-1" tabindex="-1">分布式事务 <a class="header-anchor" href="#分布式事务-1" aria-label="Permalink to &quot;分布式事务&quot;">​</a></h2><h3 id="分布式系统各个节点上的不同数据库的一致性" tabindex="-1">分布式系统各个节点上的不同数据库的一致性 <a class="header-anchor" href="#分布式系统各个节点上的不同数据库的一致性" aria-label="Permalink to &quot;分布式系统各个节点上的不同数据库的一致性&quot;">​</a></h3><h2 id="分类" tabindex="-1">分类 <a class="header-anchor" href="#分类" aria-label="Permalink to &quot;分类&quot;">​</a></h2><h3 id="刚性事务" tabindex="-1">刚性事务 <a class="header-anchor" href="#刚性事务" aria-label="Permalink to &quot;刚性事务&quot;">​</a></h3><h4 id="遵循acid" tabindex="-1">遵循ACID <a class="header-anchor" href="#遵循acid" aria-label="Permalink to &quot;遵循ACID&quot;">​</a></h4><h3 id="柔性事务" tabindex="-1">柔性事务 <a class="header-anchor" href="#柔性事务" aria-label="Permalink to &quot;柔性事务&quot;">​</a></h3><h4 id="遵循base理论" tabindex="-1">遵循BASE理论 <a class="header-anchor" href="#遵循base理论" aria-label="Permalink to &quot;遵循BASE理论&quot;">​</a></h4><h2 id="关于数据一致性" tabindex="-1">关于数据一致性 <a class="header-anchor" href="#关于数据一致性" aria-label="Permalink to &quot;关于数据一致性&quot;">​</a></h2><h3 id="强一致" tabindex="-1">强一致 <a class="header-anchor" href="#强一致" aria-label="Permalink to &quot;强一致&quot;">​</a></h3><h4 id="操作后立马一致且可以访问" tabindex="-1">操作后立马一致且可以访问 <a class="header-anchor" href="#操作后立马一致且可以访问" aria-label="Permalink to &quot;操作后立马一致且可以访问&quot;">​</a></h4><h3 id="弱一致" tabindex="-1">弱一致 <a class="header-anchor" href="#弱一致" aria-label="Permalink to &quot;弱一致&quot;">​</a></h3><h4 id="容忍部分或全部访问不到" tabindex="-1">容忍部分或全部访问不到 <a class="header-anchor" href="#容忍部分或全部访问不到" aria-label="Permalink to &quot;容忍部分或全部访问不到&quot;">​</a></h4><h3 id="最终一致" tabindex="-1">最终一致 <a class="header-anchor" href="#最终一致" aria-label="Permalink to &quot;最终一致&quot;">​</a></h3><h4 id="弱一致性经过一段时间后-都一致且正常" tabindex="-1">弱一致性经过一段时间后，都一致且正常 <a class="header-anchor" href="#弱一致性经过一段时间后-都一致且正常" aria-label="Permalink to &quot;弱一致性经过一段时间后，都一致且正常&quot;">​</a></h4><h1 id="短链平台数据可视化-埋点采集" tabindex="-1">短链平台数据可视化-埋点采集 <a class="header-anchor" href="#短链平台数据可视化-埋点采集" aria-label="Permalink to &quot;短链平台数据可视化-埋点采集&quot;">​</a></h1><h2 id="常⻅数据埋点采集方案介绍" tabindex="-1">常⻅数据埋点采集方案介绍 <a class="header-anchor" href="#常⻅数据埋点采集方案介绍" aria-label="Permalink to &quot;常⻅数据埋点采集方案介绍&quot;">​</a></h2><h3 id="大数据-etl和数据仓库建设分层" tabindex="-1">大数据-ETL和数据仓库建设分层 <a class="header-anchor" href="#大数据-etl和数据仓库建设分层" aria-label="Permalink to &quot;大数据-ETL和数据仓库建设分层&quot;">​</a></h3><h4 id="etl-extract-transform-load" tabindex="-1">ETL(Extract-Transform-Load) <a class="header-anchor" href="#etl-extract-transform-load" aria-label="Permalink to &quot;ETL(Extract-Transform-Load)&quot;">​</a></h4><h5 id="抽取-extract-、转换-transform-、加载-load" tabindex="-1">抽取(extract)、转换(transform)、加载(load) <a class="header-anchor" href="#抽取-extract-、转换-transform-、加载-load" aria-label="Permalink to &quot;抽取(extract)、转换(transform)、加载(load)&quot;">​</a></h5><h4 id="数仓分层介绍" tabindex="-1">数仓分层介绍 <a class="header-anchor" href="#数仓分层介绍" aria-label="Permalink to &quot;数仓分层介绍&quot;">​</a></h4><h5 id="顺序" tabindex="-1">顺序 <a class="header-anchor" href="#顺序" aria-label="Permalink to &quot;顺序&quot;">​</a></h5><h6 id="ods" tabindex="-1">ODS <a class="header-anchor" href="#ods" aria-label="Permalink to &quot;ODS&quot;">​</a></h6><ul><li>原始数据层 <ul><li>汇集多个原始未处理的数据</li></ul></li></ul><h6 id="dwd" tabindex="-1">DWD <a class="header-anchor" href="#dwd" aria-label="Permalink to &quot;DWD&quot;">​</a></h6><ul><li>明细数据层 <ul><li>清洗数据：比如脱敏、去除脏数据</li></ul></li></ul><h6 id="dwm" tabindex="-1">DWM <a class="header-anchor" href="#dwm" aria-label="Permalink to &quot;DWM&quot;">​</a></h6><ul><li>数据中间层 <ul><li>数据通用维度聚合操作：比如地理位置、设备</li></ul></li></ul><h6 id="dws" tabindex="-1">DWS <a class="header-anchor" href="#dws" aria-label="Permalink to &quot;DWS&quot;">​</a></h6><ul><li>数据服务层 <ul><li>分组聚合：比如某个商品xx秒内多少个pv、uv</li></ul></li></ul><h6 id="ads" tabindex="-1">ADS <a class="header-anchor" href="#ads" aria-label="Permalink to &quot;ADS&quot;">​</a></h6><ul><li>数据应用层 <ul><li>提供给数据产品和数据分析使用的数据</li></ul></li></ul><h5 id="为什么要分层" tabindex="-1">为什么要分层 <a class="header-anchor" href="#为什么要分层" aria-label="Permalink to &quot;为什么要分层&quot;">​</a></h5><h6 id="开发者都希望自己的数据能够有顺序地流转-方便排查问题" tabindex="-1">开发者都希望自己的数据能够有顺序地流转，方便排查问题 <a class="header-anchor" href="#开发者都希望自己的数据能够有顺序地流转-方便排查问题" aria-label="Permalink to &quot;开发者都希望自己的数据能够有顺序地流转，方便排查问题&quot;">​</a></h6><h6 id="复杂问题简单化" tabindex="-1">复杂问题简单化 <a class="header-anchor" href="#复杂问题简单化" aria-label="Permalink to &quot;复杂问题简单化&quot;">​</a></h6><ul><li>复杂任务分层处理，每层定位职责不一样，每个层只解决特定的问题</li><li>减少重复开发量 <ul><li>规范数据分层，开发通用的中间层，可以极大地减少重复计算的工作</li></ul></li></ul><h6 id="总结-提效-懒人的智慧-主要是增加数据计算的复用性-每次新增加统计需求时-不用从原始数据进行计算-而是从半成品继续加工-从而更快更省成本" tabindex="-1">总结: 提效+懒人的智慧，主要是增加数据计算的复用性，每次新增加统计需求时，不用从原始数据进行计算，而是从半成品继续加工，从而更快更省成本 <a class="header-anchor" href="#总结-提效-懒人的智慧-主要是增加数据计算的复用性-每次新增加统计需求时-不用从原始数据进行计算-而是从半成品继续加工-从而更快更省成本" aria-label="Permalink to &quot;总结: 提效+懒人的智慧，主要是增加数据计算的复用性，每次新增加统计需求时，不用从原始数据进行计算，而是从半成品继续加工，从而更快更省成本&quot;">​</a></h6><h3 id="埋点方式" tabindex="-1">埋点方式 <a class="header-anchor" href="#埋点方式" aria-label="Permalink to &quot;埋点方式&quot;">​</a></h3><h4 id="代码埋点" tabindex="-1">代码埋点 <a class="header-anchor" href="#代码埋点" aria-label="Permalink to &quot;代码埋点&quot;">​</a></h4><h5 id="通过代码进行控制" tabindex="-1">通过代码进行控制 <a class="header-anchor" href="#通过代码进行控制" aria-label="Permalink to &quot;通过代码进行控制&quot;">​</a></h5><h4 id="可视化埋点" tabindex="-1">可视化埋点 <a class="header-anchor" href="#可视化埋点" aria-label="Permalink to &quot;可视化埋点&quot;">​</a></h4><h5 id="通过采集sdk" tabindex="-1">通过采集SDK <a class="header-anchor" href="#通过采集sdk" aria-label="Permalink to &quot;通过采集SDK&quot;">​</a></h5><h4 id="全埋点-无埋点" tabindex="-1">全埋点|无埋点 <a class="header-anchor" href="#全埋点-无埋点" aria-label="Permalink to &quot;全埋点|无埋点&quot;">​</a></h4><h3 id="短链平台采用方式" tabindex="-1">短链平台采用方式 <a class="header-anchor" href="#短链平台采用方式" aria-label="Permalink to &quot;短链平台采用方式&quot;">​</a></h3><h4 id="访问短链码" tabindex="-1">访问短链码 <a class="header-anchor" href="#访问短链码" aria-label="Permalink to &quot;访问短链码&quot;">​</a></h4><h4 id="记录日志-打印控制台-方便排查" tabindex="-1">记录日志-打印控制台(方便排查) <a class="header-anchor" href="#记录日志-打印控制台-方便排查" aria-label="Permalink to &quot;记录日志-打印控制台(方便排查)&quot;">​</a></h4><h4 id="发送kafka-本身异步发送" tabindex="-1">发送Kafka(本身异步发送) <a class="header-anchor" href="#发送kafka-本身异步发送" aria-label="Permalink to &quot;发送Kafka(本身异步发送)&quot;">​</a></h4><h1 id="数仓" tabindex="-1">数仓 <a class="header-anchor" href="#数仓" aria-label="Permalink to &quot;数仓&quot;">​</a></h1><h2 id="度量值" tabindex="-1">度量值 <a class="header-anchor" href="#度量值" aria-label="Permalink to &quot;度量值&quot;">​</a></h2><h3 id="站在维度的⻆度去看事实表-看事实表的度量值" tabindex="-1">站在维度的⻆度去看事实表，看事实表的度量值 <a class="header-anchor" href="#站在维度的⻆度去看事实表-看事实表的度量值" aria-label="Permalink to &quot;站在维度的⻆度去看事实表，看事实表的度量值&quot;">​</a></h3><h2 id="维度表" tabindex="-1">维度表 <a class="header-anchor" href="#维度表" aria-label="Permalink to &quot;维度表&quot;">​</a></h2><h3 id="维度表就是【你观察该事物的⻆度-是从哪个⻆度去观察这个内容的-商品⻆度-地区⻆度等】" tabindex="-1">维度表就是【你观察该事物的⻆度，是从哪个⻆度去观察这个内容的，商品⻆度，地区⻆度等】 <a class="header-anchor" href="#维度表就是【你观察该事物的⻆度-是从哪个⻆度去观察这个内容的-商品⻆度-地区⻆度等】" aria-label="Permalink to &quot;维度表就是【你观察该事物的⻆度，是从哪个⻆度去观察这个内容的，商品⻆度，地区⻆度等】&quot;">​</a></h3><h2 id="事实表" tabindex="-1">事实表 <a class="header-anchor" href="#事实表" aria-label="Permalink to &quot;事实表&quot;">​</a></h2><h3 id="事实表就是你要关注的内容" tabindex="-1">事实表就是你要关注的内容 <a class="header-anchor" href="#事实表就是你要关注的内容" aria-label="Permalink to &quot;事实表就是你要关注的内容&quot;">​</a></h3><h2 id="总结-2" tabindex="-1">总结 <a class="header-anchor" href="#总结-2" aria-label="Permalink to &quot;总结&quot;">​</a></h2><h3 id="维度是维度建模的基础和灵魂。在维度建模中-将度量称为-事实-将环境描述为-维度-。" tabindex="-1">维度是维度建模的基础和灵魂。在维度建模中，将度量称为“事实” ， 将环境描述为“维度”。 <a class="header-anchor" href="#维度是维度建模的基础和灵魂。在维度建模中-将度量称为-事实-将环境描述为-维度-。" aria-label="Permalink to &quot;维度是维度建模的基础和灵魂。在维度建模中，将度量称为“事实” ， 将环境描述为“维度”。&quot;">​</a></h3><h2 id="宽表-明细表" tabindex="-1">宽表(明细表) <a class="header-anchor" href="#宽表-明细表" aria-label="Permalink to &quot;宽表(明细表)&quot;">​</a></h2><h3 id="缺点-数据的大量冗余" tabindex="-1">缺点：数据的大量冗余 <a class="header-anchor" href="#缺点-数据的大量冗余" aria-label="Permalink to &quot;缺点：数据的大量冗余&quot;">​</a></h3><h3 id="优点-减少表关联数量-查询性能的提高-空间换时间" tabindex="-1">优点：减少表关联数量，查询性能的提高，空间换时间 <a class="header-anchor" href="#优点-减少表关联数量-查询性能的提高-空间换时间" aria-label="Permalink to &quot;优点：减少表关联数量，查询性能的提高，空间换时间&quot;">​</a></h3><h2 id="窄表" tabindex="-1">窄表 <a class="header-anchor" href="#窄表" aria-label="Permalink to &quot;窄表&quot;">​</a></h2><h3 id="缺点-做数据分析查询olap时-需要大量关联多个表-性能下降" tabindex="-1">缺点：做数据分析查询OLAP时，需要大量关联多个表，性能下降 <a class="header-anchor" href="#缺点-做数据分析查询olap时-需要大量关联多个表-性能下降" aria-label="Permalink to &quot;缺点：做数据分析查询OLAP时，需要大量关联多个表，性能下降&quot;">​</a></h3><h3 id="优点-存储省空间-大量数据只存储某个表" tabindex="-1">优点: 存储省空间，大量数据只存储某个表 <a class="header-anchor" href="#优点-存储省空间-大量数据只存储某个表" aria-label="Permalink to &quot;优点: 存储省空间，大量数据只存储某个表&quot;">​</a></h3><h2 id="数仓建模" tabindex="-1">数仓建模 <a class="header-anchor" href="#数仓建模" aria-label="Permalink to &quot;数仓建模&quot;">​</a></h2><blockquote><p>(类似数据库建表)</p></blockquote><h3 id="oltp中-mysql数据库建表-表和表之间的关系模型-叫关系建模" tabindex="-1">OLTP中: Mysql数据库建表，表和表之间的关系模型，叫关系建模 <a class="header-anchor" href="#oltp中-mysql数据库建表-表和表之间的关系模型-叫关系建模" aria-label="Permalink to &quot;OLTP中: Mysql数据库建表，表和表之间的关系模型，叫关系建模&quot;">​</a></h3><h3 id="olap中-根据一个事实表为中心进行建表-面向业务分析为主-叫维度建模" tabindex="-1">OLAP中: 根据一个事实表为中心进行建表，面向业务分析为主，叫维度建模 <a class="header-anchor" href="#olap中-根据一个事实表为中心进行建表-面向业务分析为主-叫维度建模" aria-label="Permalink to &quot;OLAP中: 根据一个事实表为中心进行建表，面向业务分析为主，叫维度建模&quot;">​</a></h3><h1 id="高频面试题-如何突破微信支付统一下单600qps" tabindex="-1">高频面试题-如何突破微信支付统一下单600QPS <a class="header-anchor" href="#高频面试题-如何突破微信支付统一下单600qps" aria-label="Permalink to &quot;高频面试题-如何突破微信支付统一下单600QPS&quot;">​</a></h1><h2 id="多商户策略-采用负载均衡方式进行操作" tabindex="-1">多商户策略，采用负载均衡方式进行操作 <a class="header-anchor" href="#多商户策略-采用负载均衡方式进行操作" aria-label="Permalink to &quot;多商户策略，采用负载均衡方式进行操作&quot;">​</a></h2><h2 id="详细-记录好用户下单所用的商户信息-也可以预先绑定好" tabindex="-1">详细：记录好用户下单所用的商户信息，也可以预先绑定好 <a class="header-anchor" href="#详细-记录好用户下单所用的商户信息-也可以预先绑定好" aria-label="Permalink to &quot;详细：记录好用户下单所用的商户信息，也可以预先绑定好&quot;">​</a></h2><h3 id="准备5个商户号-用户下单根据用户id取模是采用哪个商户进行调用" tabindex="-1">准备5个商户号， 用户下单根据用户id取模是采用哪个商户进行调用 <a class="header-anchor" href="#准备5个商户号-用户下单根据用户id取模是采用哪个商户进行调用" aria-label="Permalink to &quot;准备5个商户号， 用户下单根据用户id取模是采用哪个商户进行调用&quot;">​</a></h3><h3 id="统一下单、退款、查询订单状态等就能分摊瞬时压力-也是固定到使用对应的商户进行操作" tabindex="-1">统一下单、退款、查询订单状态等就能分摊瞬时压力，也是固定到使用对应的商户进行操作 <a class="header-anchor" href="#统一下单、退款、查询订单状态等就能分摊瞬时压力-也是固定到使用对应的商户进行操作" aria-label="Permalink to &quot;统一下单、退款、查询订单状态等就能分摊瞬时压力，也是固定到使用对应的商户进行操作&quot;">​</a></h3><h3 id="根据api进行控制好频率-监控" tabindex="-1">根据API进行控制好频率+监控 <a class="header-anchor" href="#根据api进行控制好频率-监控" aria-label="Permalink to &quot;根据API进行控制好频率+监控&quot;">​</a></h3><h2 id="注意-秒杀类业务-常规都是高并发锁定库存生成订单-然后支付是可以靠前端⻚面做离散支付的一定时间内错峰" tabindex="-1">注意：秒杀类业务，常规都是高并发锁定库存生成订单，然后支付是可以靠前端⻚面做离散支付的一定时间内错峰 <a class="header-anchor" href="#注意-秒杀类业务-常规都是高并发锁定库存生成订单-然后支付是可以靠前端⻚面做离散支付的一定时间内错峰" aria-label="Permalink to &quot;注意：秒杀类业务，常规都是高并发锁定库存生成订单，然后支付是可以靠前端⻚面做离散支付的一定时间内错峰&quot;">​</a></h2><h2 id="ip解析地理位置信息也是类似的" tabindex="-1">Ip解析地理位置信息也是类似的 <a class="header-anchor" href="#ip解析地理位置信息也是类似的" aria-label="Permalink to &quot;Ip解析地理位置信息也是类似的&quot;">​</a></h2><h3 id="对接多个高德账号或者对接多个在线解析平台-比如百度、高德、腾讯等" tabindex="-1">对接多个高德账号或者对接多个在线解析平台，比如百度、高德、腾讯等 <a class="header-anchor" href="#对接多个高德账号或者对接多个在线解析平台-比如百度、高德、腾讯等" aria-label="Permalink to &quot;对接多个高德账号或者对接多个在线解析平台，比如百度、高德、腾讯等&quot;">​</a></h3><h3 id="做好统一的地理位置信息编码即可" tabindex="-1">做好统一的地理位置信息编码即可 <a class="header-anchor" href="#做好统一的地理位置信息编码即可" aria-label="Permalink to &quot;做好统一的地理位置信息编码即可&quot;">​</a></h3><h1 id="跨域" tabindex="-1">跨域 <a class="header-anchor" href="#跨域" aria-label="Permalink to &quot;跨域&quot;">​</a></h1><h2 id="浏览器从一个域名的网⻚去请求另一个域名的资源时-域名、端口、协议任一不同-都是跨域。" tabindex="-1">浏览器从一个域名的网⻚去请求另一个域名的资源时，域名、端口、协议任一不同，都是跨域。 <a class="header-anchor" href="#浏览器从一个域名的网⻚去请求另一个域名的资源时-域名、端口、协议任一不同-都是跨域。" aria-label="Permalink to &quot;浏览器从一个域名的网⻚去请求另一个域名的资源时，域名、端口、协议任一不同，都是跨域。&quot;">​</a></h2><h2 id="需要解决跨域-有多种配置" tabindex="-1">需要解决跨域，有多种配置 <a class="header-anchor" href="#需要解决跨域-有多种配置" aria-label="Permalink to &quot;需要解决跨域，有多种配置&quot;">​</a></h2><h3 id="nginx配置" tabindex="-1">Nginx配置 <a class="header-anchor" href="#nginx配置" aria-label="Permalink to &quot;Nginx配置&quot;">​</a></h3><h3 id="业务微服务配置" tabindex="-1">业务微服务配置 <a class="header-anchor" href="#业务微服务配置" aria-label="Permalink to &quot;业务微服务配置&quot;">​</a></h3><h3 id="前端node层渲染" tabindex="-1">前端Node层渲染 <a class="header-anchor" href="#前端node层渲染" aria-label="Permalink to &quot;前端Node层渲染&quot;">​</a></h3><h3 id="gateway配置" tabindex="-1">Gateway配置 <a class="header-anchor" href="#gateway配置" aria-label="Permalink to &quot;Gateway配置&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CorsConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WebFilter </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">corsFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ServerWebExchange ctx, WebFilterChain chain) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ServerHttpRequest request </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CorsUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isCorsRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                HttpHeaders requestHeaders </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ServerHttpResponse response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                HttpMethod requestMethod </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requestHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAccessControlRequestMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                HttpHeaders headers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpHeaders.ACCESS_CONTROL_ALLOW_ORIGIN, requestHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrigin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpHeaders.ACCESS_CONTROL_ALLOW_HEADERS,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        requestHeaders.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAccessControlRequestHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (requestMethod </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpHeaders.ACCESS_CONTROL_ALLOW_METHODS, requestMethod.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpHeaders.ACCESS_CONTROL_EXPOSE_HEADERS, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpMethod.OPTIONS) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatusCode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatus.OK);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Mono.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">empty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chain.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ctx);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="devops" tabindex="-1">DevOps <a class="header-anchor" href="#devops" aria-label="Permalink to &quot;DevOps&quot;">​</a></h1><p><img src="/images/20e6c3c5b21f25909b779157494f8702.png" alt="image.png"><img src="/images/e4e2a41547e4883b02d76762a32495ae.png" alt="image.png"></p><h2 id="devops一词是由英文-development-开发-和-operations-运维-组合而成" tabindex="-1">DevOps一词是由英文 Development(开发) 和 Operations(运维) 组合而成 <a class="header-anchor" href="#devops一词是由英文-development-开发-和-operations-运维-组合而成" aria-label="Permalink to &quot;DevOps一词是由英文 Development(开发) 和 Operations(运维) 组合而成&quot;">​</a></h2><h2 id="一种思想-强调软件开发测试运维的一体化-减少各个部⻔之间的沟通成本从而实现软件的快速高质量的发布" tabindex="-1">一种思想，强调软件开发测试运维的一体化，减少各个部⻔之间的沟通成本从而实现软件的快速高质量的发布 <a class="header-anchor" href="#一种思想-强调软件开发测试运维的一体化-减少各个部⻔之间的沟通成本从而实现软件的快速高质量的发布" aria-label="Permalink to &quot;一种思想，强调软件开发测试运维的一体化，减少各个部⻔之间的沟通成本从而实现软件的快速高质量的发布&quot;">​</a></h2><h2 id="devops与cicd紧密相关-devops要实现人员一体化-须要借助cicd工具来自动化整个流程" tabindex="-1">DevOps与CICD紧密相关，DevOps要实现人员一体化，须要借助CICD工具来自动化整个流程 <a class="header-anchor" href="#devops与cicd紧密相关-devops要实现人员一体化-须要借助cicd工具来自动化整个流程" aria-label="Permalink to &quot;DevOps与CICD紧密相关，DevOps要实现人员一体化，须要借助CICD工具来自动化整个流程&quot;">​</a></h2><h3 id="cicd" tabindex="-1">CICD <a class="header-anchor" href="#cicd" aria-label="Permalink to &quot;CICD&quot;">​</a></h3><h4 id="是指持续集成、持续发布-是一套实现软件的构建测试部署的自动化流程。" tabindex="-1">是指持续集成、持续发布，是一套实现软件的构建测试部署的自动化流程。 <a class="header-anchor" href="#是指持续集成、持续发布-是一套实现软件的构建测试部署的自动化流程。" aria-label="Permalink to &quot;是指持续集成、持续发布，是一套实现软件的构建测试部署的自动化流程。&quot;">​</a></h4></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-48f9bb55><!--[--><!--]--><!----><nav class="prev-next" data-v-48f9bb55><div class="pager" data-v-48f9bb55><a class="VPLink link pager-link prev" href="/mds/%E5%90%8E%E7%AB%AF/%E9%A1%B9%E7%9B%AE/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E7%9F%AD%E9%93%BE%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0.html" data-v-48f9bb55><!--[--><span class="desc" data-v-48f9bb55>Previous page</span><span class="title" data-v-48f9bb55>海量数据短链项目笔记</span><!--]--></a></div><div class="pager" data-v-48f9bb55><a class="VPLink link pager-link next" href="/mds/%E5%90%8E%E7%AB%AF/%E9%AB%98%E6%80%A7%E8%83%BDRabbitMQ%E5%AE%B9%E5%99%A8%E5%8C%96%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98.html" data-v-48f9bb55><!--[--><span class="desc" data-v-48f9bb55>Next page</span><span class="title" data-v-48f9bb55>高性能RabbitMQ容器化分布式集群实战</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5a346dfe data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Released under the MIT License.</p><p class="copyright" data-v-e315a0ad><a href="https://beian.miit.gov.cn/">蜀ICP备2023020990号-1</a> Copyright © 2019-present Forest</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"mds_前端_js底层知识_js内存机制.md\":\"Sj27TX4q\",\"mds_关于我.md\":\"M95nfZJy\",\"mds_后端_高性能rabbitmq容器化分布式集群实战.md\":\"XOtA51JY\",\"mds_算法_等待记录中.md\":\"r4t_QdxE\",\"mds_后端_shardingjdbc分库分表mysql数据库实战笔记.md\":\"uD39r6Oe\",\"mds_后端_分布式流处理平台kafka笔记.md\":\"crZsLFM-\",\"mds_后端_专题秘籍_k8s笔记.md\":\"fNVEJPzS\",\"mds_前端_基础知识_css常见概念.md\":\"wYcT7VxR\",\"mds_前端_常用工具方法封装_js数据类型判断.md\":\"f3VrKFr_\",\"mds_前端_常用工具方法封装_js防抖节流.md\":\"CCPja4qK\",\"mds_前端_js底层知识_js函数.md\":\"DwamS4sn\",\"mds_前端_网络通信_网络通信基本概念.md\":\"Zd8WoyB1\",\"mds_前端_js底层知识_javascript之数据类型.md\":\"0ZXfceEw\",\"mds_后端_架构_构架笔记.md\":\"c3B-7eHT\",\"mds_后端_k8s笔记.md\":\"zSVfbJ1-\",\"mds_前端_工程化_webpack核心原理.md\":\"F7tJiFJH\",\"index.md\":\"LPf_U81N\",\"mds_前端_基础知识_javascript总结.md\":\"CJRooiCq\",\"mds_后端_项目实战_海量数据短链项目笔记.md\":\"RqS8R3TT\",\"mds_后端_项目_海量数据短链项目笔记.md\":\"y8BbLhXE\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Forest's Blog\",\"description\":\"个人技术知识库，记录和分享个人碎片化、结构化、体系化的技术知识内容\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"关于我\",\"link\":\"/mds/关于我\"},{\"text\":\"前端\",\"items\":[{\"text\":\"JS底层知识\",\"items\":[{\"text\":\"JS内存机制\",\"link\":\"/mds/前端/JS底层知识/JS内存机制\"},{\"text\":\"JS函数\",\"link\":\"/mds/前端/JS底层知识/JS函数\"},{\"text\":\"JavaScript之数据类型\",\"link\":\"/mds/前端/JS底层知识/JavaScript之数据类型\"}]},{\"text\":\"基础知识\",\"items\":[{\"text\":\"CSS常见概念\",\"link\":\"/mds/前端/基础知识/CSS常见概念\"},{\"text\":\"JavaScript总结\",\"link\":\"/mds/前端/基础知识/JavaScript总结\"}]},{\"text\":\"工程化\",\"items\":[{\"text\":\"Webpack核心原理\",\"link\":\"/mds/前端/工程化/Webpack核心原理\"}]},{\"text\":\"常用工具方法封装\",\"items\":[{\"text\":\"JS数据类型判断\",\"link\":\"/mds/前端/常用工具方法封装/JS数据类型判断\"},{\"text\":\"JS防抖节流\",\"link\":\"/mds/前端/常用工具方法封装/JS防抖节流\"}]},{\"text\":\"网络通信\",\"items\":[{\"text\":\"网络通信基本概念\",\"link\":\"/mds/前端/网络通信/网络通信基本概念\"}]}]},{\"text\":\"后端\",\"items\":[{\"text\":\"K8s笔记\",\"link\":\"/mds/后端/K8s笔记\"},{\"text\":\"ShardingJDBC分库分表mysql数据库实战笔记\",\"link\":\"/mds/后端/ShardingJDBC分库分表mysql数据库实战笔记\"},{\"text\":\"专题秘籍\",\"items\":[{\"text\":\"K8s笔记\",\"link\":\"/mds/后端/专题秘籍/K8s笔记\"}]},{\"text\":\"分布式流处理平台Kafka笔记\",\"link\":\"/mds/后端/分布式流处理平台Kafka笔记\"},{\"text\":\"架构\",\"items\":[{\"text\":\"构架笔记\",\"link\":\"/mds/后端/架构/构架笔记\"}]},{\"text\":\"项目\",\"items\":[{\"text\":\"海量数据短链项目笔记\",\"link\":\"/mds/后端/项目/海量数据短链项目笔记\"}]},{\"text\":\"项目实战\",\"items\":[{\"text\":\"海量数据短链项目笔记\",\"link\":\"/mds/后端/项目实战/海量数据短链项目笔记\"}]},{\"text\":\"高性能RabbitMQ容器化分布式集群实战\",\"link\":\"/mds/后端/高性能RabbitMQ容器化分布式集群实战\"}]},{\"text\":\"算法\",\"items\":[{\"text\":\"等待记录中\",\"link\":\"/mds/算法/等待记录中\"}]}],\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"<a href=\\\"https://beian.miit.gov.cn/\\\">蜀ICP备2023020990号-1</a> Copyright © 2019-present Forest\"},\"sidebar\":{\"/mds\":[{\"text\":\"关于我\",\"link\":\"/mds/关于我\"},{\"text\":\"前端\",\"items\":[{\"text\":\"JS底层知识\",\"items\":[{\"text\":\"JS内存机制\",\"link\":\"/mds/前端/JS底层知识/JS内存机制\"},{\"text\":\"JS函数\",\"link\":\"/mds/前端/JS底层知识/JS函数\"},{\"text\":\"JavaScript之数据类型\",\"link\":\"/mds/前端/JS底层知识/JavaScript之数据类型\"}]},{\"text\":\"基础知识\",\"items\":[{\"text\":\"CSS常见概念\",\"link\":\"/mds/前端/基础知识/CSS常见概念\"},{\"text\":\"JavaScript总结\",\"link\":\"/mds/前端/基础知识/JavaScript总结\"}]},{\"text\":\"工程化\",\"items\":[{\"text\":\"Webpack核心原理\",\"link\":\"/mds/前端/工程化/Webpack核心原理\"}]},{\"text\":\"常用工具方法封装\",\"items\":[{\"text\":\"JS数据类型判断\",\"link\":\"/mds/前端/常用工具方法封装/JS数据类型判断\"},{\"text\":\"JS防抖节流\",\"link\":\"/mds/前端/常用工具方法封装/JS防抖节流\"}]},{\"text\":\"网络通信\",\"items\":[{\"text\":\"网络通信基本概念\",\"link\":\"/mds/前端/网络通信/网络通信基本概念\"}]}]},{\"text\":\"后端\",\"items\":[{\"text\":\"K8s笔记\",\"link\":\"/mds/后端/K8s笔记\"},{\"text\":\"ShardingJDBC分库分表mysql数据库实战笔记\",\"link\":\"/mds/后端/ShardingJDBC分库分表mysql数据库实战笔记\"},{\"text\":\"专题秘籍\",\"items\":[{\"text\":\"K8s笔记\",\"link\":\"/mds/后端/专题秘籍/K8s笔记\"}]},{\"text\":\"分布式流处理平台Kafka笔记\",\"link\":\"/mds/后端/分布式流处理平台Kafka笔记\"},{\"text\":\"架构\",\"items\":[{\"text\":\"构架笔记\",\"link\":\"/mds/后端/架构/构架笔记\"}]},{\"text\":\"项目\",\"items\":[{\"text\":\"海量数据短链项目笔记\",\"link\":\"/mds/后端/项目/海量数据短链项目笔记\"}]},{\"text\":\"项目实战\",\"items\":[{\"text\":\"海量数据短链项目笔记\",\"link\":\"/mds/后端/项目实战/海量数据短链项目笔记\"}]},{\"text\":\"高性能RabbitMQ容器化分布式集群实战\",\"link\":\"/mds/后端/高性能RabbitMQ容器化分布式集群实战\"}]},{\"text\":\"算法\",\"items\":[{\"text\":\"等待记录中\",\"link\":\"/mds/算法/等待记录中\"}]}]},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>